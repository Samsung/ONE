<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ONE - On-device Neural Engine: How to Build Runtime</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ONE - On-device Neural Engine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_howto_how_to_build_runtime.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">How to Build Runtime </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This document is based on the system where Ubuntu Desktop Linux 18.04 LTS is installed with default settings, and can be applied in other environments without much difference. For reference, the development of our project started in the Ubuntu Desktop Linux 16.04 LTS environment.</p>
<h1>Build requirements</h1>
<p >If you are going to build this project, the following modules must be installed on your system:</p>
<ul>
<li>CMake</li>
<li>Boost C++ libraries</li>
</ul>
<p >In the Ubuntu, you can easily install it with the following command.</p>
<div class="fragment"><div class="line">$ sudo apt-get install cmake libboost-all-dev</div>
</div><!-- fragment --><p >If your linux system does not have the basic development configuration, you will need to install more packages. A list of all packages needed to configure the development environment can be found in <a href="https://github.com/Samsung/ONE/blob/master/infra/docker/bionic/Dockerfile">https://github.com/Samsung/ONE/blob/master/infra/docker/bionic/Dockerfile</a>.</p>
<p >Here is a summary of it</p>
<div class="fragment"><div class="line">$ sudo apt install \</div>
<div class="line">build-essential \</div>
<div class="line">clang-format-8 \</div>
<div class="line">cmake \</div>
<div class="line">doxygen \</div>
<div class="line">git \</div>
<div class="line">graphviz \</div>
<div class="line">hdf5-tools \</div>
<div class="line">lcov \</div>
<div class="line">libatlas-base-dev \</div>
<div class="line">libboost-all-dev \</div>
<div class="line">libgflags-dev \</div>
<div class="line">libgoogle-glog-dev \</div>
<div class="line">libgtest-dev \</div>
<div class="line">libhdf5-dev \</div>
<div class="line">libprotobuf-dev \</div>
<div class="line">protobuf-compiler \</div>
<div class="line">pylint \</div>
<div class="line">python3 \</div>
<div class="line">python3-pip \</div>
<div class="line">python3-venv \</div>
<div class="line">scons \</div>
<div class="line">software-properties-common \</div>
<div class="line">unzip \</div>
<div class="line">wget</div>
<div class="line"> </div>
<div class="line">$ mkdir /tmp/gtest</div>
<div class="line">$ cd /tmp/gtest</div>
<div class="line">$ cmake /usr/src/gtest</div>
<div class="line">$ make</div>
<div class="line">$ sudo mv *.a /usr/lib</div>
<div class="line"> </div>
<div class="line">$ pip install yapf==0.22.0 numpy</div>
</div><!-- fragment --><h1>Build from source code, for Ubuntu</h1>
<p >In a typical linux development environment, including Ubuntu, you can build the runtime with a simple command like this:</p>
<div class="fragment"><div class="line">$ git clone https://github.com/Samsung/ONE.git one</div>
<div class="line">$ cd one</div>
<div class="line">$ make -f Makefile.template install</div>
</div><!-- fragment --><p >Unfortunately, the debug build on the x86_64 architecture currently has an error. To solve the problem, you must use gcc version 9 or higher. Another workaround is to do a release build rather than a debug build. This is not a suitable method for debugging during development, but it is enough to check the function of the runtime. To release build the runtime, add the environment variable <code>BUILD_TYPE=release</code> to the build command as follows.</p>
<div class="fragment"><div class="line">$ export BUILD_TYPE=release</div>
<div class="line">$ make -f Makefile.template</div>
</div><!-- fragment --><p >Or you can simply do something like this:</p>
<div class="fragment"><div class="line">$ BUILD_TYPE=release make -f Makefile.template</div>
</div><!-- fragment --><p >The build method described here is a <code>native build</code> in which the build environment and execution environment are same. So, this command creates a runtime binary targeting the current build architecture, probably x86_64, as the execution environment. You can find the build output in the ./Product folder as follows:</p>
<div class="fragment"><div class="line">$ tree -L 2 ./Product</div>
<div class="line">./Product</div>
<div class="line">├── out -&gt; /home/sjlee/star/one/Product/x86_64-linux.release/out</div>
<div class="line">└── x86_64-linux.release</div>
<div class="line">    ├── obj</div>
<div class="line">    └── out</div>
<div class="line"> </div>
<div class="line">5 directories, 3 files</div>
<div class="line"> </div>
<div class="line">$ tree -L 3 ./Product/out</div>
<div class="line">./Product/out</div>
<div class="line">├── bin</div>
<div class="line">│   ├── onert_run</div>
<div class="line">│   ├── tflite_comparator</div>
<div class="line">│   └── tflite_run</div>
<div class="line">├── include</div>
<div class="line">│   ├── nnfw</div>
<div class="line">│   │   ├── NeuralNetworksEx.h</div>
<div class="line">│   │   ├── NeuralNetworksExtensions.h</div>
<div class="line">│   │   ├── NeuralNetworks.h</div>
<div class="line">│   │   ├── nnfw_experimental.h</div>
<div class="line">│   │   └── nnfw.h</div>
<div class="line">│   └── onert</div>
<div class="line">│       ├── backend</div>
<div class="line">│       ├── compiler</div>
<div class="line">│       ├── exec</div>
<div class="line">│       ├── ir</div>
<div class="line">│       └── util</div>
<div class="line">├── lib</div>
<div class="line">│   ├── libbackend_cpu.so</div>
<div class="line">│   ├── libbackend_ruy.so</div>
<div class="line">│   ├── libneuralnetworks.so</div>
<div class="line">│   ├── libnnfw-dev.so</div>
<div class="line">│   └── libonert_core.so</div>
<div class="line">├── nnapi-gtest</div>
<div class="line">│   ├── nnapi_gtest</div>
<div class="line">│   ├── nnapi_gtest.skip</div>
<div class="line">│   ├── nnapi_gtest.skip.noarch.interp</div>
<div class="line">│   └── nnapi_gtest.skip.x86_64-linux.cpu</div>
<div class="line">├── test</div>
<div class="line">│   ├── command</div>
<div class="line">│   │   ├── nnpkg-test</div>
<div class="line">│   │   ├── prepare-model</div>
<div class="line">│   │   ├── unittest</div>
<div class="line">│   │   └── verify-tflite</div>
<div class="line">│   ├── FillFrom_runner</div>
<div class="line">│   ├── list</div>
<div class="line">│   │   ├── benchmark_nnpkg_model_list.txt</div>
<div class="line">│   │   ├── nnpkg_test_list.armv7l-linux.acl_cl</div>
<div class="line">│   │   ├── nnpkg_test_list.armv7l-linux.acl_neon</div>
<div class="line">│   │   ├── nnpkg_test_list.armv7l-linux.cpu</div>
<div class="line">│   │   ├── nnpkg_test_list.noarch.interp</div>
<div class="line">│   │   ├── tflite_comparator.aarch64.acl_cl.list</div>
<div class="line">│   │   ├── tflite_comparator.aarch64.acl_neon.list</div>
<div class="line">│   │   ├── tflite_comparator.aarch64.cpu.list</div>
<div class="line">│   │   ├── tflite_comparator.armv7l.acl_cl.list</div>
<div class="line">│   │   ├── tflite_comparator.armv7l.acl_neon.list</div>
<div class="line">│   │   ├── tflite_comparator.armv7l.cpu.list</div>
<div class="line">│   │   ├── tflite_comparator.noarch.interp.list</div>
<div class="line">│   │   └── tflite_comparator.x86_64.cpu.list</div>
<div class="line">│   ├── models</div>
<div class="line">│   │   ├── run_test.sh</div>
<div class="line">│   │   └── tflite</div>
<div class="line">│   ├── nnpkgs</div>
<div class="line">│   │   └── FillFrom</div>
<div class="line">│   └── onert-test</div>
<div class="line">└── unittest</div>
<div class="line">    ├── ndarray_test</div>
<div class="line">    ├── nnfw_api_gtest</div>
<div class="line">    ├── nnfw_api_gtest_models</div>
<div class="line">    │   ├── add</div>
<div class="line">    │   ├── add_invalid_manifest</div>
<div class="line">    │   ├── add_no_manifest</div>
<div class="line">    │   ├── if_dynamic</div>
<div class="line">    │   ├── mobilenet_v1_1.0_224</div>
<div class="line">    │   └── while_dynamic</div>
<div class="line">    ├── nnfw_lib_misc_test</div>
<div class="line">    ├── test_cker</div>
<div class="line">    ├── test_onert_core</div>
<div class="line">    ├── test_onert_frontend_nnapi</div>
<div class="line">    └── tflite_test</div>
<div class="line"> </div>
<div class="line">26 directories, 46 files</div>
</div><!-- fragment --><p >Here, let's recall that the main target of our project is the arm architecture. If you have a development environment running Linux for arm on a device made of an arm CPU, such as Odroid-XU4, you will get a runtime binary that can be run on the arm architecture with the same command above. This is the simplest way to get a binary for an arm device. However, in most cases, native builds on arm devices are too impractical as they require too long. Therefore, we will create an executable binary of an architecture other than x86_64 through a <code>cross build</code>. For cross-build method for each architecture, please refer to the corresponding document in the following section, How to cross-build runtime for different architecture.</p>
<h2>Run test</h2>
<p >The simple way to check whether the build was successful is to perform inference of the NN model using the runtime. The model to be used for the test can be obtained as follows.</p>
<div class="fragment"><div class="line">$ wget https://storage.googleapis.com/download.tensorflow.org/models/tflite/model_zoo/upload_20180427/inception_v3_2018_04_27.tgz</div>
<div class="line">$ tar zxvf inception_v3_2018_04_27.tgz ./inception_v3.tflite</div>
<div class="line">$ ls *.tflite</div>
<div class="line">inception_v3.tflite</div>
</div><!-- fragment --><p >The result of running the inception_v3 model using runtime is as follows. Please consider that this is a test that simply checks execution latency without considering the accuracy of the model.</p>
<div class="fragment"><div class="line">$ ./Product/out/bin/onert_run --modelfile ./inception_v3.tflite</div>
<div class="line">Model Filename ./inception_v3.tflite</div>
<div class="line">===================================</div>
<div class="line">MODEL_LOAD   takes 1.108 ms</div>
<div class="line">PREPARE      takes 0.190 ms</div>
<div class="line">EXECUTE      takes 183.895 ms</div>
<div class="line">- MEAN     :  183.895 ms</div>
<div class="line">- MAX      :  183.895 ms</div>
<div class="line">- MIN      :  183.895 ms</div>
<div class="line">- GEOMEAN  :  183.895 ms</div>
<div class="line">===================================</div>
</div><!-- fragment --><p> If you use <code>tflite_run</code> instead of <code>onert_run</code>, the model will be executed using Tensorflow lite, the basic framework for verification. From the previous build result, you can see that it is the path to the directory where <code>tflite_run</code> and <code>onert_run</code> are located.</p>
<p >If you come here without any problems, you have all of the basic environments for runtime development.</p>
<h1>Build for Tizen</h1>
<p >(Will be written)</p>
<h1>Build using docker image</h1>
<p >If your development system is not a linux environment like Ubuntu, but you can use docker on your system, you can build a runtime using a pre-configured docker image. Of course, you can also build a runtime using a docker image in a ubuntu environment, without setting up a complicated development environment. For more information, please refer to the following document.</p>
<ul>
<li><a class="el" href="md_docs_howto_how_to_build_runtime_using_prebuilt_docker_image.html">Build using prebuilt docker image</a></li>
</ul>
<h1>How to cross-build runtime for different architecture</h1>
<p >Please refer to the following document for the build method for architecture other than x86_64, which is the basic development environment.</p>
<ul>
<li><a class="el" href="md_docs_howto_how_to_cross_build_runtime_for_arm.html">Cross building for ARM</a></li>
<li><a class="el" href="md_docs_howto_how_to_cross_build_runtime_for_aarch64.html">Cross building for AARCH64</a></li>
<li><a class="el" href="md_docs_howto_how_to_cross_build_runtime_for_android.html">Cross building for Android</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
