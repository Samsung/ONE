<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ONE - On-device Neural Engine: luci::ConvertNCHWToNHWCPass Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ONE - On-device Neural Engine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('structluci_1_1_convert_n_c_h_w_to_n_h_w_c_pass.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle"><div class="title">luci::ConvertNCHWToNHWCPass Struct Reference<span class="mlabels"><span class="mlabel">final</span></span></div></div>
</div><!--header-->
<div class="contents">

<p>Class to convert NCHW Ops to NHWC.  
 <a href="structluci_1_1_convert_n_c_h_w_to_n_h_w_c_pass.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_convert_n_c_h_w_to_n_h_w_c_pass_8h_source.html">ConvertNCHWToNHWCPass.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for luci::ConvertNCHWToNHWCPass:</div>
<div class="dyncontent">
<div class="center"><img src="structluci_1_1_convert_n_c_h_w_to_n_h_w_c_pass__coll__graph.png" border="0" usemap="#aluci_1_1_convert_n_c_h_w_to_n_h_w_c_pass_coll__map" alt="Collaboration graph"/></div>
<map name="aluci_1_1_convert_n_c_h_w_to_n_h_w_c_pass_coll__map" id="aluci_1_1_convert_n_c_h_w_to_n_h_w_c_pass_coll__map">
<area shape="rect" title="Class to convert NCHW Ops to NHWC." alt="" coords="5,79,225,104"/>
<area shape="rect" href="classlogo_1_1_pass.html" title=" " alt="" coords="74,5,157,31"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a29a1a4ac37f97c1a6fbd258656e9e591"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structluci_1_1_convert_n_c_h_w_to_n_h_w_c_pass.html#a29a1a4ac37f97c1a6fbd258656e9e591">ConvertNCHWToNHWCPass</a> (bool preserve_input, bool preserve_output)</td></tr>
<tr class="separator:a29a1a4ac37f97c1a6fbd258656e9e591"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6014d8ced82244c044b9965070788bd1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structluci_1_1_convert_n_c_h_w_to_n_h_w_c_pass.html#a6014d8ced82244c044b9965070788bd1">ConvertNCHWToNHWCPass</a> ()=delete</td></tr>
<tr class="separator:a6014d8ced82244c044b9965070788bd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d2d90a26b899a721aea6f2a2f97aadd"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structluci_1_1_convert_n_c_h_w_to_n_h_w_c_pass.html#a5d2d90a26b899a721aea6f2a2f97aadd">~ConvertNCHWToNHWCPass</a> ()=default</td></tr>
<tr class="separator:a5d2d90a26b899a721aea6f2a2f97aadd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a887f50591f9407a1474de2e4dd77f1fa"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structluci_1_1_convert_n_c_h_w_to_n_h_w_c_pass.html#a887f50591f9407a1474de2e4dd77f1fa">name</a> (void) const final</td></tr>
<tr class="separator:a887f50591f9407a1474de2e4dd77f1fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fdf86f3da4f3ae54eebe658db2bb70b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structluci_1_1_convert_n_c_h_w_to_n_h_w_c_pass.html#a0fdf86f3da4f3ae54eebe658db2bb70b">run</a> (<a class="el" href="classloco_1_1_graph.html">loco::Graph</a> *g) final</td></tr>
<tr class="memdesc:a0fdf86f3da4f3ae54eebe658db2bb70b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run the pass.  <a href="structluci_1_1_convert_n_c_h_w_to_n_h_w_c_pass.html#a0fdf86f3da4f3ae54eebe658db2bb70b">More...</a><br /></td></tr>
<tr class="separator:a0fdf86f3da4f3ae54eebe658db2bb70b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classlogo_1_1_pass"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classlogo_1_1_pass')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classlogo_1_1_pass.html">logo::Pass</a></td></tr>
<tr class="memitem:a6210601a99e987952ee399948fd15186 inherit pub_methods_classlogo_1_1_pass"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlogo_1_1_pass.html#a6210601a99e987952ee399948fd15186">~Pass</a> ()=default</td></tr>
<tr class="separator:a6210601a99e987952ee399948fd15186 inherit pub_methods_classlogo_1_1_pass"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c40912ff3bad046c4b07ca2b4aadec1 inherit pub_methods_classlogo_1_1_pass"><td class="memItemLeft" align="right" valign="top">virtual const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlogo_1_1_pass.html#a5c40912ff3bad046c4b07ca2b4aadec1">name</a> (void) const</td></tr>
<tr class="separator:a5c40912ff3bad046c4b07ca2b4aadec1 inherit pub_methods_classlogo_1_1_pass"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3076e513d3bf84dafeb158a028725374 inherit pub_methods_classlogo_1_1_pass"><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlogo_1_1_pass.html#a3076e513d3bf84dafeb158a028725374">run</a> (<a class="el" href="classloco_1_1_graph.html">loco::Graph</a> *graph)=0</td></tr>
<tr class="memdesc:a3076e513d3bf84dafeb158a028725374 inherit pub_methods_classlogo_1_1_pass"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run the pass.  <a href="classlogo_1_1_pass.html#a3076e513d3bf84dafeb158a028725374">More...</a><br /></td></tr>
<tr class="separator:a3076e513d3bf84dafeb158a028725374 inherit pub_methods_classlogo_1_1_pass"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Class to convert NCHW Ops to NHWC. </p>
<p >Find operators that use NCHW layout and make them use NHWC. Strictly speaking, it is impossible to distinguish whether an operator is using NCHW or NHWC without programmers' annotations. But we guess the data layout of each operator as much as possible based on the assumptions described in the comments. Note that this Pass does not change the execution result even for the false-positive cases. </p>

<p class="definition">Definition at line <a class="el" href="_convert_n_c_h_w_to_n_h_w_c_pass_8h_source.html#l00036">36</a> of file <a class="el" href="_convert_n_c_h_w_to_n_h_w_c_pass_8h_source.html">ConvertNCHWToNHWCPass.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a29a1a4ac37f97c1a6fbd258656e9e591" name="a29a1a4ac37f97c1a6fbd258656e9e591"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29a1a4ac37f97c1a6fbd258656e9e591">&#9670;&#160;</a></span>ConvertNCHWToNHWCPass() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">luci::ConvertNCHWToNHWCPass::ConvertNCHWToNHWCPass </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>preserve_input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>preserve_output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_convert_n_c_h_w_to_n_h_w_c_pass_8h_source.html#l00039">39</a> of file <a class="el" href="_convert_n_c_h_w_to_n_h_w_c_pass_8h_source.html">ConvertNCHWToNHWCPass.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   40</span>    : _preserve_input(preserve_input), _preserve_output(preserve_output)</div>
<div class="line"><span class="lineno">   41</span>  {</div>
<div class="line"><span class="lineno">   42</span>    <span class="comment">// Do nothing</span></div>
<div class="line"><span class="lineno">   43</span>  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6014d8ced82244c044b9965070788bd1" name="a6014d8ced82244c044b9965070788bd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6014d8ced82244c044b9965070788bd1">&#9670;&#160;</a></span>ConvertNCHWToNHWCPass() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">luci::ConvertNCHWToNHWCPass::ConvertNCHWToNHWCPass </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a5d2d90a26b899a721aea6f2a2f97aadd" name="a5d2d90a26b899a721aea6f2a2f97aadd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d2d90a26b899a721aea6f2a2f97aadd">&#9670;&#160;</a></span>~ConvertNCHWToNHWCPass()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual luci::ConvertNCHWToNHWCPass::~ConvertNCHWToNHWCPass </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a887f50591f9407a1474de2e4dd77f1fa" name="a887f50591f9407a1474de2e4dd77f1fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a887f50591f9407a1474de2e4dd77f1fa">&#9670;&#160;</a></span>name()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const char * luci::ConvertNCHWToNHWCPass::name </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">final</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented from <a class="el" href="classlogo_1_1_pass.html#a5c40912ff3bad046c4b07ca2b4aadec1">logo::Pass</a>.</p>

<p class="definition">Definition at line <a class="el" href="_convert_n_c_h_w_to_n_h_w_c_pass_8h_source.html#l00049">49</a> of file <a class="el" href="_convert_n_c_h_w_to_n_h_w_c_pass_8h_source.html">ConvertNCHWToNHWCPass.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   49</span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;luci::ConvertNCHWToNHWCPass&quot;</span>; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a0fdf86f3da4f3ae54eebe658db2bb70b" name="a0fdf86f3da4f3ae54eebe658db2bb70b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fdf86f3da4f3ae54eebe658db2bb70b">&#9670;&#160;</a></span>run()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool luci::ConvertNCHWToNHWCPass::run </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classloco_1_1_graph.html">loco::Graph</a> *&#160;</td>
          <td class="paramname"><em>graph</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">final</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Run the pass. </p>
<dl class="section return"><dt>Returns</dt><dd>false if there was nothing changed </dd></dl>

<p>Implements <a class="el" href="classlogo_1_1_pass.html#a3076e513d3bf84dafeb158a028725374">logo::Pass</a>.</p>

<p class="definition">Definition at line <a class="el" href="_convert_n_c_h_w_to_n_h_w_c_pass_8cpp_source.html#l01417">1417</a> of file <a class="el" href="_convert_n_c_h_w_to_n_h_w_c_pass_8cpp_source.html">ConvertNCHWToNHWCPass.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1418</span>{</div>
<div class="line"><span class="lineno"> 1419</span>  <a class="code hl_define" href="circlechef_2log_2include_2_log_8h.html#a5495ed6c3fae204a397f0edad87f820e">LOGGER</a>(l);</div>
<div class="line"><span class="lineno"> 1420</span>  <a class="code hl_define" href="circlechef_2log_2include_2_log_8h.html#a7af9b9d1a859db99acb5e3447167b029">INFO</a>(l) &lt;&lt; <span class="stringliteral">&quot;ConvertNCHWToNHWCPass Start&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno"> 1421</span> </div>
<div class="line"><span class="lineno"> 1422</span>  <span class="comment">// Annotate NHWC operators</span></div>
<div class="line"><span class="lineno"> 1423</span>  <span class="comment">// NHWC operators are detected by pattern matching</span></div>
<div class="line"><span class="lineno"> 1424</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1425</span>  <span class="comment">// Pattern</span></div>
<div class="line"><span class="lineno"> 1426</span>  <span class="comment">//    pre-Transose (or pre-Reshape) + [intermediate Ops] + post-Transpose (or post-Reshape)</span></div>
<div class="line"><span class="lineno"> 1427</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1428</span>  <span class="comment">// [intermediate Ops] are annotated as NHWC</span></div>
<div class="line"><span class="lineno"> 1429</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1430</span>  <span class="comment">// NOTE A single pre-Transpose/Reshape can have multiple post-Transpose/Reshape.</span></div>
<div class="line"><span class="lineno"> 1431</span>  <span class="comment">// For example,</span></div>
<div class="line"><span class="lineno"> 1432</span>  <span class="comment">// pre-Transpose --- [intermediate Ops] --- post-Transpose</span></div>
<div class="line"><span class="lineno"> 1433</span>  <span class="comment">//                |</span></div>
<div class="line"><span class="lineno"> 1434</span>  <span class="comment">//                +--[intermediate Ops] --- post-Transpose</span></div>
<div class="line"><span class="lineno"> 1435</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1436</span>  <span class="comment">// NOTE Intermediate Ops SHOULD NOT contain pre-Transpose/Reshape</span></div>
<div class="line"><span class="lineno"> 1437</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> node : <a class="code hl_function" href="namespaceloco.html#a117fa82db86ebda898ee54200c42928d">loco::postorder_traversal</a>(<a class="code hl_function" href="namespaceloco.html#ac026f76015947855f2cecfd0aab1d23a">loco::output_nodes</a>(g)))</div>
<div class="line"><span class="lineno"> 1438</span>  {</div>
<div class="line"><span class="lineno"> 1439</span>    <span class="keywordflow">if</span> (has_data_format(node))</div>
<div class="line"><span class="lineno"> 1440</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1441</span> </div>
<div class="line"><span class="lineno"> 1442</span>    <span class="keywordflow">if</span> (is_pre_transpose(node) || is_pre_reshape(node))</div>
<div class="line"><span class="lineno"> 1443</span>    {</div>
<div class="line"><span class="lineno"> 1444</span>      std::set&lt;loco::Node *&gt; intermediate;</div>
<div class="line"><span class="lineno"> 1445</span> </div>
<div class="line"><span class="lineno"> 1446</span>      <span class="comment">// Variable to check intermediate Ops contain pre-Transpose/Reshape</span></div>
<div class="line"><span class="lineno"> 1447</span>      <span class="keywordtype">bool</span> has_pre = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1448</span> </div>
<div class="line"><span class="lineno"> 1449</span>      <span class="comment">// Variable to check the pattern is closed with post-Transpose/Reshape</span></div>
<div class="line"><span class="lineno"> 1450</span>      <span class="keywordtype">bool</span> is_closed = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1451</span> </div>
<div class="line"><span class="lineno"> 1452</span>      <span class="comment">// For recursive call of lambda</span></div>
<div class="line"><span class="lineno"> 1453</span>      std::function&lt;void(<a class="code hl_class" href="classloco_1_1_node.html">loco::Node</a> *)&gt; collect_intermediate;</div>
<div class="line"><span class="lineno"> 1454</span>      collect_intermediate = [&amp;](<a class="code hl_class" href="classloco_1_1_node.html">loco::Node</a> *n) {</div>
<div class="line"><span class="lineno"> 1455</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> succ : <a class="code hl_function" href="namespaceloco.html#a43df4bfde8658322cb87ab5654ba4052">loco::succs</a>(n))</div>
<div class="line"><span class="lineno"> 1456</span>        {</div>
<div class="line"><span class="lineno"> 1457</span>          <span class="comment">// Exit condition</span></div>
<div class="line"><span class="lineno"> 1458</span>          <span class="keywordflow">if</span> (is_post_transpose(succ) || is_post_reshape(succ))</div>
<div class="line"><span class="lineno"> 1459</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1460</span> </div>
<div class="line"><span class="lineno"> 1461</span>          <span class="keywordflow">if</span> (is_pre_transpose(succ) || is_pre_reshape(succ))</div>
<div class="line"><span class="lineno"> 1462</span>          {</div>
<div class="line"><span class="lineno"> 1463</span>            has_pre = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1464</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1465</span>          }</div>
<div class="line"><span class="lineno"> 1466</span> </div>
<div class="line"><span class="lineno"> 1467</span>          <span class="keywordflow">if</span> (is_output(succ))</div>
<div class="line"><span class="lineno"> 1468</span>          {</div>
<div class="line"><span class="lineno"> 1469</span>            is_closed = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1470</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1471</span>          }</div>
<div class="line"><span class="lineno"> 1472</span> </div>
<div class="line"><span class="lineno"> 1473</span>          intermediate.emplace(succ);</div>
<div class="line"><span class="lineno"> 1474</span> </div>
<div class="line"><span class="lineno"> 1475</span>          collect_intermediate(succ);</div>
<div class="line"><span class="lineno"> 1476</span>        }</div>
<div class="line"><span class="lineno"> 1477</span>      };</div>
<div class="line"><span class="lineno"> 1478</span> </div>
<div class="line"><span class="lineno"> 1479</span>      collect_intermediate(node);</div>
<div class="line"><span class="lineno"> 1480</span> </div>
<div class="line"><span class="lineno"> 1481</span>      <span class="keywordflow">if</span> (has_pre or not is_closed)</div>
<div class="line"><span class="lineno"> 1482</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1483</span> </div>
<div class="line"><span class="lineno"> 1484</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> inter : intermediate)</div>
<div class="line"><span class="lineno"> 1485</span>      {</div>
<div class="line"><span class="lineno"> 1486</span>        <span class="keywordflow">if</span> (not has_data_format(inter))</div>
<div class="line"><span class="lineno"> 1487</span>          set_data_format(inter, DataFormat::NHWC);</div>
<div class="line"><span class="lineno"> 1488</span>      }</div>
<div class="line"><span class="lineno"> 1489</span>    }</div>
<div class="line"><span class="lineno"> 1490</span>  }</div>
<div class="line"><span class="lineno"> 1491</span> </div>
<div class="line"><span class="lineno"> 1492</span>  <span class="comment">// Annotate NCHW operators</span></div>
<div class="line"><span class="lineno"> 1493</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> node : <a class="code hl_function" href="namespaceloco.html#a91be999912c01878c820e684adc124da">loco::active_nodes</a>(<a class="code hl_function" href="namespaceloco.html#ac026f76015947855f2cecfd0aab1d23a">loco::output_nodes</a>(g)))</div>
<div class="line"><span class="lineno"> 1494</span>  {</div>
<div class="line"><span class="lineno"> 1495</span>    <span class="keyword">auto</span> circle_node = loco::must_cast&lt;luci::CircleNode *&gt;(node);</div>
<div class="line"><span class="lineno"> 1496</span>    <span class="keywordflow">switch</span> (circle_node-&gt;opcode())</div>
<div class="line"><span class="lineno"> 1497</span>    {</div>
<div class="line"><span class="lineno"> 1498</span>      <span class="comment">// List of supported Ops</span></div>
<div class="line"><span class="lineno"> 1499</span>      <span class="keywordflow">case</span> luci::CircleOpcode::CIRCLEINPUT:</div>
<div class="line"><span class="lineno"> 1500</span>        <span class="keywordflow">if</span> (!_preserve_input &amp;&amp; !has_data_format(node))</div>
<div class="line"><span class="lineno"> 1501</span>        {</div>
<div class="line"><span class="lineno"> 1502</span>          set_data_format(node, DataFormat::NCHW);</div>
<div class="line"><span class="lineno"> 1503</span>        }</div>
<div class="line"><span class="lineno"> 1504</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1505</span>      <span class="keywordflow">case</span> luci::CircleOpcode::CIRCLEOUTPUT:</div>
<div class="line"><span class="lineno"> 1506</span>        <span class="keywordflow">if</span> (!_preserve_output &amp;&amp; !has_data_format(node))</div>
<div class="line"><span class="lineno"> 1507</span>        {</div>
<div class="line"><span class="lineno"> 1508</span>          set_data_format(node, DataFormat::NCHW);</div>
<div class="line"><span class="lineno"> 1509</span>        }</div>
<div class="line"><span class="lineno"> 1510</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1511</span>      <span class="keywordflow">case</span> luci::CircleOpcode::ADD:</div>
<div class="line"><span class="lineno"> 1512</span>      <span class="keywordflow">case</span> luci::CircleOpcode::CONCATENATION:</div>
<div class="line"><span class="lineno"> 1513</span>      <span class="keywordflow">case</span> luci::CircleOpcode::ELU:</div>
<div class="line"><span class="lineno"> 1514</span>      <span class="keywordflow">case</span> luci::CircleOpcode::LEAKY_RELU:</div>
<div class="line"><span class="lineno"> 1515</span>      <span class="keywordflow">case</span> luci::CircleOpcode::LOGISTIC:</div>
<div class="line"><span class="lineno"> 1516</span>      <span class="keywordflow">case</span> luci::CircleOpcode::LOG_SOFTMAX:</div>
<div class="line"><span class="lineno"> 1517</span>      <span class="keywordflow">case</span> luci::CircleOpcode::MAXIMUM:</div>
<div class="line"><span class="lineno"> 1518</span>      <span class="keywordflow">case</span> luci::CircleOpcode::MEAN:</div>
<div class="line"><span class="lineno"> 1519</span>      <span class="keywordflow">case</span> luci::CircleOpcode::MINIMUM:</div>
<div class="line"><span class="lineno"> 1520</span>      <span class="keywordflow">case</span> luci::CircleOpcode::MUL:</div>
<div class="line"><span class="lineno"> 1521</span>      <span class="keywordflow">case</span> luci::CircleOpcode::NEG:</div>
<div class="line"><span class="lineno"> 1522</span>      <span class="keywordflow">case</span> luci::CircleOpcode::PAD:</div>
<div class="line"><span class="lineno"> 1523</span>      <span class="keywordflow">case</span> luci::CircleOpcode::PADV2:</div>
<div class="line"><span class="lineno"> 1524</span>      <span class="keywordflow">case</span> luci::CircleOpcode::REDUCE_MAX:</div>
<div class="line"><span class="lineno"> 1525</span>      <span class="keywordflow">case</span> luci::CircleOpcode::REDUCE_MIN:</div>
<div class="line"><span class="lineno"> 1526</span>      <span class="keywordflow">case</span> luci::CircleOpcode::RELU:</div>
<div class="line"><span class="lineno"> 1527</span>      <span class="keywordflow">case</span> luci::CircleOpcode::RELU6:</div>
<div class="line"><span class="lineno"> 1528</span>      <span class="keywordflow">case</span> luci::CircleOpcode::RSQRT:</div>
<div class="line"><span class="lineno"> 1529</span>      <span class="keywordflow">case</span> luci::CircleOpcode::SOFTMAX:</div>
<div class="line"><span class="lineno"> 1530</span>      <span class="keywordflow">case</span> luci::CircleOpcode::SPLIT_V:</div>
<div class="line"><span class="lineno"> 1531</span>      <span class="keywordflow">case</span> luci::CircleOpcode::SQUARED_DIFFERENCE:</div>
<div class="line"><span class="lineno"> 1532</span>      <span class="keywordflow">case</span> luci::CircleOpcode::SUB:</div>
<div class="line"><span class="lineno"> 1533</span>        <span class="keywordflow">if</span> (!has_data_format(node))</div>
<div class="line"><span class="lineno"> 1534</span>        {</div>
<div class="line"><span class="lineno"> 1535</span>          set_data_format(node, DataFormat::NCHW);</div>
<div class="line"><span class="lineno"> 1536</span>        }</div>
<div class="line"><span class="lineno"> 1537</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1538</span>      <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno"> 1539</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1540</span>    }</div>
<div class="line"><span class="lineno"> 1541</span>  }</div>
<div class="line"><span class="lineno"> 1542</span> </div>
<div class="line"><span class="lineno"> 1543</span>  <span class="keywordtype">bool</span> changed = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1544</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> node : <a class="code hl_function" href="namespaceloco.html#a91be999912c01878c820e684adc124da">loco::active_nodes</a>(<a class="code hl_function" href="namespaceloco.html#ac026f76015947855f2cecfd0aab1d23a">loco::output_nodes</a>(g)))</div>
<div class="line"><span class="lineno"> 1545</span>  {</div>
<div class="line"><span class="lineno"> 1546</span>    <span class="keywordflow">if</span> (!has_data_format(node))</div>
<div class="line"><span class="lineno"> 1547</span>    {</div>
<div class="line"><span class="lineno"> 1548</span>      <span class="comment">// Unsupported Op</span></div>
<div class="line"><span class="lineno"> 1549</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1550</span>    }</div>
<div class="line"><span class="lineno"> 1551</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (get_data_format(node) == DataFormat::NHWC)</div>
<div class="line"><span class="lineno"> 1552</span>    {</div>
<div class="line"><span class="lineno"> 1553</span>      <span class="comment">// Already converted to NHWC</span></div>
<div class="line"><span class="lineno"> 1554</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1555</span>    }</div>
<div class="line"><span class="lineno"> 1556</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceluci.html#a88465bfcb8ca42ce86cbea2bbaa52400">has_dynamic_shape</a>(node))</div>
<div class="line"><span class="lineno"> 1557</span>    {</div>
<div class="line"><span class="lineno"> 1558</span>      <span class="comment">// This pass only works for static-shaped node</span></div>
<div class="line"><span class="lineno"> 1559</span>      <a class="code hl_define" href="circlechef_2log_2include_2_log_8h.html#a7af9b9d1a859db99acb5e3447167b029">INFO</a>(l) &lt;&lt; <span class="stringliteral">&quot;Skip the node with a dynamic shape.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno"> 1560</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1561</span>    }</div>
<div class="line"><span class="lineno"> 1562</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1563</span>    {</div>
<div class="line"><span class="lineno"> 1564</span>      ConvertNCHWToNHWC converter;</div>
<div class="line"><span class="lineno"> 1565</span>      <span class="keyword">auto</span> circle_node = loco::must_cast&lt;luci::CircleNode *&gt;(node);</div>
<div class="line"><span class="lineno"> 1566</span>      <span class="keywordflow">if</span> (circle_node-&gt;rank() != 4)</div>
<div class="line"><span class="lineno"> 1567</span>      {</div>
<div class="line"><span class="lineno"> 1568</span>        <span class="comment">// TODO replace the check above with the input rank check, and remove the condition below</span></div>
<div class="line"><span class="lineno"> 1569</span>        <span class="keywordflow">if</span> (not <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_mean.html">luci::CircleMean</a> *<span class="keyword">&gt;</span>(node) and</div>
<div class="line"><span class="lineno"> 1570</span>            not <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_reduce_max.html">luci::CircleReduceMax</a> *<span class="keyword">&gt;</span>(node) and</div>
<div class="line"><span class="lineno"> 1571</span>            not <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_reduce_min.html">luci::CircleReduceMin</a> *<span class="keyword">&gt;</span>(node))</div>
<div class="line"><span class="lineno"> 1572</span>          <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1573</span>      }</div>
<div class="line"><span class="lineno"> 1574</span> </div>
<div class="line"><span class="lineno"> 1575</span>      <span class="keywordflow">if</span> (circle_node-&gt;accept(&amp;converter))</div>
<div class="line"><span class="lineno"> 1576</span>      {</div>
<div class="line"><span class="lineno"> 1577</span>        set_data_format(node, DataFormat::NHWC);</div>
<div class="line"><span class="lineno"> 1578</span>        changed = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1579</span>      }</div>
<div class="line"><span class="lineno"> 1580</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1581</span>      {</div>
<div class="line"><span class="lineno"> 1582</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1583</span>      }</div>
<div class="line"><span class="lineno"> 1584</span>    }</div>
<div class="line"><span class="lineno"> 1585</span>  }</div>
<div class="line"><span class="lineno"> 1586</span> </div>
<div class="line"><span class="lineno"> 1587</span>  <a class="code hl_define" href="circlechef_2log_2include_2_log_8h.html#a7af9b9d1a859db99acb5e3447167b029">INFO</a>(l) &lt;&lt; <span class="stringliteral">&quot;ConvertNCHWToNHWCPass End&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno"> 1588</span>  <span class="keywordflow">return</span> changed;</div>
<div class="line"><span class="lineno"> 1589</span>}</div>
<div class="ttc" id="acirclechef_2log_2include_2_log_8h_html_a5495ed6c3fae204a397f0edad87f820e"><div class="ttname"><a href="circlechef_2log_2include_2_log_8h.html#a5495ed6c3fae204a397f0edad87f820e">LOGGER</a></div><div class="ttdeci">#define LOGGER(name)</div><div class="ttdef"><b>Definition:</b> <a href="circlechef_2log_2include_2_log_8h_source.html#l00065">Log.h:65</a></div></div>
<div class="ttc" id="acirclechef_2log_2include_2_log_8h_html_a7af9b9d1a859db99acb5e3447167b029"><div class="ttname"><a href="circlechef_2log_2include_2_log_8h.html#a7af9b9d1a859db99acb5e3447167b029">INFO</a></div><div class="ttdeci">#define INFO(name)</div><div class="ttdef"><b>Definition:</b> <a href="circlechef_2log_2include_2_log_8h_source.html#l00068">Log.h:68</a></div></div>
<div class="ttc" id="aclassloco_1_1_node_html"><div class="ttname"><a href="classloco_1_1_node.html">loco::Node</a></div><div class="ttdoc">Logical unit of computation.</div><div class="ttdef"><b>Definition:</b> <a href="compiler_2loco_2include_2loco_2_i_r_2_node_8h_source.html#l00053">Node.h:54</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_mean_html"><div class="ttname"><a href="classluci_1_1_circle_mean.html">luci::CircleMean</a></div><div class="ttdoc">MEAN in Circle.</div><div class="ttdef"><b>Definition:</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_mean_8h_source.html#l00031">CircleMean.h:32</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_reduce_max_html"><div class="ttname"><a href="classluci_1_1_circle_reduce_max.html">luci::CircleReduceMax</a></div><div class="ttdoc">REDUCE_MAX in Circle.</div><div class="ttdef"><b>Definition:</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_reduce_max_8h_source.html#l00031">CircleReduceMax.h:32</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_reduce_min_html"><div class="ttname"><a href="classluci_1_1_circle_reduce_min.html">luci::CircleReduceMin</a></div><div class="ttdoc">REDUCE_MIN in Circle.</div><div class="ttdef"><b>Definition:</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_reduce_min_8h_source.html#l00031">CircleReduceMin.h:32</a></div></div>
<div class="ttc" id="anamespaceloco_html_a117fa82db86ebda898ee54200c42928d"><div class="ttname"><a href="namespaceloco.html#a117fa82db86ebda898ee54200c42928d">loco::postorder_traversal</a></div><div class="ttdeci">std::vector&lt; loco::Node * &gt; postorder_traversal(const std::vector&lt; loco::Node * &gt; &amp;roots)</div><div class="ttdoc">Generate postorder traversal sequence starting from &quot;roots&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="_algorithm_8cpp_source.html#l00053">Algorithm.cpp:53</a></div></div>
<div class="ttc" id="anamespaceloco_html_a43df4bfde8658322cb87ab5654ba4052"><div class="ttname"><a href="namespaceloco.html#a43df4bfde8658322cb87ab5654ba4052">loco::succs</a></div><div class="ttdeci">std::set&lt; Node * &gt; succs(const Node *node)</div><div class="ttdoc">Enumerate all the successors of a given node.</div><div class="ttdef"><b>Definition:</b> <a href="loco_2src_2_i_r_2_node_8cpp_source.html#l00046">Node.cpp:46</a></div></div>
<div class="ttc" id="anamespaceloco_html_a91be999912c01878c820e684adc124da"><div class="ttname"><a href="namespaceloco.html#a91be999912c01878c820e684adc124da">loco::active_nodes</a></div><div class="ttdeci">std::set&lt; loco::Node * &gt; active_nodes(const std::vector&lt; loco::Node * &gt; &amp;roots)</div><div class="ttdoc">Enumerate all the nodes required to compute &quot;roots&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="_algorithm_8cpp_source.html#l00112">Algorithm.cpp:112</a></div></div>
<div class="ttc" id="anamespaceloco_html_ac026f76015947855f2cecfd0aab1d23a"><div class="ttname"><a href="namespaceloco.html#ac026f76015947855f2cecfd0aab1d23a">loco::output_nodes</a></div><div class="ttdeci">std::vector&lt; Node * &gt; output_nodes(Graph *)</div><div class="ttdef"><b>Definition:</b> <a href="loco_2src_2_i_r_2_graph_8cpp_source.html#l00101">Graph.cpp:101</a></div></div>
<div class="ttc" id="anamespaceluci_html_a88465bfcb8ca42ce86cbea2bbaa52400"><div class="ttname"><a href="namespaceluci.html#a88465bfcb8ca42ce86cbea2bbaa52400">luci::has_dynamic_shape</a></div><div class="ttdeci">bool has_dynamic_shape(const loco::Node *node)</div><div class="ttdef"><b>Definition:</b> <a href="_circle_optimizer_utils_8cpp_source.html#l00024">CircleOptimizerUtils.cpp:24</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_algorithm_8cpp_source.html#l00112">loco::active_nodes()</a>, <a class="el" href="_circle_optimizer_utils_8cpp_source.html#l00024">luci::has_dynamic_shape()</a>, <a class="el" href="circlechef_2log_2include_2_log_8h_source.html#l00068">INFO</a>, <a class="el" href="circlechef_2log_2include_2_log_8h_source.html#l00065">LOGGER</a>, <a class="el" href="loco_2src_2_i_r_2_graph_8cpp_source.html#l00101">loco::output_nodes()</a>, <a class="el" href="_algorithm_8cpp_source.html#l00053">loco::postorder_traversal()</a>, and <a class="el" href="loco_2src_2_i_r_2_node_8cpp_source.html#l00046">loco::succs()</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following files:<ul>
<li>compiler/luci/pass/include/luci/Pass/<a class="el" href="_convert_n_c_h_w_to_n_h_w_c_pass_8h_source.html">ConvertNCHWToNHWCPass.h</a></li>
<li>compiler/luci/pass/src/<a class="el" href="_convert_n_c_h_w_to_n_h_w_c_pass_8cpp_source.html">ConvertNCHWToNHWCPass.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceluci.html">luci</a></li><li class="navelem"><a class="el" href="structluci_1_1_convert_n_c_h_w_to_n_h_w_c_pass.html">ConvertNCHWToNHWCPass</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
