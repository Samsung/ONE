<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ONE - On-device Neural Engine: How to Build Package</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ONE - On-device Neural Engine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_howto_how_to_build_package.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">How to Build Package </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Overview</h1>
<p >This document describes how to build a Package to run the model in our runtime <em>onert</em> that consists of model and additional file(s). Users can build a package through command line tools.</p>
<p >Steps of building a Package:</p><ol type="1">
<li>Import model and convert to circle</li>
</ol>
<ol type="1">
<li>Optionally, optimize and quantize circle</li>
</ol>
<ol type="1">
<li>Create package from circle</li>
</ol>
<p >NOTE: Examples and options of each command shown below are from the version of writing this document. They may differ from latest version of commands, 1.9.0. Please fire an issue or post a PR to correct them if anything needs update.</p>
<h1>Import model</h1>
<p >Currently TensorFlow and TensorFlow lite models are supported as of writing this document.</p>
<p >To import a model, use <code>one-import</code> with a model framework key and arguments. </p><div class="fragment"><div class="line">$ one-import FRAMEWORK [arguments]</div>
</div><!-- fragment --><p >Execute <code>one-import</code> without any key will show the list of supported frameworks.</p>
<p >Example of <code>one-import</code> command: </p><div class="fragment"><div class="line">$ one-import</div>
<div class="line">Usage: one-import [FRAMEWORK] ...</div>
<div class="line">Available FRAMEWORK drivers:</div>
<div class="line">  bcq</div>
<div class="line">  tf</div>
<div class="line">  tflite</div>
</div><!-- fragment --><h2>Example for TensorFlow</h2>
<p >This is an example to import TensorFlow model: </p><div class="fragment"><div class="line">$ one-import tf --input_path mymodel.pb --output_path mymodel.circle \</div>
<div class="line">--input_arrays input1,input2 --input_shapes &quot;1,224,224,3:1000&quot; \</div>
<div class="line">--output_arrays output</div>
</div><!-- fragment --><p >Running with <code>--help</code> will show current required/optional arguments: </p><div class="fragment"><div class="line">$ one-import tf --help</div>
<div class="line">Convert TensorFlow model to circle.</div>
<div class="line">Usage: one-import-tf</div>
<div class="line">    --version Show version information and exit</div>
<div class="line">    --input_path &lt;path/to/tfmodel&gt;</div>
<div class="line">    --output_path &lt;path/to/circle&gt;</div>
<div class="line">    --input_arrays &lt;names of the input arrays, comma-separated&gt;</div>
<div class="line">    --input_shapes &lt;input shapes, colon-separated&gt;</div>
<div class="line">    --output_arrays &lt;names of the output arrays, comma-separated&gt;</div>
<div class="line">    --v2 Use TensorFlow 2.x interface (default is 1.x interface)</div>
</div><!-- fragment --><h2>Example for TensorFlow lite</h2>
<p >This is an example to import TensorFlow lite model: </p><div class="fragment"><div class="line">$ one-import tflite --input_path mymodel.tflite --output_path mymodel.circle</div>
</div><!-- fragment --><p >Likewise, running with <code>--help</code> will show current required/optional arguments: </p><div class="fragment"><div class="line">$ one-import tflite --help</div>
<div class="line">Convert TensorFlow lite model to circle.</div>
<div class="line">Usage: one-import-tflite</div>
<div class="line">    --version Show version information and exit</div>
<div class="line">    --input_path &lt;path/to/tflitemodel&gt;</div>
<div class="line">    --output_path &lt;path/to/circle&gt;</div>
</div><!-- fragment --><h2>Example for TensorFlow Model Including BCQ Information</h2>
<p >This is an example to import TensorFlow model which includes BCQ information. As a result of this command, BCQ information nodes will be preserved. </p><div class="fragment"><div class="line">$ one-import bcq --input_path bcqmodel.pb --output_path bcqmodel.circle</div>
</div><!-- fragment --><p >Likewise, running with <code>--help</code> will show current required/optional arguments: </p><div class="fragment"><div class="line">$ one-import bcq --help</div>
<div class="line">Convert TensorFlow model with BCQ to circle.</div>
<div class="line">Usage: one-import-bcq</div>
<div class="line">    --version Show version information and exit</div>
<div class="line">    --input_path &lt;path/to/tfmodel/with/BCQ&gt;</div>
<div class="line">    --output_path &lt;path/to/circle&gt;</div>
<div class="line">    --input_arrays &lt;names of the input arrays, comma-separated&gt;</div>
<div class="line">    --input_shapes &lt;input shapes, colon-separated&gt;</div>
<div class="line">    --output_arrays &lt;names of the output arrays, comma-separated&gt;</div>
<div class="line">    --v2 Use TensorFlow 2.x interface (default is 1.x interface)</div>
</div><!-- fragment --><h1>Optimize circle model</h1>
<p >circle model can be optimized for better performance and smaller size. Typical optimization algorithm for this is to fuse some patterns of operators to one fused operator.</p>
<p >This is an example to optimize circle model: </p><div class="fragment"><div class="line">$ one-optimize --all --input_path mymodel.circle --output_path optmodel.circle</div>
</div><!-- fragment --><p >Run with <code>--help</code> will show current optimization options: </p><div class="fragment"><div class="line">$ one-optimize --help</div>
<div class="line">Optimize circle model.</div>
<div class="line">Usage: one-optimize</div>
<div class="line">    --version       Show version information and exit</div>
<div class="line">    --all           Enable all optimization algorithms</div>
<div class="line">    --fuse_bcq      Enable FuseBCQ Pass</div>
<div class="line">    --fuse_instnorm Enable FuseInstanceNormalization Pass</div>
<div class="line">    --resolve_customop_add</div>
<div class="line">                    Enable ResolveCustomOpAddPass Pass</div>
<div class="line">    --resolve_customop_batchmatmul</div>
<div class="line">                    Enable ResolveCustomOpBatchMatMulPass Pass</div>
<div class="line">    --resolve_customop_matmul</div>
<div class="line">                    Enable ResolveCustomOpMatMulPass Pass</div>
<div class="line">    --input_path &lt;path/to/input/circle&gt;</div>
<div class="line">    --output_path &lt;path/to/output/circle&gt;</div>
</div><!-- fragment --><h1>Quantize circle model</h1>
<p >Floating-point circle model can be quantized to lower-precision format (e.g., uint8 or int16) for faster inference speed and smaller model size, by reducing the number of bits that represent weights and activations.</p>
<p >This is an example to quantize circle model: </p><div class="fragment"><div class="line">$ one-quantize --input_path mymodel.circle --output_path quantmodel.circle</div>
</div><!-- fragment --><p >Like wise, <code>--help</code> will show current quantization options: </p><div class="fragment"><div class="line">$ one-quantize --help</div>
<div class="line">Quantize circle model.</div>
<div class="line">Usage: one-quantize</div>
<div class="line">    --version         Show version information and exit</div>
<div class="line">    --input_dtype     Input data type (supported: float32, default=float32)</div>
<div class="line">    --quantized_dtype Output quantized data type (supported: uint8, default=uint8)</div>
<div class="line">    --granularity     Quantize granularity (supported: layer, channel, default=layer)</div>
<div class="line">    --min_percentile  Minimum percentile (0.0~100.0, default=1.0)</div>
<div class="line">    --max_percentile  Maximum percentile (0.0~100.0, default=99.0)</div>
<div class="line">    --mode            Record mode (supported: percentile/moving_average, default=percentile)</div>
<div class="line">    --input_path &lt;path/to/input/circle&gt;</div>
<div class="line">    --input_data &lt;path/to/input/data&gt;</div>
<div class="line">    --output_path &lt;path/to/output/circle&gt;</div>
</div><!-- fragment --><h1>Pack circle model</h1>
<p >Use <code>one-pack</code> command to create package.</p>
<div class="fragment"><div class="line">$ one-pack -i mymodel.circle -o nnpackage</div>
</div><!-- fragment --><p ><code>nnpackage</code> is a folder containing circle model and addition file(s)</p>
<div class="fragment"><div class="line">$ tree nnpackage</div>
<div class="line">nnpackage</div>
<div class="line">└── mymodel</div>
<div class="line">    ├── metadata</div>
<div class="line">    │   └── MANIFEST</div>
<div class="line">    └── mymodel.circle</div>
</div><!-- fragment --><p >Likewise, <code>--help</code> will show current package options:</p>
<div class="fragment"><div class="line">$ one-pack --help</div>
<div class="line">Package circle to nnpkg</div>
<div class="line">Usage: one-pack</div>
<div class="line">    -v, --version Show version information and exit</div>
<div class="line">    -i &lt;path/to/circle&gt;</div>
<div class="line">    -o &lt;path/to/nnpackage/folder&gt;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
