<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ONE - On-device Neural Engine: compiler/luci/pass/src/FuseInstanceNormPass.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ONE - On-device Neural Engine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">FuseInstanceNormPass.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="luci_2pass_2include_2luci_2_pass_2_fuse_instance_norm_pass_8h_source.html">luci/Pass/FuseInstanceNormPass.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_node_filler_8h_source.html">helpers/NodeFiller.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_fuse_instance_norm_pass_internal_8h_source.html">FuseInstanceNormPassInternal.h</a>&quot;</code><br />
<code>#include &lt;<a class="el" href="luci_2lang_2include_2luci_2_i_r_2_circle_nodes_8h_source.html">luci/IR/CircleNodes.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="_circle_node_origin_8h_source.html">luci/Profile/CircleNodeOrigin.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="_circle_node_clone_8h_source.html">luci/Service/CircleNodeClone.h</a>&gt;</code><br />
<code>#include &lt;cassert&gt;</code><br />
<code>#include &lt;set&gt;</code><br />
</div>
<p><a href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="namespaces" name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespaceluci" id="r_namespaceluci"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceluci.html">luci</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:afb821ee62cded6ec74a36455b3cfcf51" id="r_afb821ee62cded6ec74a36455b3cfcf51"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(condition)</td></tr>
<tr class="separator:afb821ee62cded6ec74a36455b3cfcf51"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:acc4619ae01f04b7675890043b72dfc65" id="r_acc4619ae01f04b7675890043b72dfc65"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#acc4619ae01f04b7675890043b72dfc65">is_1D_with_dummy_dim</a> (<a class="el" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *node, uint32_t depth)</td></tr>
<tr class="separator:acc4619ae01f04b7675890043b72dfc65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6838e1c63c4fb4442519861b144b5b84" id="r_a6838e1c63c4fb4442519861b144b5b84"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#a6838e1c63c4fb4442519861b144b5b84">is_instance_mean_v1</a> (<a class="el" href="classluci_1_1_circle_mean.html">luci::CircleMean</a> *mean)</td></tr>
<tr class="separator:a6838e1c63c4fb4442519861b144b5b84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7d4f96ffef64ecadd824a9c8a5d0811" id="r_af7d4f96ffef64ecadd824a9c8a5d0811"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#af7d4f96ffef64ecadd824a9c8a5d0811">is_1D_float32_const</a> (const <a class="el" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *node, uint32_t channel_size)</td></tr>
<tr class="separator:af7d4f96ffef64ecadd824a9c8a5d0811"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="afb821ee62cded6ec74a36455b3cfcf51" name="afb821ee62cded6ec74a36455b3cfcf51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb821ee62cded6ec74a36455b3cfcf51">&#9670;&#160;</a></span>CHECK_OR_FALSE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CHECK_OR_FALSE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">condition</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">  <span class="keywordflow">if</span> (not(condition))             \</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp_source.html#l00371">371</a> of file <a class="el" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp_source.html">FuseInstanceNormPass.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  375</span>{</div>
<div class="line"><span class="lineno">  376</span>  add_as_variance = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_add.html">luci::CircleAdd</a> *<span class="keyword">&gt;</span>(rsqrt-&gt;x());</div>
<div class="line"><span class="lineno">  377</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(add_as_variance);</div>
<div class="line"><span class="lineno">  378</span> </div>
<div class="line"><span class="lineno">  379</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(</div>
<div class="line"><span class="lineno">  380</span>    <a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;mean_as_variance, &amp;const_as_epsilon).with_commutative_args_of(add_as_variance));</div>
<div class="line"><span class="lineno">  381</span> </div>
<div class="line"><span class="lineno">  382</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(const_as_epsilon-&gt;dtype() == loco::DataType::FLOAT32);</div>
<div class="line"><span class="lineno">  383</span>  <span class="comment">// TODO Support regarding broadcast</span></div>
<div class="line"><span class="lineno">  384</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(const_as_epsilon-&gt;size&lt;loco::DataType::FLOAT32&gt;() == 1);</div>
<div class="line"><span class="lineno">  385</span> </div>
<div class="line"><span class="lineno">  386</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#a6838e1c63c4fb4442519861b144b5b84">is_instance_mean_v1</a>(mean_as_variance));</div>
<div class="line"><span class="lineno">  387</span> </div>
<div class="line"><span class="lineno">  388</span>  sqdiff = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_squared_difference.html">luci::CircleSquaredDifference</a> *<span class="keyword">&gt;</span>(mean_as_variance-&gt;input());</div>
<div class="line"><span class="lineno">  389</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(sqdiff);</div>
<div class="line"><span class="lineno">  390</span> </div>
<div class="line"><span class="lineno">  391</span>  <a class="code hl_class" href="classloco_1_1_node.html">loco::Node</a> *ifm_should_be = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  392</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;ifm_should_be, &amp;mean_of_ifm).with_commutative_args_of(sqdiff));</div>
<div class="line"><span class="lineno">  393</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm == ifm_should_be);</div>
<div class="line"><span class="lineno">  394</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#a6838e1c63c4fb4442519861b144b5b84">is_instance_mean_v1</a>(mean_of_ifm));</div>
<div class="line"><span class="lineno">  395</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm == mean_of_ifm-&gt;input());</div>
<div class="line"><span class="lineno">  396</span> </div>
<div class="line"><span class="lineno">  397</span>  const_as_beta = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *<span class="keyword">&gt;</span>(sub-&gt;x());</div>
<div class="line"><span class="lineno">  398</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(const_as_beta);</div>
<div class="line"><span class="lineno">  399</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#acc4619ae01f04b7675890043b72dfc65">is_1D_with_dummy_dim</a>(const_as_beta, ifm_channel_depth));</div>
<div class="line"><span class="lineno">  400</span> </div>
<div class="line"><span class="lineno">  401</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  402</span>}</div>
<div class="line"><span class="lineno">  403</span> </div>
<div class="line"><span class="lineno">  404</span><span class="keywordtype">bool</span> InstanceNormPattern::condition_common_3_4()</div>
<div class="line"><span class="lineno">  405</span>{</div>
<div class="line"><span class="lineno">  406</span>  <span class="comment">// check left sub</span></div>
<div class="line"><span class="lineno">  407</span>  ifm = sub-&gt;x();</div>
<div class="line"><span class="lineno">  408</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm);</div>
<div class="line"><span class="lineno">  409</span> </div>
<div class="line"><span class="lineno">  410</span>  <a class="code hl_struct" href="structluci_1_1_circle_node.html">luci::CircleNode</a> *ifm_node = loco::must_cast&lt;luci::CircleNode *&gt;(ifm);</div>
<div class="line"><span class="lineno">  411</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm_node-&gt;rank() == 4);</div>
<div class="line"><span class="lineno">  412</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm_node-&gt;dim(3).known());</div>
<div class="line"><span class="lineno">  413</span> </div>
<div class="line"><span class="lineno">  414</span>  mean_of_ifm = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_mean.html">luci::CircleMean</a> *<span class="keyword">&gt;</span>(sub-&gt;y());</div>
<div class="line"><span class="lineno">  415</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(mean_of_ifm);</div>
<div class="line"><span class="lineno">  416</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm == mean_of_ifm-&gt;input());</div>
<div class="line"><span class="lineno">  417</span> </div>
<div class="line"><span class="lineno">  418</span>  <span class="comment">// continue search from add_as_variance</span></div>
<div class="line"><span class="lineno">  419</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;sqrt, &amp;const_as_epsilon).with_commutative_args_of(add_as_variance));</div>
<div class="line"><span class="lineno">  420</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(const_as_epsilon-&gt;dtype() == loco::DataType::FLOAT32);</div>
<div class="line"><span class="lineno">  421</span>  <span class="comment">// TODO Support regarding broadcast</span></div>
<div class="line"><span class="lineno">  422</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(const_as_epsilon-&gt;size&lt;loco::DataType::FLOAT32&gt;() == 1);</div>
<div class="line"><span class="lineno">  423</span> </div>
<div class="line"><span class="lineno">  424</span>  mean_as_variance = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_mean.html">luci::CircleMean</a> *<span class="keyword">&gt;</span>(sqrt-&gt;x());</div>
<div class="line"><span class="lineno">  425</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(mean_as_variance);</div>
<div class="line"><span class="lineno">  426</span> </div>
<div class="line"><span class="lineno">  427</span>  <a class="code hl_function" href="namespacennfw_1_1cker_1_1train.html#ab73263e409724ca45f5cf2dba525d4b0">square</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_square.html">luci::CircleSquare</a> *<span class="keyword">&gt;</span>(mean_as_variance-&gt;input());</div>
<div class="line"><span class="lineno">  428</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(square);</div>
<div class="line"><span class="lineno">  429</span> </div>
<div class="line"><span class="lineno">  430</span>  sub_2 = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_sub.html">luci::CircleSub</a> *<span class="keyword">&gt;</span>(<a class="code hl_function" href="namespacennfw_1_1cker_1_1train.html#ab73263e409724ca45f5cf2dba525d4b0">square</a>-&gt;x());</div>
<div class="line"><span class="lineno">  431</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(sub_2);</div>
<div class="line"><span class="lineno">  432</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm == sub_2-&gt;x());</div>
<div class="line"><span class="lineno">  433</span> </div>
<div class="line"><span class="lineno">  434</span>  mean_of_ifm_2 = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_mean.html">luci::CircleMean</a> *<span class="keyword">&gt;</span>(sub_2-&gt;y());</div>
<div class="line"><span class="lineno">  435</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(mean_of_ifm_2);</div>
<div class="line"><span class="lineno">  436</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm == mean_of_ifm_2-&gt;input());</div>
<div class="line"><span class="lineno">  437</span> </div>
<div class="line"><span class="lineno">  438</span>  <a class="code hl_class" href="classloco_1_1_node.html">loco::Node</a> *ifm_should_be = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  439</span>  <a class="code hl_class" href="classluci_1_1_circle_mean.html">luci::CircleMean</a> *mean_of_ifm_2_should_be = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  440</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(</div>
<div class="line"><span class="lineno">  441</span>    <a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;ifm_should_be, &amp;mean_of_ifm_2_should_be).with_commutative_args_of(sub_2));</div>
<div class="line"><span class="lineno">  442</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm == ifm_should_be);</div>
<div class="line"><span class="lineno">  443</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(mean_of_ifm_2 == mean_of_ifm_2_should_be);</div>
<div class="line"><span class="lineno">  444</span> </div>
<div class="line"><span class="lineno">  445</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  446</span>}</div>
<div class="line"><span class="lineno">  447</span> </div>
<div class="line"><span class="lineno">  448</span><span class="keyword">template</span> &lt;&gt; <span class="keywordtype">bool</span> InstanceNormPattern::match&lt;InstanceNormPattern::PatternVersion::Version_1&gt;()</div>
<div class="line"><span class="lineno">  449</span>{</div>
<div class="line"><span class="lineno">  450</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;mul_as_scaled_ifm, &amp;sub).with_commutative_args_of(add_as_terminal));</div>
<div class="line"><span class="lineno">  451</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;ifm, &amp;mul_gamma).with_commutative_args_of(mul_as_scaled_ifm));</div>
<div class="line"><span class="lineno">  452</span> </div>
<div class="line"><span class="lineno">  453</span>  <span class="keyword">auto</span> ifm_circle = loco::must_cast&lt;luci::CircleNode *&gt;(ifm);</div>
<div class="line"><span class="lineno">  454</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm_circle-&gt;shape_status() == <a class="code hl_enumvalue" href="namespaceluci.html#afb90d250392bef9190f8277d358e0172ac9f1a6384b1c466d4612f513bd8e13ea">luci::ShapeStatus::VALID</a>);</div>
<div class="line"><span class="lineno">  455</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm_circle-&gt;rank() == 4);</div>
<div class="line"><span class="lineno">  456</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm_circle-&gt;dim(3).known());</div>
<div class="line"><span class="lineno">  457</span>  uint32_t ifm_channel_depth = ifm_circle-&gt;dim(3).value();</div>
<div class="line"><span class="lineno">  458</span> </div>
<div class="line"><span class="lineno">  459</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;rsqrt, &amp;const_as_gamma).with_commutative_args_of(mul_gamma));</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#acc4619ae01f04b7675890043b72dfc65">is_1D_with_dummy_dim</a>(const_as_gamma, ifm_channel_depth));</div>
<div class="line"><span class="lineno">  462</span> </div>
<div class="line"><span class="lineno">  463</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(condition_common_1_5(ifm_channel_depth));</div>
<div class="line"><span class="lineno">  464</span> </div>
<div class="line"><span class="lineno">  465</span>  <a class="code hl_class" href="classluci_1_1_circle_mul.html">luci::CircleMul</a> *mul_gamma_should_be = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  466</span>  <a class="code hl_class" href="classluci_1_1_circle_mean.html">luci::CircleMean</a> *mean_of_ifm_should_be = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  467</span> </div>
<div class="line"><span class="lineno">  468</span>  mul_as_scaled_mean = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_mul.html">luci::CircleMul</a> *<span class="keyword">&gt;</span>(sub-&gt;y());</div>
<div class="line"><span class="lineno">  469</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(mul_as_scaled_mean);</div>
<div class="line"><span class="lineno">  470</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;mul_gamma_should_be, &amp;mean_of_ifm_should_be)</div>
<div class="line"><span class="lineno">  471</span>                   .with_commutative_args_of(mul_as_scaled_mean));</div>
<div class="line"><span class="lineno">  472</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(mul_gamma == mul_gamma_should_be);</div>
<div class="line"><span class="lineno">  473</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(mean_of_ifm == mean_of_ifm_should_be);</div>
<div class="line"><span class="lineno">  474</span> </div>
<div class="line"><span class="lineno">  475</span>  _matched = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  476</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  477</span>}</div>
<div class="line"><span class="lineno">  478</span> </div>
<div class="line"><span class="lineno">  479</span><span class="keyword">template</span> &lt;&gt; <span class="keywordtype">bool</span> InstanceNormPattern::match&lt;InstanceNormPattern::PatternVersion::Version_2&gt;()</div>
<div class="line"><span class="lineno">  480</span>{</div>
<div class="line"><span class="lineno">  481</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;mul_gamma, &amp;const_as_beta).with_commutative_args_of(add_as_terminal));</div>
<div class="line"><span class="lineno">  482</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;div, &amp;const_as_gamma).with_commutative_args_of(mul_gamma));</div>
<div class="line"><span class="lineno">  483</span> </div>
<div class="line"><span class="lineno">  484</span>  sub = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_sub.html">luci::CircleSub</a> *<span class="keyword">&gt;</span>(<a class="code hl_enumvalue" href="namespacennc.html#a958b56e423709246f446a0dd3e7255a9a38696558dc98494c08d951c052900a2a">div</a>-&gt;x());</div>
<div class="line"><span class="lineno">  485</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(sub);</div>
<div class="line"><span class="lineno">  486</span> </div>
<div class="line"><span class="lineno">  487</span>  ifm = sub-&gt;x();</div>
<div class="line"><span class="lineno">  488</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm);</div>
<div class="line"><span class="lineno">  489</span> </div>
<div class="line"><span class="lineno">  490</span>  <a class="code hl_struct" href="structluci_1_1_circle_node.html">luci::CircleNode</a> *ifm_node = loco::must_cast&lt;luci::CircleNode *&gt;(ifm);</div>
<div class="line"><span class="lineno">  491</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm_node-&gt;rank() == 4);</div>
<div class="line"><span class="lineno">  492</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm_node-&gt;dim(3).known());</div>
<div class="line"><span class="lineno">  493</span>  uint32_t ifm_channel_depth = ifm_node-&gt;dim(3).value();</div>
<div class="line"><span class="lineno">  494</span> </div>
<div class="line"><span class="lineno">  495</span>  mean_of_ifm = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_mean.html">luci::CircleMean</a> *<span class="keyword">&gt;</span>(sub-&gt;y());</div>
<div class="line"><span class="lineno">  496</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(mean_of_ifm);</div>
<div class="line"><span class="lineno">  497</span> </div>
<div class="line"><span class="lineno">  498</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm == mean_of_ifm-&gt;input());</div>
<div class="line"><span class="lineno">  499</span> </div>
<div class="line"><span class="lineno">  500</span>  pow = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_pow.html">luci::CirclePow</a> *<span class="keyword">&gt;</span>(<a class="code hl_enumvalue" href="namespacennc.html#a958b56e423709246f446a0dd3e7255a9a38696558dc98494c08d951c052900a2a">div</a>-&gt;y());</div>
<div class="line"><span class="lineno">  501</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(pow);</div>
<div class="line"><span class="lineno">  502</span> </div>
<div class="line"><span class="lineno">  503</span>  add_as_variance = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_add.html">luci::CircleAdd</a> *<span class="keyword">&gt;</span>(pow-&gt;x());</div>
<div class="line"><span class="lineno">  504</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(add_as_variance);</div>
<div class="line"><span class="lineno">  505</span> </div>
<div class="line"><span class="lineno">  506</span>  <a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *zero_point_five = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *<span class="keyword">&gt;</span>(pow-&gt;y());</div>
<div class="line"><span class="lineno">  507</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(zero_point_five);</div>
<div class="line"><span class="lineno">  508</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(zero_point_five-&gt;dtype() == loco::DataType::FLOAT32);</div>
<div class="line"><span class="lineno">  509</span>  <span class="comment">// TODO Support regarding broadcast</span></div>
<div class="line"><span class="lineno">  510</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(zero_point_five-&gt;<a class="code hl_function" href="classluci_1_1_circle_const.html#a8afe1c3255b77a5d8e2a2a8efefdccba">size</a>&lt;loco::DataType::FLOAT32&gt;() == 1);</div>
<div class="line"><span class="lineno">  511</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(zero_point_five-&gt;<a class="code hl_function" href="classluci_1_1_circle_const.html#a1cca76eccd57aa3074a28df5569ead30">at</a>&lt;loco::DataType::FLOAT32&gt;(0) == 0.5);</div>
<div class="line"><span class="lineno">  512</span> </div>
<div class="line"><span class="lineno">  513</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(</div>
<div class="line"><span class="lineno">  514</span>    <a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;mean_as_variance, &amp;const_as_epsilon).with_commutative_args_of(add_as_variance));</div>
<div class="line"><span class="lineno">  515</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(const_as_epsilon-&gt;dtype() == loco::DataType::FLOAT32);</div>
<div class="line"><span class="lineno">  516</span>  <span class="comment">// TODO Support regarding broadcast</span></div>
<div class="line"><span class="lineno">  517</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(const_as_epsilon-&gt;size&lt;loco::DataType::FLOAT32&gt;() == 1);</div>
<div class="line"><span class="lineno">  518</span> </div>
<div class="line"><span class="lineno">  519</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#a6838e1c63c4fb4442519861b144b5b84">is_instance_mean_v1</a>(mean_as_variance));</div>
<div class="line"><span class="lineno">  520</span> </div>
<div class="line"><span class="lineno">  521</span>  sqdiff = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_squared_difference.html">luci::CircleSquaredDifference</a> *<span class="keyword">&gt;</span>(mean_as_variance-&gt;input());</div>
<div class="line"><span class="lineno">  522</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(sqdiff);</div>
<div class="line"><span class="lineno">  523</span> </div>
<div class="line"><span class="lineno">  524</span>  <a class="code hl_class" href="classloco_1_1_node.html">loco::Node</a> *ifm_should_be = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  525</span>  <a class="code hl_class" href="classluci_1_1_circle_mean.html">luci::CircleMean</a> *mean_of_ifm_should_be = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  526</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(</div>
<div class="line"><span class="lineno">  527</span>    <a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;ifm_should_be, &amp;mean_of_ifm_should_be).with_commutative_args_of(sqdiff));</div>
<div class="line"><span class="lineno">  528</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm == ifm_should_be);</div>
<div class="line"><span class="lineno">  529</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(mean_of_ifm == mean_of_ifm_should_be);</div>
<div class="line"><span class="lineno">  530</span> </div>
<div class="line"><span class="lineno">  531</span>  <span class="comment">// Check for channel size</span></div>
<div class="line"><span class="lineno">  532</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#af7d4f96ffef64ecadd824a9c8a5d0811">is_1D_float32_const</a>(const_as_gamma, ifm_channel_depth));</div>
<div class="line"><span class="lineno">  533</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#af7d4f96ffef64ecadd824a9c8a5d0811">is_1D_float32_const</a>(const_as_beta, ifm_channel_depth));</div>
<div class="line"><span class="lineno">  534</span> </div>
<div class="line"><span class="lineno">  535</span>  _matched = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  536</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  537</span>}</div>
<div class="line"><span class="lineno">  538</span> </div>
<div class="line"><span class="lineno">  539</span><span class="keyword">template</span> &lt;&gt; <span class="keywordtype">bool</span> InstanceNormPattern::match&lt;InstanceNormPattern::PatternVersion::Version_3&gt;()</div>
<div class="line"><span class="lineno">  540</span>{</div>
<div class="line"><span class="lineno">  541</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;mul_gamma, &amp;const_as_beta).with_commutative_args_of(add_as_terminal));</div>
<div class="line"><span class="lineno">  542</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;div, &amp;const_as_gamma).with_commutative_args_of(mul_gamma));</div>
<div class="line"><span class="lineno">  543</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;sub, &amp;add_as_variance).with_commutative_args_of(div));</div>
<div class="line"><span class="lineno">  544</span> </div>
<div class="line"><span class="lineno">  545</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(condition_common_3_4());</div>
<div class="line"><span class="lineno">  546</span> </div>
<div class="line"><span class="lineno">  547</span>  _matched = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  548</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  549</span>}</div>
<div class="line"><span class="lineno">  550</span> </div>
<div class="line"><span class="lineno">  551</span><a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *make_const_one(<a class="code hl_class" href="classloco_1_1_graph.html">loco::Graph</a> *graph, <span class="keywordtype">float</span> value)</div>
<div class="line"><span class="lineno">  552</span>{</div>
<div class="line"><span class="lineno">  553</span>  <span class="keyword">auto</span> const_one = <a class="code hl_variable" href="namespace_gen_h5_random_inputs.html#ac7f0f74f10011f31ef450dc70f8918af">graph</a>-&gt;nodes()-&gt;create&lt;<a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a>&gt;();</div>
<div class="line"><span class="lineno">  554</span>  const_one-&gt;dtype(loco::DataType::FLOAT32);</div>
<div class="line"><span class="lineno">  555</span>  const_one-&gt;rank(1);</div>
<div class="line"><span class="lineno">  556</span>  const_one-&gt;<a class="code hl_function" href="classluci_1_1_circle_const.html#a8afe1c3255b77a5d8e2a2a8efefdccba">size</a>&lt;loco::DataType::FLOAT32&gt;(1);</div>
<div class="line"><span class="lineno">  557</span>  const_one-&gt;at&lt;loco::DataType::FLOAT32&gt;(0) = value;</div>
<div class="line"><span class="lineno">  558</span>  <span class="keywordflow">return</span> const_one;</div>
<div class="line"><span class="lineno">  559</span>}</div>
<div class="line"><span class="lineno">  560</span> </div>
<div class="line"><span class="lineno">  561</span><span class="keyword">template</span> &lt;&gt; <span class="keywordtype">bool</span> InstanceNormPattern::match&lt;InstanceNormPattern::PatternVersion::Version_4&gt;()</div>
<div class="line"><span class="lineno">  562</span>{</div>
<div class="line"><span class="lineno">  563</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(div);</div>
<div class="line"><span class="lineno">  564</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;sub, &amp;add_as_variance).with_commutative_args_of(div));</div>
<div class="line"><span class="lineno">  565</span> </div>
<div class="line"><span class="lineno">  566</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(condition_common_3_4());</div>
<div class="line"><span class="lineno">  567</span> </div>
<div class="line"><span class="lineno">  568</span>  assert(const_as_gamma == <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  569</span>  assert(const_as_beta == <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  570</span>  assert(mul_gamma == <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  571</span>  assert(add_as_terminal == <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  572</span> </div>
<div class="line"><span class="lineno">  573</span>  <span class="comment">// create 1.0 gamma and 0.0 beta</span></div>
<div class="line"><span class="lineno">  574</span>  <span class="keyword">auto</span> <a class="code hl_variable" href="namespace_gen_h5_random_inputs.html#ac7f0f74f10011f31ef450dc70f8918af">graph</a> = <a class="code hl_enumvalue" href="namespacennc.html#a958b56e423709246f446a0dd3e7255a9a38696558dc98494c08d951c052900a2a">div</a>-&gt;graph();</div>
<div class="line"><span class="lineno">  575</span>  const_as_gamma = make_const_one(graph, 1.0f);</div>
<div class="line"><span class="lineno">  576</span>  const_as_beta = make_const_one(graph, 0.0f);</div>
<div class="line"><span class="lineno">  577</span>  const_as_gamma-&gt;name(<a class="code hl_enumvalue" href="namespacennc.html#a958b56e423709246f446a0dd3e7255a9a38696558dc98494c08d951c052900a2a">div</a>-&gt;name() + <span class="stringliteral">&quot;/gamma&quot;</span>);</div>
<div class="line"><span class="lineno">  578</span>  const_as_beta-&gt;name(<a class="code hl_enumvalue" href="namespacennc.html#a958b56e423709246f446a0dd3e7255a9a38696558dc98494c08d951c052900a2a">div</a>-&gt;name() + <span class="stringliteral">&quot;/beta&quot;</span>);</div>
<div class="line"><span class="lineno">  579</span> </div>
<div class="line"><span class="lineno">  580</span>  _matched = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  581</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  582</span>}</div>
<div class="line"><span class="lineno">  583</span> </div>
<div class="line"><span class="lineno">  584</span><span class="keyword">template</span> &lt;&gt; <span class="keywordtype">bool</span> InstanceNormPattern::match&lt;InstanceNormPattern::PatternVersion::Version_5&gt;()</div>
<div class="line"><span class="lineno">  585</span>{</div>
<div class="line"><span class="lineno">  586</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;mul_as_scaled_ifm, &amp;sub).with_commutative_args_of(add_as_terminal));</div>
<div class="line"><span class="lineno">  587</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;ifm, &amp;rsqrt).with_commutative_args_of(mul_as_scaled_ifm));</div>
<div class="line"><span class="lineno">  588</span> </div>
<div class="line"><span class="lineno">  589</span>  <span class="keyword">auto</span> ifm_circle = loco::must_cast&lt;luci::CircleNode *&gt;(ifm);</div>
<div class="line"><span class="lineno">  590</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm_circle-&gt;shape_status() == <a class="code hl_enumvalue" href="namespaceluci.html#afb90d250392bef9190f8277d358e0172ac9f1a6384b1c466d4612f513bd8e13ea">luci::ShapeStatus::VALID</a>);</div>
<div class="line"><span class="lineno">  591</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm_circle-&gt;rank() == 4);</div>
<div class="line"><span class="lineno">  592</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(ifm_circle-&gt;dim(3).known());</div>
<div class="line"><span class="lineno">  593</span>  uint32_t ifm_channel_depth = ifm_circle-&gt;dim(3).value();</div>
<div class="line"><span class="lineno">  594</span> </div>
<div class="line"><span class="lineno">  595</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(condition_common_1_5(ifm_channel_depth));</div>
<div class="line"><span class="lineno">  596</span> </div>
<div class="line"><span class="lineno">  597</span>  <a class="code hl_class" href="classluci_1_1_circle_rsqrt.html">luci::CircleRsqrt</a> *rsqrt_should_be = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  598</span>  <a class="code hl_class" href="classluci_1_1_circle_mean.html">luci::CircleMean</a> *mean_of_ifm_should_be = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  599</span> </div>
<div class="line"><span class="lineno">  600</span>  mul_as_scaled_mean = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_mul.html">luci::CircleMul</a> *<span class="keyword">&gt;</span>(sub-&gt;y());</div>
<div class="line"><span class="lineno">  601</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(mul_as_scaled_mean);</div>
<div class="line"><span class="lineno">  602</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(<a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;rsqrt_should_be, &amp;mean_of_ifm_should_be)</div>
<div class="line"><span class="lineno">  603</span>                   .with_commutative_args_of(mul_as_scaled_mean));</div>
<div class="line"><span class="lineno">  604</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(rsqrt == rsqrt_should_be);</div>
<div class="line"><span class="lineno">  605</span>  <a class="code hl_define" href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a>(mean_of_ifm == mean_of_ifm_should_be);</div>
<div class="line"><span class="lineno">  606</span> </div>
<div class="line"><span class="lineno">  607</span>  <span class="comment">// mul_gamma is absent</span></div>
<div class="line"><span class="lineno">  608</span>  <span class="comment">// const_as_gamma assume to be 1.0</span></div>
<div class="line"><span class="lineno">  609</span>  <span class="keyword">auto</span> <a class="code hl_variable" href="namespace_gen_h5_random_inputs.html#ac7f0f74f10011f31ef450dc70f8918af">graph</a> = add_as_terminal-&gt;graph();</div>
<div class="line"><span class="lineno">  610</span>  const_as_gamma = make_const_one(graph, 1.0f);</div>
<div class="line"><span class="lineno">  611</span>  const_as_gamma-&gt;name(add_as_terminal-&gt;name() + <span class="stringliteral">&quot;/gamma&quot;</span>);</div>
<div class="line"><span class="lineno">  612</span> </div>
<div class="line"><span class="lineno">  613</span>  _matched = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  614</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  615</span>}</div>
<div class="line"><span class="lineno">  616</span> </div>
<div class="line"><span class="lineno">  617</span><span class="keywordtype">bool</span> InstanceNormPattern::matched()</div>
<div class="line"><span class="lineno">  618</span>{</div>
<div class="line"><span class="lineno">  619</span>  <span class="keywordflow">if</span> (_matched)</div>
<div class="line"><span class="lineno">  620</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  621</span> </div>
<div class="line"><span class="lineno">  622</span>  <span class="comment">// Check order is DFS</span></div>
<div class="line"><span class="lineno">  623</span> </div>
<div class="line"><span class="lineno">  624</span>  <span class="keywordflow">switch</span> (_pv)</div>
<div class="line"><span class="lineno">  625</span>  {</div>
<div class="line"><span class="lineno">  626</span>    <span class="keywordflow">case</span> PatternVersion::Version_1:</div>
<div class="line"><span class="lineno">  627</span>      <span class="keywordflow">return</span> match&lt;PatternVersion::Version_1&gt;();</div>
<div class="line"><span class="lineno">  628</span>    <span class="keywordflow">case</span> PatternVersion::Version_2:</div>
<div class="line"><span class="lineno">  629</span>      <span class="keywordflow">return</span> match&lt;PatternVersion::Version_2&gt;();</div>
<div class="line"><span class="lineno">  630</span>    <span class="keywordflow">case</span> PatternVersion::Version_3:</div>
<div class="line"><span class="lineno">  631</span>      <span class="keywordflow">return</span> match&lt;PatternVersion::Version_3&gt;();</div>
<div class="line"><span class="lineno">  632</span>    <span class="keywordflow">case</span> PatternVersion::Version_4:</div>
<div class="line"><span class="lineno">  633</span>      <span class="keywordflow">return</span> match&lt;PatternVersion::Version_4&gt;();</div>
<div class="line"><span class="lineno">  634</span>    <span class="keywordflow">case</span> PatternVersion::Version_5:</div>
<div class="line"><span class="lineno">  635</span>      <span class="keywordflow">return</span> match&lt;PatternVersion::Version_5&gt;();</div>
<div class="line"><span class="lineno">  636</span> </div>
<div class="line"><span class="lineno">  637</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  638</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  639</span>  }</div>
<div class="line"><span class="lineno">  640</span> </div>
<div class="line"><span class="lineno">  641</span>  <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Invalid InstanceNorm PatternVersion.&quot;</span>);</div>
<div class="line"><span class="lineno">  642</span>}</div>
<div class="line"><span class="lineno">  643</span> </div>
<div class="line"><span class="lineno">  644</span><span class="preprocessor">#undef CHECK_OR_FALSE</span></div>
<div class="line"><span class="lineno">  645</span> </div>
<div class="line"><span class="lineno">  662</span><span class="keyword">class </span>FuseInstanceNorm final</div>
<div class="line"><span class="lineno">  663</span>{</div>
<div class="line"><span class="lineno">  664</span><span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  665</span>  FuseInstanceNorm(<span class="keyword">const</span> InstanceNormPattern &amp;p) : _p(p) {}</div>
<div class="line"><span class="lineno">  666</span> </div>
<div class="line"><span class="lineno">  667</span><span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  668</span>  <span class="keywordtype">void</span> <a class="code hl_function" href="namespaceloco.html#a2bd813283047d29d83e570f7eef9e42c">apply</a>(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="lineno">  669</span> </div>
<div class="line"><span class="lineno">  670</span><span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">  671</span>  <span class="keyword">template</span> &lt;InstanceNormPattern::PatternVersion&gt; <span class="keywordtype">void</span> <a class="code hl_function" href="namespaceloco.html#a2bd813283047d29d83e570f7eef9e42c">apply</a>(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="lineno">  672</span> </div>
<div class="line"><span class="lineno">  673</span><span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">  674</span>  <span class="keywordtype">void</span> reshape_gamma_beta(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="lineno">  675</span>  <a class="code hl_class" href="classluci_1_1_circle_instance_norm.html">luci::CircleInstanceNorm</a> *create_inst_norm(<a class="code hl_class" href="classloco_1_1_graph.html">loco::Graph</a> *graph);</div>
<div class="line"><span class="lineno">  676</span> </div>
<div class="line"><span class="lineno">  677</span><span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">  678</span>  <span class="keyword">const</span> InstanceNormPattern &amp;_p;</div>
<div class="line"><span class="lineno">  679</span>};</div>
<div class="line"><span class="lineno">  680</span> </div>
<div class="line"><span class="lineno">  681</span><span class="keywordtype">void</span> FuseInstanceNorm::reshape_gamma_beta()</div>
<div class="line"><span class="lineno">  682</span>{</div>
<div class="line"><span class="lineno">  683</span>  <span class="comment">// Version 1 and 3 need to reshape</span></div>
<div class="line"><span class="lineno">  684</span>  {</div>
<div class="line"><span class="lineno">  685</span>    _p.const_as_gamma-&gt;rank(1);</div>
<div class="line"><span class="lineno">  686</span>    _p.const_as_gamma-&gt;dim(0).set(_p.const_as_gamma-&gt;size&lt;loco::DataType::FLOAT32&gt;());</div>
<div class="line"><span class="lineno">  687</span>    _p.const_as_beta-&gt;rank(1);</div>
<div class="line"><span class="lineno">  688</span>    _p.const_as_beta-&gt;dim(0).set(_p.const_as_beta-&gt;size&lt;loco::DataType::FLOAT32&gt;());</div>
<div class="line"><span class="lineno">  689</span> </div>
<div class="line"><span class="lineno">  690</span>    _p.const_as_gamma-&gt;shape_status(<a class="code hl_enumvalue" href="namespaceluci.html#afb90d250392bef9190f8277d358e0172a0db45d2a4141101bdfe48e3314cfbca3">luci::ShapeStatus::UNDEFINED</a>);</div>
<div class="line"><span class="lineno">  691</span>    _p.const_as_beta-&gt;shape_status(<a class="code hl_enumvalue" href="namespaceluci.html#afb90d250392bef9190f8277d358e0172a0db45d2a4141101bdfe48e3314cfbca3">luci::ShapeStatus::UNDEFINED</a>);</div>
<div class="line"><span class="lineno">  692</span>  }</div>
<div class="line"><span class="lineno">  693</span>}</div>
<div class="line"><span class="lineno">  694</span> </div>
<div class="line"><span class="lineno">  695</span><a class="code hl_class" href="classluci_1_1_circle_instance_norm.html">luci::CircleInstanceNorm</a> *FuseInstanceNorm::create_inst_norm(<a class="code hl_class" href="classloco_1_1_graph.html">loco::Graph</a> *graph)</div>
<div class="line"><span class="lineno">  696</span>{</div>
<div class="line"><span class="lineno">  697</span>  <span class="comment">// Make Instance Norm to replace</span></div>
<div class="line"><span class="lineno">  698</span>  <span class="keyword">auto</span> instance_norm = <a class="code hl_variable" href="namespace_gen_h5_random_inputs.html#ac7f0f74f10011f31ef450dc70f8918af">graph</a>-&gt;nodes()-&gt;create&lt;<a class="code hl_class" href="classluci_1_1_circle_instance_norm.html">luci::CircleInstanceNorm</a>&gt;();</div>
<div class="line"><span class="lineno">  699</span>  instance_norm-&gt;<a class="code hl_function" href="classluci_1_1_circle_instance_norm.html#a9ba6981ac025b8d39b3d68b12b5c9596">input</a>(_p.ifm);</div>
<div class="line"><span class="lineno">  700</span>  instance_norm-&gt;gamma(_p.const_as_gamma);</div>
<div class="line"><span class="lineno">  701</span>  instance_norm-&gt;beta(_p.const_as_beta);</div>
<div class="line"><span class="lineno">  702</span>  <span class="keywordtype">float</span> epsilon = _p.const_as_epsilon-&gt;at&lt;loco::DataType::FLOAT32&gt;(0);</div>
<div class="line"><span class="lineno">  703</span>  instance_norm-&gt;epsilon(epsilon);</div>
<div class="line"><span class="lineno">  704</span>  <span class="keywordflow">if</span> (_p.add_as_terminal != <span class="keyword">nullptr</span>)</div>
<div class="line"><span class="lineno">  705</span>  {</div>
<div class="line"><span class="lineno">  706</span>    instance_norm-&gt;fusedActivationFunction(_p.add_as_terminal-&gt;fusedActivationFunction());</div>
<div class="line"><span class="lineno">  707</span>    <span class="comment">// NOTE unique name should be assigned in export</span></div>
<div class="line"><span class="lineno">  708</span>    instance_norm-&gt;name(<span class="stringliteral">&quot;FusedInstanceNorm/&quot;</span> + _p.add_as_terminal-&gt;name());</div>
<div class="line"><span class="lineno">  709</span>  }</div>
<div class="line"><span class="lineno">  710</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  711</span>  {</div>
<div class="line"><span class="lineno">  712</span>    <span class="comment">// VERSION_4</span></div>
<div class="line"><span class="lineno">  713</span>    assert(_p.div != <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  714</span>    instance_norm-&gt;fusedActivationFunction(_p.div-&gt;fusedActivationFunction());</div>
<div class="line"><span class="lineno">  715</span>    instance_norm-&gt;name(<span class="stringliteral">&quot;FusedInstanceNorm/&quot;</span> + _p.div-&gt;name());</div>
<div class="line"><span class="lineno">  716</span>  }</div>
<div class="line"><span class="lineno">  717</span> </div>
<div class="line"><span class="lineno">  718</span>  <span class="keywordflow">return</span> instance_norm;</div>
<div class="line"><span class="lineno">  719</span>}</div>
<div class="line"><span class="lineno">  720</span> </div>
<div class="line"><span class="lineno">  721</span><span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> FuseInstanceNorm::apply&lt;InstanceNormPattern::PatternVersion::Version_1&gt;()</div>
<div class="line"><span class="lineno">  722</span>{</div>
<div class="line"><span class="lineno">  723</span>  <span class="keyword">auto</span> <a class="code hl_variable" href="namespace_gen_h5_random_inputs.html#ac7f0f74f10011f31ef450dc70f8918af">graph</a> = _p.add_as_terminal-&gt;graph();</div>
<div class="line"><span class="lineno">  724</span> </div>
<div class="line"><span class="lineno">  725</span>  reshape_gamma_beta();</div>
<div class="line"><span class="lineno">  726</span> </div>
<div class="line"><span class="lineno">  727</span>  <span class="keyword">auto</span> instance_norm = create_inst_norm(graph);</div>
<div class="line"><span class="lineno">  728</span> </div>
<div class="line"><span class="lineno">  729</span>  <span class="comment">// set origin</span></div>
<div class="line"><span class="lineno">  730</span>  std::vector&lt;std::shared_ptr&lt;luci::CircleNodeOrigin&gt;&gt; origin_vec{</div>
<div class="line"><span class="lineno">  731</span>    luci::get_origin(_p.mean_of_ifm),</div>
<div class="line"><span class="lineno">  732</span>    luci::get_origin(_p.sqdiff),</div>
<div class="line"><span class="lineno">  733</span>    luci::get_origin(_p.mean_as_variance),</div>
<div class="line"><span class="lineno">  734</span>    luci::get_origin(_p.add_as_variance),</div>
<div class="line"><span class="lineno">  735</span>    luci::get_origin(_p.rsqrt),</div>
<div class="line"><span class="lineno">  736</span>    luci::get_origin(_p.mul_gamma),</div>
<div class="line"><span class="lineno">  737</span>    luci::get_origin(_p.mul_as_scaled_ifm),</div>
<div class="line"><span class="lineno">  738</span>    luci::get_origin(_p.mul_as_scaled_mean),</div>
<div class="line"><span class="lineno">  739</span>    luci::get_origin(_p.sub),</div>
<div class="line"><span class="lineno">  740</span>    luci::get_origin(_p.add_as_terminal)};</div>
<div class="line"><span class="lineno">  741</span> </div>
<div class="line"><span class="lineno">  742</span>  luci::add_origin(instance_norm, <a class="code hl_function" href="namespaceluci.html#a39f2a346aed87be9f6be0b865668e387">luci::composite_origin</a>(origin_vec));</div>
<div class="line"><span class="lineno">  743</span> </div>
<div class="line"><span class="lineno">  744</span>  <a class="code hl_function" href="namespaceloco.html#af9c60952072b2f7c290459bfc4aabaf5">replace</a>(_p.add_as_terminal).<a class="code hl_function" href="classloco_1_1_subst_3_01_subst_qualifier_1_1_default_01_4.html#a2c26d1107a76876180e9f3dbfc6fdde0">with</a>(instance_norm);</div>
<div class="line"><span class="lineno">  745</span>}</div>
<div class="line"><span class="lineno">  746</span> </div>
<div class="line"><span class="lineno">  747</span><span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> FuseInstanceNorm::apply&lt;InstanceNormPattern::PatternVersion::Version_2&gt;()</div>
<div class="line"><span class="lineno">  748</span>{</div>
<div class="line"><span class="lineno">  749</span>  <span class="keyword">auto</span> <a class="code hl_variable" href="namespace_gen_h5_random_inputs.html#ac7f0f74f10011f31ef450dc70f8918af">graph</a> = _p.add_as_terminal-&gt;graph();</div>
<div class="line"><span class="lineno">  750</span> </div>
<div class="line"><span class="lineno">  751</span>  <span class="keyword">auto</span> instance_norm = create_inst_norm(graph);</div>
<div class="line"><span class="lineno">  752</span> </div>
<div class="line"><span class="lineno">  753</span>  <span class="comment">// set origin</span></div>
<div class="line"><span class="lineno">  754</span>  std::vector&lt;std::shared_ptr&lt;luci::CircleNodeOrigin&gt;&gt; origin_vec{</div>
<div class="line"><span class="lineno">  755</span>    luci::get_origin(_p.mean_of_ifm),</div>
<div class="line"><span class="lineno">  756</span>    luci::get_origin(_p.sqdiff),</div>
<div class="line"><span class="lineno">  757</span>    luci::get_origin(_p.mean_as_variance),</div>
<div class="line"><span class="lineno">  758</span>    luci::get_origin(_p.add_as_variance),</div>
<div class="line"><span class="lineno">  759</span>    luci::get_origin(_p.pow),</div>
<div class="line"><span class="lineno">  760</span>    luci::get_origin(_p.sub),</div>
<div class="line"><span class="lineno">  761</span>    luci::get_origin(_p.div),</div>
<div class="line"><span class="lineno">  762</span>    luci::get_origin(_p.mul_gamma),</div>
<div class="line"><span class="lineno">  763</span>    luci::get_origin(_p.add_as_terminal)};</div>
<div class="line"><span class="lineno">  764</span> </div>
<div class="line"><span class="lineno">  765</span>  luci::add_origin(instance_norm, <a class="code hl_function" href="namespaceluci.html#a39f2a346aed87be9f6be0b865668e387">luci::composite_origin</a>(origin_vec));</div>
<div class="line"><span class="lineno">  766</span> </div>
<div class="line"><span class="lineno">  767</span>  <a class="code hl_function" href="namespaceloco.html#af9c60952072b2f7c290459bfc4aabaf5">replace</a>(_p.add_as_terminal).<a class="code hl_function" href="classloco_1_1_subst_3_01_subst_qualifier_1_1_default_01_4.html#a2c26d1107a76876180e9f3dbfc6fdde0">with</a>(instance_norm);</div>
<div class="line"><span class="lineno">  768</span>}</div>
<div class="line"><span class="lineno">  769</span> </div>
<div class="line"><span class="lineno">  770</span><span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> FuseInstanceNorm::apply&lt;InstanceNormPattern::PatternVersion::Version_3&gt;()</div>
<div class="line"><span class="lineno">  771</span>{</div>
<div class="line"><span class="lineno">  772</span>  <span class="keyword">auto</span> <a class="code hl_variable" href="namespace_gen_h5_random_inputs.html#ac7f0f74f10011f31ef450dc70f8918af">graph</a> = _p.add_as_terminal-&gt;graph();</div>
<div class="line"><span class="lineno">  773</span> </div>
<div class="line"><span class="lineno">  774</span>  reshape_gamma_beta();</div>
<div class="line"><span class="lineno">  775</span> </div>
<div class="line"><span class="lineno">  776</span>  <span class="keyword">auto</span> instance_norm = create_inst_norm(graph);</div>
<div class="line"><span class="lineno">  777</span> </div>
<div class="line"><span class="lineno">  778</span>  <span class="comment">// set origin</span></div>
<div class="line"><span class="lineno">  779</span>  std::vector&lt;std::shared_ptr&lt;luci::CircleNodeOrigin&gt;&gt; origin_vec{</div>
<div class="line"><span class="lineno">  780</span>    luci::get_origin(_p.mean_of_ifm),</div>
<div class="line"><span class="lineno">  781</span>    luci::get_origin(_p.sub),</div>
<div class="line"><span class="lineno">  782</span>    luci::get_origin(_p.mean_of_ifm_2),</div>
<div class="line"><span class="lineno">  783</span>    luci::get_origin(_p.sub_2),</div>
<div class="line"><span class="lineno">  784</span>    luci::get_origin(_p.square),</div>
<div class="line"><span class="lineno">  785</span>    luci::get_origin(_p.mean_as_variance),</div>
<div class="line"><span class="lineno">  786</span>    luci::get_origin(_p.sqrt),</div>
<div class="line"><span class="lineno">  787</span>    luci::get_origin(_p.add_as_variance),</div>
<div class="line"><span class="lineno">  788</span>    luci::get_origin(_p.div),</div>
<div class="line"><span class="lineno">  789</span>    luci::get_origin(_p.mul_gamma),</div>
<div class="line"><span class="lineno">  790</span>    luci::get_origin(_p.add_as_terminal)};</div>
<div class="line"><span class="lineno">  791</span> </div>
<div class="line"><span class="lineno">  792</span>  luci::add_origin(instance_norm, <a class="code hl_function" href="namespaceluci.html#a39f2a346aed87be9f6be0b865668e387">luci::composite_origin</a>(origin_vec));</div>
<div class="line"><span class="lineno">  793</span> </div>
<div class="line"><span class="lineno">  794</span>  <a class="code hl_function" href="namespaceloco.html#af9c60952072b2f7c290459bfc4aabaf5">replace</a>(_p.add_as_terminal).<a class="code hl_function" href="classloco_1_1_subst_3_01_subst_qualifier_1_1_default_01_4.html#a2c26d1107a76876180e9f3dbfc6fdde0">with</a>(instance_norm);</div>
<div class="line"><span class="lineno">  795</span>}</div>
<div class="line"><span class="lineno">  796</span> </div>
<div class="line"><span class="lineno">  797</span><span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> FuseInstanceNorm::apply&lt;InstanceNormPattern::PatternVersion::Version_4&gt;()</div>
<div class="line"><span class="lineno">  798</span>{</div>
<div class="line"><span class="lineno">  799</span>  <span class="keyword">auto</span> <a class="code hl_variable" href="namespace_gen_h5_random_inputs.html#ac7f0f74f10011f31ef450dc70f8918af">graph</a> = _p.div-&gt;graph();</div>
<div class="line"><span class="lineno">  800</span> </div>
<div class="line"><span class="lineno">  801</span>  <span class="keyword">auto</span> instance_norm = create_inst_norm(graph);</div>
<div class="line"><span class="lineno">  802</span> </div>
<div class="line"><span class="lineno">  803</span>  <span class="comment">// set origin</span></div>
<div class="line"><span class="lineno">  804</span>  std::vector&lt;std::shared_ptr&lt;luci::CircleNodeOrigin&gt;&gt; origin_vec{</div>
<div class="line"><span class="lineno">  805</span>    luci::get_origin(_p.mean_of_ifm),</div>
<div class="line"><span class="lineno">  806</span>    luci::get_origin(_p.sub),</div>
<div class="line"><span class="lineno">  807</span>    luci::get_origin(_p.mean_of_ifm_2),</div>
<div class="line"><span class="lineno">  808</span>    luci::get_origin(_p.sub_2),</div>
<div class="line"><span class="lineno">  809</span>    luci::get_origin(_p.square),</div>
<div class="line"><span class="lineno">  810</span>    luci::get_origin(_p.mean_as_variance),</div>
<div class="line"><span class="lineno">  811</span>    luci::get_origin(_p.sqrt),</div>
<div class="line"><span class="lineno">  812</span>    luci::get_origin(_p.add_as_variance),</div>
<div class="line"><span class="lineno">  813</span>    luci::get_origin(_p.div)};</div>
<div class="line"><span class="lineno">  814</span> </div>
<div class="line"><span class="lineno">  815</span>  luci::add_origin(instance_norm, <a class="code hl_function" href="namespaceluci.html#a39f2a346aed87be9f6be0b865668e387">luci::composite_origin</a>(origin_vec));</div>
<div class="line"><span class="lineno">  816</span> </div>
<div class="line"><span class="lineno">  817</span>  <a class="code hl_function" href="namespaceloco.html#af9c60952072b2f7c290459bfc4aabaf5">replace</a>(_p.div).<a class="code hl_function" href="classloco_1_1_subst_3_01_subst_qualifier_1_1_default_01_4.html#a2c26d1107a76876180e9f3dbfc6fdde0">with</a>(instance_norm);</div>
<div class="line"><span class="lineno">  818</span>}</div>
<div class="line"><span class="lineno">  819</span> </div>
<div class="line"><span class="lineno">  820</span><span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> FuseInstanceNorm::apply&lt;InstanceNormPattern::PatternVersion::Version_5&gt;()</div>
<div class="line"><span class="lineno">  821</span>{</div>
<div class="line"><span class="lineno">  822</span>  <span class="keyword">auto</span> <a class="code hl_variable" href="namespace_gen_h5_random_inputs.html#ac7f0f74f10011f31ef450dc70f8918af">graph</a> = _p.add_as_terminal-&gt;graph();</div>
<div class="line"><span class="lineno">  823</span> </div>
<div class="line"><span class="lineno">  824</span>  reshape_gamma_beta();</div>
<div class="line"><span class="lineno">  825</span> </div>
<div class="line"><span class="lineno">  826</span>  <span class="keyword">auto</span> instance_norm = create_inst_norm(graph);</div>
<div class="line"><span class="lineno">  827</span> </div>
<div class="line"><span class="lineno">  828</span>  <span class="comment">// set origin</span></div>
<div class="line"><span class="lineno">  829</span>  std::vector&lt;std::shared_ptr&lt;luci::CircleNodeOrigin&gt;&gt; origin_vec{</div>
<div class="line"><span class="lineno">  830</span>    luci::get_origin(_p.mean_of_ifm),</div>
<div class="line"><span class="lineno">  831</span>    luci::get_origin(_p.sqdiff),</div>
<div class="line"><span class="lineno">  832</span>    luci::get_origin(_p.mean_as_variance),</div>
<div class="line"><span class="lineno">  833</span>    luci::get_origin(_p.add_as_variance),</div>
<div class="line"><span class="lineno">  834</span>    luci::get_origin(_p.rsqrt),</div>
<div class="line"><span class="lineno">  835</span>    luci::get_origin(_p.mul_as_scaled_ifm),</div>
<div class="line"><span class="lineno">  836</span>    luci::get_origin(_p.mul_as_scaled_mean),</div>
<div class="line"><span class="lineno">  837</span>    luci::get_origin(_p.sub),</div>
<div class="line"><span class="lineno">  838</span>    luci::get_origin(_p.add_as_terminal)};</div>
<div class="line"><span class="lineno">  839</span> </div>
<div class="line"><span class="lineno">  840</span>  luci::add_origin(instance_norm, <a class="code hl_function" href="namespaceluci.html#a39f2a346aed87be9f6be0b865668e387">luci::composite_origin</a>(origin_vec));</div>
<div class="line"><span class="lineno">  841</span> </div>
<div class="line"><span class="lineno">  842</span>  <a class="code hl_function" href="namespaceloco.html#af9c60952072b2f7c290459bfc4aabaf5">replace</a>(_p.add_as_terminal).<a class="code hl_function" href="classloco_1_1_subst_3_01_subst_qualifier_1_1_default_01_4.html#a2c26d1107a76876180e9f3dbfc6fdde0">with</a>(instance_norm);</div>
<div class="line"><span class="lineno">  843</span>}</div>
<div class="line"><span class="lineno">  844</span> </div>
<div class="line"><span class="lineno">  845</span><span class="keywordtype">void</span> FuseInstanceNorm::apply()</div>
<div class="line"><span class="lineno">  846</span>{</div>
<div class="line"><span class="lineno">  847</span>  assert(_p.matched());</div>
<div class="line"><span class="lineno">  848</span> </div>
<div class="line"><span class="lineno">  849</span>  <span class="keywordflow">switch</span> (_p.version())</div>
<div class="line"><span class="lineno">  850</span>  {</div>
<div class="line"><span class="lineno">  851</span>    <span class="keywordflow">case</span> InstanceNormPattern::PatternVersion::Version_1:</div>
<div class="line"><span class="lineno">  852</span>      apply&lt;InstanceNormPattern::PatternVersion::Version_1&gt;();</div>
<div class="line"><span class="lineno">  853</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  854</span>    <span class="keywordflow">case</span> InstanceNormPattern::PatternVersion::Version_2:</div>
<div class="line"><span class="lineno">  855</span>      apply&lt;InstanceNormPattern::PatternVersion::Version_2&gt;();</div>
<div class="line"><span class="lineno">  856</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  857</span>    <span class="keywordflow">case</span> InstanceNormPattern::PatternVersion::Version_3:</div>
<div class="line"><span class="lineno">  858</span>      apply&lt;InstanceNormPattern::PatternVersion::Version_3&gt;();</div>
<div class="line"><span class="lineno">  859</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  860</span>    <span class="keywordflow">case</span> InstanceNormPattern::PatternVersion::Version_4:</div>
<div class="line"><span class="lineno">  861</span>      apply&lt;InstanceNormPattern::PatternVersion::Version_4&gt;();</div>
<div class="line"><span class="lineno">  862</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  863</span>    <span class="keywordflow">case</span> InstanceNormPattern::PatternVersion::Version_5:</div>
<div class="line"><span class="lineno">  864</span>      apply&lt;InstanceNormPattern::PatternVersion::Version_5&gt;();</div>
<div class="line"><span class="lineno">  865</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  866</span> </div>
<div class="line"><span class="lineno">  867</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  868</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  869</span>  }</div>
<div class="line"><span class="lineno">  870</span>}</div>
<div class="line"><span class="lineno">  871</span> </div>
<div class="line"><span class="lineno">  872</span>} <span class="comment">// namespace</span></div>
<div class="line"><span class="lineno">  873</span> </div>
<div class="line"><span class="lineno">  874</span><span class="keyword">namespace</span></div>
<div class="line"><span class="lineno">  875</span>{</div>
<div class="line"><span class="lineno">  876</span> </div>
<div class="line"><span class="lineno">  877</span><span class="keyword">class </span>PostFusion final</div>
<div class="line"><span class="lineno">  878</span>{</div>
<div class="line"><span class="lineno">  879</span><span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  880</span>  PostFusion(<a class="code hl_class" href="classluci_1_1_circle_instance_norm.html">luci::CircleInstanceNorm</a> *inst_norm) : _inst_norm(inst_norm) {}</div>
<div class="line"><span class="lineno">  881</span> </div>
<div class="line"><span class="lineno">  882</span><span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">  883</span>  uint32_t input_channel(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="lineno">  884</span> </div>
<div class="line"><span class="lineno">  885</span>  <a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *match_const_channel(<a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *, uint32_t);</div>
<div class="line"><span class="lineno">  886</span>  <span class="keywordtype">bool</span> match_const_gamma_channel(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="lineno">  887</span>  <span class="keywordtype">bool</span> match_const_beta_channel(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="lineno">  888</span> </div>
<div class="line"><span class="lineno">  889</span><span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  890</span>  <span class="keywordtype">bool</span> <a class="code hl_variable" href="namespacevalidate__onnx2circle.html#aab02d6caf7220d2aaea2dd17c148f89d">process</a>(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="lineno">  891</span> </div>
<div class="line"><span class="lineno">  892</span><span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">  893</span>  <a class="code hl_class" href="classluci_1_1_circle_instance_norm.html">luci::CircleInstanceNorm</a> *_inst_norm = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  894</span>};</div>
<div class="line"><span class="lineno">  895</span> </div>
<div class="line"><span class="lineno">  899</span>uint32_t PostFusion::input_channel(<span class="keywordtype">void</span>)</div>
<div class="line"><span class="lineno">  900</span>{</div>
<div class="line"><span class="lineno">  901</span>  <span class="keyword">auto</span> <a class="code hl_enumvalue" href="namespacemir__caffe.html#a80d91a921af9e0cb352bf83b19ed18c8aa43c1b0aa53a0c908810c06ab1ff3967">input</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_struct" href="structluci_1_1_circle_node.html">luci::CircleNode</a> *<span class="keyword">&gt;</span>(_inst_norm-&gt;input());</div>
<div class="line"><span class="lineno">  902</span>  <span class="keywordflow">if</span> (input == <span class="keyword">nullptr</span>)</div>
<div class="line"><span class="lineno">  903</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  904</span>  <span class="keywordflow">if</span> (<a class="code hl_enumvalue" href="namespacemir__caffe.html#a80d91a921af9e0cb352bf83b19ed18c8aa43c1b0aa53a0c908810c06ab1ff3967">input</a>-&gt;shape_status() != <a class="code hl_enumvalue" href="namespaceluci.html#afb90d250392bef9190f8277d358e0172ac9f1a6384b1c466d4612f513bd8e13ea">luci::ShapeStatus::VALID</a>)</div>
<div class="line"><span class="lineno">  905</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  906</span> </div>
<div class="line"><span class="lineno">  907</span>  <span class="keyword">auto</span> input_rank = <a class="code hl_enumvalue" href="namespacemir__caffe.html#a80d91a921af9e0cb352bf83b19ed18c8aa43c1b0aa53a0c908810c06ab1ff3967">input</a>-&gt;rank();</div>
<div class="line"><span class="lineno">  908</span>  <span class="keywordflow">if</span> (input_rank &lt; 1)</div>
<div class="line"><span class="lineno">  909</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  910</span> </div>
<div class="line"><span class="lineno">  911</span>  <span class="comment">// assume channel-last</span></div>
<div class="line"><span class="lineno">  912</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacemir__caffe.html#a80d91a921af9e0cb352bf83b19ed18c8aa43c1b0aa53a0c908810c06ab1ff3967">input</a>-&gt;dim(input_rank - 1).value();</div>
<div class="line"><span class="lineno">  913</span>}</div>
<div class="line"><span class="lineno">  914</span> </div>
<div class="line"><span class="lineno">  918</span><a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *PostFusion::match_const_channel(<a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *input_const, uint32_t C)</div>
<div class="line"><span class="lineno">  919</span>{</div>
<div class="line"><span class="lineno">  920</span>  <a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *new_input_const = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  921</span> </div>
<div class="line"><span class="lineno">  922</span>  <span class="keyword">auto</span> input_chn = input_const-&gt;dim(0).value();</div>
<div class="line"><span class="lineno">  923</span>  <span class="keywordflow">if</span> (input_chn == 1 &amp;&amp; input_chn != C)</div>
<div class="line"><span class="lineno">  924</span>  {</div>
<div class="line"><span class="lineno">  925</span>    <span class="keywordtype">float</span> value = input_const-&gt;<a class="code hl_function" href="classluci_1_1_circle_const.html#a1cca76eccd57aa3074a28df5569ead30">at</a>&lt;loco::DataType::FLOAT32&gt;(0);</div>
<div class="line"><span class="lineno">  926</span>    <span class="keyword">auto</span> <a class="code hl_function" href="namespaceluci.html#a8984ba83d6f0e6d0dc99b25ee3b5d04b">clone</a> = <a class="code hl_function" href="namespaceluci.html#a8727d0fa490008c6078181d4a27f3ca2">luci::clone_node</a>(input_const, input_const-&gt;<a class="code hl_function" href="classloco_1_1_node.html#a117bfe99976cf71eb9d85f4b018f26ad">graph</a>());</div>
<div class="line"><span class="lineno">  927</span> </div>
<div class="line"><span class="lineno">  928</span>    new_input_const = loco::must_cast&lt;luci::CircleConst *&gt;(clone);</div>
<div class="line"><span class="lineno">  929</span>    new_input_const-&gt;rank(1);</div>
<div class="line"><span class="lineno">  930</span>    new_input_const-&gt;dim(0).set(C);</div>
<div class="line"><span class="lineno">  931</span>    new_input_const-&gt;<a class="code hl_function" href="classluci_1_1_circle_const.html#a8afe1c3255b77a5d8e2a2a8efefdccba">size</a>&lt;loco::DataType::FLOAT32&gt;(C);</div>
<div class="line"><span class="lineno">  932</span>    <span class="keywordflow">for</span> (uint32_t c = 0; c &lt; C; ++c)</div>
<div class="line"><span class="lineno">  933</span>      new_input_const-&gt;<a class="code hl_function" href="classluci_1_1_circle_const.html#a1cca76eccd57aa3074a28df5569ead30">at</a>&lt;loco::DataType::FLOAT32&gt;(c) = value;</div>
<div class="line"><span class="lineno">  934</span>  }</div>
<div class="line"><span class="lineno">  935</span> </div>
<div class="line"><span class="lineno">  936</span>  <span class="keywordflow">return</span> new_input_const;</div>
<div class="line"><span class="lineno">  937</span>}</div>
<div class="line"><span class="lineno">  938</span> </div>
<div class="line"><span class="lineno">  942</span><span class="keywordtype">bool</span> PostFusion::match_const_gamma_channel(<span class="keywordtype">void</span>)</div>
<div class="line"><span class="lineno">  943</span>{</div>
<div class="line"><span class="lineno">  944</span>  <span class="keyword">auto</span> const_as_gamma = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *<span class="keyword">&gt;</span>(_inst_norm-&gt;gamma());</div>
<div class="line"><span class="lineno">  945</span>  <span class="keywordflow">if</span> (const_as_gamma == <span class="keyword">nullptr</span>)</div>
<div class="line"><span class="lineno">  946</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  947</span> </div>
<div class="line"><span class="lineno">  948</span>  <span class="keyword">auto</span> C = input_channel();</div>
<div class="line"><span class="lineno">  949</span>  <span class="keywordflow">if</span> (C == 0)</div>
<div class="line"><span class="lineno">  950</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  951</span> </div>
<div class="line"><span class="lineno">  952</span>  <span class="keyword">auto</span> new_const_as_gamma = match_const_channel(const_as_gamma, C);</div>
<div class="line"><span class="lineno">  953</span>  <span class="keywordflow">if</span> (new_const_as_gamma == <span class="keyword">nullptr</span>)</div>
<div class="line"><span class="lineno">  954</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  955</span> </div>
<div class="line"><span class="lineno">  956</span>  _inst_norm-&gt;gamma(new_const_as_gamma);</div>
<div class="line"><span class="lineno">  957</span> </div>
<div class="line"><span class="lineno">  958</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  959</span>}</div>
<div class="line"><span class="lineno">  960</span> </div>
<div class="line"><span class="lineno">  964</span><span class="keywordtype">bool</span> PostFusion::match_const_beta_channel(<span class="keywordtype">void</span>)</div>
<div class="line"><span class="lineno">  965</span>{</div>
<div class="line"><span class="lineno">  966</span>  <span class="keyword">auto</span> const_as_beta = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *<span class="keyword">&gt;</span>(_inst_norm-&gt;beta());</div>
<div class="line"><span class="lineno">  967</span>  <span class="keywordflow">if</span> (const_as_beta == <span class="keyword">nullptr</span>)</div>
<div class="line"><span class="lineno">  968</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  969</span> </div>
<div class="line"><span class="lineno">  970</span>  <span class="keyword">auto</span> C = input_channel();</div>
<div class="line"><span class="lineno">  971</span>  <span class="keywordflow">if</span> (C == 0)</div>
<div class="line"><span class="lineno">  972</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  973</span> </div>
<div class="line"><span class="lineno">  974</span>  <span class="keyword">auto</span> new_const_as_beta = match_const_channel(const_as_beta, C);</div>
<div class="line"><span class="lineno">  975</span>  <span class="keywordflow">if</span> (new_const_as_beta == <span class="keyword">nullptr</span>)</div>
<div class="line"><span class="lineno">  976</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  977</span> </div>
<div class="line"><span class="lineno">  978</span>  _inst_norm-&gt;beta(new_const_as_beta);</div>
<div class="line"><span class="lineno">  979</span> </div>
<div class="line"><span class="lineno">  980</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  981</span>}</div>
<div class="line"><span class="lineno">  982</span> </div>
<div class="line"><span class="lineno">  983</span><span class="keywordtype">bool</span> PostFusion::process(<span class="keywordtype">void</span>)</div>
<div class="line"><span class="lineno">  984</span>{</div>
<div class="line"><span class="lineno">  985</span>  <span class="keywordtype">bool</span> changed = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  986</span> </div>
<div class="line"><span class="lineno">  987</span>  <span class="keywordflow">if</span> (match_const_gamma_channel())</div>
<div class="line"><span class="lineno">  988</span>    changed = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  989</span>  <span class="keywordflow">if</span> (match_const_beta_channel())</div>
<div class="line"><span class="lineno">  990</span>    changed = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  991</span> </div>
<div class="line"><span class="lineno">  992</span>  <span class="keywordflow">return</span> changed;</div>
<div class="line"><span class="lineno">  993</span>}</div>
<div class="line"><span class="lineno">  994</span> </div>
<div class="line"><span class="lineno">  995</span>} <span class="comment">// namespace</span></div>
<div class="line"><span class="lineno">  996</span> </div>
<div class="line"><span class="lineno">  997</span><span class="keyword">namespace</span></div>
<div class="line"><span class="lineno">  998</span>{</div>
<div class="line"><span class="lineno">  999</span> </div>
<div class="line"><span class="lineno"> 1000</span><span class="keywordtype">bool</span> is_add_input_mul_const(<a class="code hl_class" href="classluci_1_1_circle_add.html">luci::CircleAdd</a> *add)</div>
<div class="line"><span class="lineno"> 1001</span>{</div>
<div class="line"><span class="lineno"> 1002</span>  <a class="code hl_class" href="classluci_1_1_circle_mul.html">luci::CircleMul</a> *p_mul = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno"> 1003</span>  <a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *p_const = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno"> 1004</span> </div>
<div class="line"><span class="lineno"> 1005</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a>(&amp;p_mul, &amp;p_const).with_commutative_args_of(add);</div>
<div class="line"><span class="lineno"> 1006</span>}</div>
<div class="line"><span class="lineno"> 1007</span> </div>
<div class="line"><span class="lineno"> 1008</span><span class="keywordtype">bool</span> fuse_instance_norm(<a class="code hl_class" href="classluci_1_1_circle_add.html">luci::CircleAdd</a> *add)</div>
<div class="line"><span class="lineno"> 1009</span>{</div>
<div class="line"><span class="lineno"> 1010</span>  InstanceNormPattern::PatternVersion pv = InstanceNormPattern::PatternVersion::Version_1;</div>
<div class="line"><span class="lineno"> 1011</span> </div>
<div class="line"><span class="lineno"> 1012</span>  <span class="keywordflow">if</span> (is_add_input_mul_const(add))</div>
<div class="line"><span class="lineno"> 1013</span>    pv = InstanceNormPattern::PatternVersion::Version_2;</div>
<div class="line"><span class="lineno"> 1014</span> </div>
<div class="line"><span class="lineno"> 1015</span>  InstanceNormPattern pattern(add, pv);</div>
<div class="line"><span class="lineno"> 1016</span>  <span class="keywordflow">if</span> (pattern.matched())</div>
<div class="line"><span class="lineno"> 1017</span>  {</div>
<div class="line"><span class="lineno"> 1018</span>    FuseInstanceNorm fuse(pattern);</div>
<div class="line"><span class="lineno"> 1019</span>    fuse.apply();</div>
<div class="line"><span class="lineno"> 1020</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1021</span>  }</div>
<div class="line"><span class="lineno"> 1022</span> </div>
<div class="line"><span class="lineno"> 1023</span>  <span class="keywordflow">if</span> (pv == InstanceNormPattern::PatternVersion::Version_1)</div>
<div class="line"><span class="lineno"> 1024</span>  {</div>
<div class="line"><span class="lineno"> 1025</span>    <span class="comment">// if Version_1 failed, try with Version_5</span></div>
<div class="line"><span class="lineno"> 1026</span>    pv = InstanceNormPattern::PatternVersion::Version_5;</div>
<div class="line"><span class="lineno"> 1027</span>    InstanceNormPattern pattern(add, pv);</div>
<div class="line"><span class="lineno"> 1028</span>    <span class="keywordflow">if</span> (pattern.matched())</div>
<div class="line"><span class="lineno"> 1029</span>    {</div>
<div class="line"><span class="lineno"> 1030</span>      FuseInstanceNorm fuse(pattern);</div>
<div class="line"><span class="lineno"> 1031</span>      fuse.apply();</div>
<div class="line"><span class="lineno"> 1032</span>      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1033</span>    }</div>
<div class="line"><span class="lineno"> 1034</span>  }</div>
<div class="line"><span class="lineno"> 1035</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pv == InstanceNormPattern::PatternVersion::Version_2)</div>
<div class="line"><span class="lineno"> 1036</span>  {</div>
<div class="line"><span class="lineno"> 1037</span>    <span class="comment">// if Version_2 failed, try with Version_3</span></div>
<div class="line"><span class="lineno"> 1038</span>    pv = InstanceNormPattern::PatternVersion::Version_3;</div>
<div class="line"><span class="lineno"> 1039</span>    InstanceNormPattern pattern(add, pv);</div>
<div class="line"><span class="lineno"> 1040</span>    <span class="keywordflow">if</span> (pattern.matched())</div>
<div class="line"><span class="lineno"> 1041</span>    {</div>
<div class="line"><span class="lineno"> 1042</span>      FuseInstanceNorm fuse(pattern);</div>
<div class="line"><span class="lineno"> 1043</span>      fuse.apply();</div>
<div class="line"><span class="lineno"> 1044</span>      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1045</span>    }</div>
<div class="line"><span class="lineno"> 1046</span>  }</div>
<div class="line"><span class="lineno"> 1047</span> </div>
<div class="line"><span class="lineno"> 1048</span>  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1049</span>}</div>
<div class="line"><span class="lineno"> 1050</span> </div>
<div class="line"><span class="lineno"> 1051</span><span class="keywordtype">bool</span> fuse_instance_norm(<a class="code hl_class" href="classluci_1_1_circle_div.html">luci::CircleDiv</a> *div)</div>
<div class="line"><span class="lineno"> 1052</span>{</div>
<div class="line"><span class="lineno"> 1053</span>  InstanceNormPattern::PatternVersion pv = InstanceNormPattern::PatternVersion::Version_4;</div>
<div class="line"><span class="lineno"> 1054</span> </div>
<div class="line"><span class="lineno"> 1055</span>  InstanceNormPattern pattern(div, pv);</div>
<div class="line"><span class="lineno"> 1056</span>  <span class="keywordflow">if</span> (pattern.matched())</div>
<div class="line"><span class="lineno"> 1057</span>  {</div>
<div class="line"><span class="lineno"> 1058</span>    FuseInstanceNorm fuse(pattern);</div>
<div class="line"><span class="lineno"> 1059</span>    fuse.apply();</div>
<div class="line"><span class="lineno"> 1060</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1061</span>  }</div>
<div class="line"><span class="lineno"> 1062</span> </div>
<div class="line"><span class="lineno"> 1063</span>  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1064</span>}</div>
<div class="line"><span class="lineno"> 1065</span> </div>
<div class="line"><span class="lineno"> 1066</span><span class="keywordtype">bool</span> post_fusion(<a class="code hl_class" href="classluci_1_1_circle_instance_norm.html">luci::CircleInstanceNorm</a> *inst_norm)</div>
<div class="line"><span class="lineno"> 1067</span>{</div>
<div class="line"><span class="lineno"> 1068</span>  PostFusion postfusion(inst_norm);</div>
<div class="line"><span class="lineno"> 1069</span> </div>
<div class="line"><span class="lineno"> 1070</span>  <span class="keywordflow">return</span> postfusion.process();</div>
<div class="line"><span class="lineno"> 1071</span>}</div>
<div class="line"><span class="lineno"> 1072</span> </div>
<div class="line"><span class="lineno"> 1073</span>} <span class="comment">// namespace</span></div>
<div class="line"><span class="lineno"> 1074</span> </div>
<div class="line"><span class="lineno"> 1075</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceluci.html">luci</a></div>
<div class="line"><span class="lineno"> 1076</span>{</div>
<div class="line"><span class="lineno"> 1077</span> </div>
<div class="line"><span class="lineno"> 1078</span><span class="keywordtype">bool</span> <a class="code hl_function" href="structluci_1_1_fuse_instance_norm_pass.html#a86529e8117ad4d2e853f1720e649bb10">FuseInstanceNormPass::run</a>(<a class="code hl_class" href="classloco_1_1_graph.html">loco::Graph</a> *g)</div>
<div class="line"><span class="lineno"> 1079</span>{</div>
<div class="line"><span class="lineno"> 1080</span>  <span class="keywordtype">bool</span> changed = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1081</span> </div>
<div class="line"><span class="lineno"> 1082</span>  <span class="comment">// Check Version_1, Version_2, Version_3, Version_5</span></div>
<div class="line"><span class="lineno"> 1083</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> node : <a class="code hl_namespace" href="namespaceloco.html">loco</a>::<a class="code hl_function" href="namespaceloco.html#a91be999912c01878c820e684adc124da">active_nodes</a>(<a class="code hl_namespace" href="namespaceloco.html">loco</a>::<a class="code hl_function" href="namespaceloco.html#ac026f76015947855f2cecfd0aab1d23a">output_nodes</a>(<a class="code hl_variable" href="namespace_gen_h5_random_inputs.html#a7210f017c15aa9fb47b012adefcf31dd">g</a>)))</div>
<div class="line"><span class="lineno"> 1084</span>  {</div>
<div class="line"><span class="lineno"> 1085</span>    <span class="keyword">auto</span> <a class="code hl_enumvalue" href="namespacemir__caffe2.html#ad673211adad8f4f6c0abf122bd4e54e8a34ec78fcc91ffb1e54cd85e4a0924332">add</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_add.html">luci::CircleAdd</a> *<span class="keyword">&gt;</span>(node);</div>
<div class="line"><span class="lineno"> 1086</span>    <span class="keywordflow">if</span> (not add)</div>
<div class="line"><span class="lineno"> 1087</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1088</span> </div>
<div class="line"><span class="lineno"> 1089</span>    <span class="keywordflow">if</span> (fuse_instance_norm(add))</div>
<div class="line"><span class="lineno"> 1090</span>      changed = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1091</span>  }</div>
<div class="line"><span class="lineno"> 1092</span> </div>
<div class="line"><span class="lineno"> 1093</span>  <span class="comment">// Check Version_4(from DIV) if MUL-ADD pattern is not found</span></div>
<div class="line"><span class="lineno"> 1094</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> node : <a class="code hl_namespace" href="namespaceloco.html">loco</a>::<a class="code hl_function" href="namespaceloco.html#a91be999912c01878c820e684adc124da">active_nodes</a>(<a class="code hl_namespace" href="namespaceloco.html">loco</a>::<a class="code hl_function" href="namespaceloco.html#ac026f76015947855f2cecfd0aab1d23a">output_nodes</a>(<a class="code hl_variable" href="namespace_gen_h5_random_inputs.html#a7210f017c15aa9fb47b012adefcf31dd">g</a>)))</div>
<div class="line"><span class="lineno"> 1095</span>  {</div>
<div class="line"><span class="lineno"> 1096</span>    <span class="keyword">auto</span> <a class="code hl_enumvalue" href="namespacennc.html#a958b56e423709246f446a0dd3e7255a9a38696558dc98494c08d951c052900a2a">div</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_div.html">luci::CircleDiv</a> *<span class="keyword">&gt;</span>(node);</div>
<div class="line"><span class="lineno"> 1097</span>    <span class="keywordflow">if</span> (not div)</div>
<div class="line"><span class="lineno"> 1098</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1099</span> </div>
<div class="line"><span class="lineno"> 1100</span>    <span class="keywordflow">if</span> (fuse_instance_norm(div))</div>
<div class="line"><span class="lineno"> 1101</span>      changed = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1102</span>  }</div>
<div class="line"><span class="lineno"> 1103</span> </div>
<div class="line"><span class="lineno"> 1104</span>  <span class="comment">// Post processing of FuseInstanceNorm</span></div>
<div class="line"><span class="lineno"> 1105</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> node : <a class="code hl_namespace" href="namespaceloco.html">loco</a>::<a class="code hl_function" href="namespaceloco.html#a91be999912c01878c820e684adc124da">active_nodes</a>(<a class="code hl_namespace" href="namespaceloco.html">loco</a>::<a class="code hl_function" href="namespaceloco.html#ac026f76015947855f2cecfd0aab1d23a">output_nodes</a>(<a class="code hl_variable" href="namespace_gen_h5_random_inputs.html#a7210f017c15aa9fb47b012adefcf31dd">g</a>)))</div>
<div class="line"><span class="lineno"> 1106</span>  {</div>
<div class="line"><span class="lineno"> 1107</span>    <span class="keyword">auto</span> inst_norm = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_instance_norm.html">luci::CircleInstanceNorm</a> *<span class="keyword">&gt;</span>(node);</div>
<div class="line"><span class="lineno"> 1108</span>    <span class="keywordflow">if</span> (not inst_norm)</div>
<div class="line"><span class="lineno"> 1109</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1110</span> </div>
<div class="line"><span class="lineno"> 1111</span>    <span class="keywordflow">if</span> (post_fusion(inst_norm))</div>
<div class="line"><span class="lineno"> 1112</span>      changed = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1113</span>  }</div>
<div class="line"><span class="lineno"> 1114</span> </div>
<div class="line"><span class="lineno"> 1115</span>  <span class="keywordflow">return</span> changed;</div>
<div class="line"><span class="lineno"> 1116</span>}</div>
<div class="line"><span class="lineno"> 1117</span> </div>
<div class="line"><span class="lineno"> 1118</span>} <span class="comment">// namespace luci</span></div>
<div class="ttc" id="aclassloco_1_1_graph_html"><div class="ttname"><a href="classloco_1_1_graph.html">loco::Graph</a></div><div class="ttdoc">A neural network graph.</div><div class="ttdef"><b>Definition</b> <a href="compiler_2loco_2include_2loco_2_i_r_2_graph_8h_source.html#l00160">Graph.h:161</a></div></div>
<div class="ttc" id="aclassloco_1_1_node_html"><div class="ttname"><a href="classloco_1_1_node.html">loco::Node</a></div><div class="ttdoc">Logical unit of computation.</div><div class="ttdef"><b>Definition</b> <a href="compiler_2loco_2include_2loco_2_i_r_2_node_8h_source.html#l00053">Node.h:54</a></div></div>
<div class="ttc" id="aclassloco_1_1_node_html_a117bfe99976cf71eb9d85f4b018f26ad"><div class="ttname"><a href="classloco_1_1_node.html#a117bfe99976cf71eb9d85f4b018f26ad">loco::Node::graph</a></div><div class="ttdeci">Graph * graph(void)</div><div class="ttdef"><b>Definition</b> <a href="compiler_2loco_2include_2loco_2_i_r_2_node_8h_source.html#l00070">Node.h:70</a></div></div>
<div class="ttc" id="aclassloco_1_1_subst_3_01_subst_qualifier_1_1_default_01_4_html_a2c26d1107a76876180e9f3dbfc6fdde0"><div class="ttname"><a href="classloco_1_1_subst_3_01_subst_qualifier_1_1_default_01_4.html#a2c26d1107a76876180e9f3dbfc6fdde0">loco::Subst&lt; SubstQualifier::Default &gt;::with</a></div><div class="ttdeci">void with(Node *into) const</div><div class="ttdef"><b>Definition</b> <a href="loco_2src_2_i_r_2_node_8cpp_source.html#l00066">Node.cpp:66</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_add_html"><div class="ttname"><a href="classluci_1_1_circle_add.html">luci::CircleAdd</a></div><div class="ttdoc">ADD in Circle.</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_add_8h_source.html#l00032">CircleAdd.h:34</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_const_html"><div class="ttname"><a href="classluci_1_1_circle_const.html">luci::CircleConst</a></div><div class="ttdoc">Class to build tensor data.</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_const_8h_source.html#l00034">CircleConst.h:35</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_const_html_a1cca76eccd57aa3074a28df5569ead30"><div class="ttname"><a href="classluci_1_1_circle_const.html#a1cca76eccd57aa3074a28df5569ead30">luci::CircleConst::at</a></div><div class="ttdeci">const loco::DataTypeImpl&lt; DT &gt;::Type &amp; at(uint32_t n) const</div><div class="ttdef"><b>Definition</b> <a href="lang_2src_2_nodes_2_circle_const_8cpp_source.html#l00038">CircleConst.cpp:38</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_const_html_a8afe1c3255b77a5d8e2a2a8efefdccba"><div class="ttname"><a href="classluci_1_1_circle_const.html#a8afe1c3255b77a5d8e2a2a8efefdccba">luci::CircleConst::size</a></div><div class="ttdeci">uint32_t size(void) const</div><div class="ttdef"><b>Definition</b> <a href="lang_2src_2_nodes_2_circle_const_8cpp_source.html#l00024">CircleConst.cpp:24</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_div_html"><div class="ttname"><a href="classluci_1_1_circle_div.html">luci::CircleDiv</a></div><div class="ttdoc">DIV in Circle.</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_div_8h_source.html#l00035">CircleDiv.h:37</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_instance_norm_html"><div class="ttname"><a href="classluci_1_1_circle_instance_norm.html">luci::CircleInstanceNorm</a></div><div class="ttdoc">INSTANCE_NORM in Circle.</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_instance_norm_8h_source.html#l00032">CircleInstanceNorm.h:35</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_instance_norm_html_a9ba6981ac025b8d39b3d68b12b5c9596"><div class="ttname"><a href="classluci_1_1_circle_instance_norm.html#a9ba6981ac025b8d39b3d68b12b5c9596">luci::CircleInstanceNorm::input</a></div><div class="ttdeci">loco::Node * input(void) const</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_instance_norm_8h_source.html#l00038">CircleInstanceNorm.h:38</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_mean_html"><div class="ttname"><a href="classluci_1_1_circle_mean.html">luci::CircleMean</a></div><div class="ttdoc">MEAN in Circle.</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_mean_8h_source.html#l00031">CircleMean.h:32</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_mul_html"><div class="ttname"><a href="classluci_1_1_circle_mul.html">luci::CircleMul</a></div><div class="ttdoc">MUL in Circle.</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_mul_8h_source.html#l00032">CircleMul.h:34</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_pow_html"><div class="ttname"><a href="classluci_1_1_circle_pow.html">luci::CirclePow</a></div><div class="ttdoc">POW in Circle.</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_pow_8h_source.html#l00031">CirclePow.h:32</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_rsqrt_html"><div class="ttname"><a href="classluci_1_1_circle_rsqrt.html">luci::CircleRsqrt</a></div><div class="ttdoc">RSQRT in Circle.</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_rsqrt_8h_source.html#l00031">CircleRsqrt.h:32</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_square_html"><div class="ttname"><a href="classluci_1_1_circle_square.html">luci::CircleSquare</a></div><div class="ttdoc">SQUARE in Circle.</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_square_8h_source.html#l00031">CircleSquare.h:32</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_squared_difference_html"><div class="ttname"><a href="classluci_1_1_circle_squared_difference.html">luci::CircleSquaredDifference</a></div><div class="ttdoc">SQUARED_DIFFERENCE in Circle.</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_squared_difference_8h_source.html#l00031">CircleSquaredDifference.h:33</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_sub_html"><div class="ttname"><a href="classluci_1_1_circle_sub.html">luci::CircleSub</a></div><div class="ttdoc">SUB in Circle.</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_sub_8h_source.html#l00032">CircleSub.h:34</a></div></div>
<div class="ttc" id="aexo_2src_2_pass_2_fuse_instance_norm_pass_8cpp_html_afb821ee62cded6ec74a36455b3cfcf51"><div class="ttname"><a href="exo_2src_2_pass_2_fuse_instance_norm_pass_8cpp.html#afb821ee62cded6ec74a36455b3cfcf51">CHECK_OR_FALSE</a></div><div class="ttdeci">#define CHECK_OR_FALSE(condition)</div></div>
<div class="ttc" id="aluci_2pass_2src_2_fuse_instance_norm_pass_8cpp_html_a6838e1c63c4fb4442519861b144b5b84"><div class="ttname"><a href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#a6838e1c63c4fb4442519861b144b5b84">is_instance_mean_v1</a></div><div class="ttdeci">bool is_instance_mean_v1(luci::CircleMean *mean)</div><div class="ttdef"><b>Definition</b> <a href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp_source.html#l00044">FuseInstanceNormPass.cpp:44</a></div></div>
<div class="ttc" id="aluci_2pass_2src_2_fuse_instance_norm_pass_8cpp_html_acc4619ae01f04b7675890043b72dfc65"><div class="ttname"><a href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#acc4619ae01f04b7675890043b72dfc65">is_1D_with_dummy_dim</a></div><div class="ttdeci">bool is_1D_with_dummy_dim(luci::CircleConst *node, uint32_t depth)</div><div class="ttdef"><b>Definition</b> <a href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp_source.html#l00032">FuseInstanceNormPass.cpp:32</a></div></div>
<div class="ttc" id="aluci_2pass_2src_2_fuse_instance_norm_pass_8cpp_html_af7d4f96ffef64ecadd824a9c8a5d0811"><div class="ttname"><a href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html#af7d4f96ffef64ecadd824a9c8a5d0811">is_1D_float32_const</a></div><div class="ttdeci">bool is_1D_float32_const(const luci::CircleConst *node, uint32_t channel_size)</div><div class="ttdef"><b>Definition</b> <a href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp_source.html#l00089">FuseInstanceNormPass.cpp:89</a></div></div>
<div class="ttc" id="anamespace_gen_h5_random_inputs_html_a7210f017c15aa9fb47b012adefcf31dd"><div class="ttname"><a href="namespace_gen_h5_random_inputs.html#a7210f017c15aa9fb47b012adefcf31dd">GenH5RandomInputs.g</a></div><div class="ttdeci">g</div><div class="ttdef"><b>Definition</b> <a href="_gen_h5_random_inputs_8py_source.html#l00062">GenH5RandomInputs.py:62</a></div></div>
<div class="ttc" id="anamespace_gen_h5_random_inputs_html_ac7f0f74f10011f31ef450dc70f8918af"><div class="ttname"><a href="namespace_gen_h5_random_inputs.html#ac7f0f74f10011f31ef450dc70f8918af">GenH5RandomInputs.graph</a></div><div class="ttdeci">graph</div><div class="ttdef"><b>Definition</b> <a href="_gen_h5_random_inputs_8py_source.html#l00048">GenH5RandomInputs.py:48</a></div></div>
<div class="ttc" id="anamespaceloco_html"><div class="ttname"><a href="namespaceloco.html">loco</a></div><div class="ttdef"><b>Definition</b> <a href="exo_2src_2_log_helper_8cpp_source.html#l00019">LogHelper.cpp:20</a></div></div>
<div class="ttc" id="anamespaceloco_html_a2bd813283047d29d83e570f7eef9e42c"><div class="ttname"><a href="namespaceloco.html#a2bd813283047d29d83e570f7eef9e42c">loco::apply</a></div><div class="ttdeci">ShapeInferenceSession apply(ShapeInferenceRule *r)</div><div class="ttdef"><b>Definition</b> <a href="compiler_2loco_2include_2loco_2_service_2_shape_inference_8h_source.html#l00051">ShapeInference.h:51</a></div></div>
<div class="ttc" id="anamespaceloco_html_a91be999912c01878c820e684adc124da"><div class="ttname"><a href="namespaceloco.html#a91be999912c01878c820e684adc124da">loco::active_nodes</a></div><div class="ttdeci">std::set&lt; loco::Node * &gt; active_nodes(const std::vector&lt; loco::Node * &gt; &amp;roots)</div><div class="ttdoc">Enumerate all the nodes required to compute &quot;roots&quot;.</div><div class="ttdef"><b>Definition</b> <a href="_algorithm_8cpp_source.html#l00112">Algorithm.cpp:112</a></div></div>
<div class="ttc" id="anamespaceloco_html_ac026f76015947855f2cecfd0aab1d23a"><div class="ttname"><a href="namespaceloco.html#ac026f76015947855f2cecfd0aab1d23a">loco::output_nodes</a></div><div class="ttdeci">std::vector&lt; Node * &gt; output_nodes(Graph *)</div><div class="ttdef"><b>Definition</b> <a href="loco_2src_2_i_r_2_graph_8cpp_source.html#l00101">Graph.cpp:101</a></div></div>
<div class="ttc" id="anamespaceloco_html_af9c60952072b2f7c290459bfc4aabaf5"><div class="ttname"><a href="namespaceloco.html#af9c60952072b2f7c290459bfc4aabaf5">loco::replace</a></div><div class="ttdeci">Subst&lt; SubstQualifier::Default &gt; replace(Node *node)</div><div class="ttdef"><b>Definition</b> <a href="loco_2src_2_i_r_2_node_8cpp_source.html#l00082">Node.cpp:82</a></div></div>
<div class="ttc" id="anamespaceluci_html"><div class="ttname"><a href="namespaceluci.html">luci</a></div><div class="ttdef"><b>Definition</b> <a href="compiler_2luci-compute_2include_2luci__compute_2_depthwise_conv2_d_8h_source.html#l00023">DepthwiseConv2D.h:24</a></div></div>
<div class="ttc" id="anamespaceluci_html_a39f2a346aed87be9f6be0b865668e387"><div class="ttname"><a href="namespaceluci.html#a39f2a346aed87be9f6be0b865668e387">luci::composite_origin</a></div><div class="ttdeci">std::shared_ptr&lt; CircleNodeOrigin &gt; composite_origin(const std::initializer_list&lt; std::shared_ptr&lt; CircleNodeOrigin &gt; &gt; origins)</div><div class="ttdef"><b>Definition</b> <a href="_circle_node_origin_8cpp_source.html#l00126">CircleNodeOrigin.cpp:126</a></div></div>
<div class="ttc" id="anamespaceluci_html_a42d14615f9017302a47525c8b603965a"><div class="ttname"><a href="namespaceluci.html#a42d14615f9017302a47525c8b603965a">luci::fill</a></div><div class="ttdeci">NodeFiller&lt; ARG_TYPE_1, ARG_TYPE_2 &gt; fill(ARG_TYPE_1 **arg_1, ARG_TYPE_2 **arg_2)</div><div class="ttdef"><b>Definition</b> <a href="_node_filler_8h_source.html#l00072">NodeFiller.h:72</a></div></div>
<div class="ttc" id="anamespaceluci_html_a8727d0fa490008c6078181d4a27f3ca2"><div class="ttname"><a href="namespaceluci.html#a8727d0fa490008c6078181d4a27f3ca2">luci::clone_node</a></div><div class="ttdeci">CircleNode * clone_node(const CircleNode *node, loco::Graph *graph)</div><div class="ttdoc">Return a new cloned CircleNode object with same attributes value of node to graph.</div><div class="ttdef"><b>Definition</b> <a href="_circle_node_clone_8cpp_source.html#l00070">CircleNodeClone.cpp:70</a></div></div>
<div class="ttc" id="anamespaceluci_html_a8984ba83d6f0e6d0dc99b25ee3b5d04b"><div class="ttname"><a href="namespaceluci.html#a8984ba83d6f0e6d0dc99b25ee3b5d04b">luci::clone</a></div><div class="ttdeci">luci::CircleConst * clone(luci::CircleConst *node)</div><div class="ttdoc">Return cloned object of CircleConst node.</div><div class="ttdef"><b>Definition</b> <a href="service_2src_2_nodes_2_circle_const_8cpp_source.html#l00107">CircleConst.cpp:107</a></div></div>
<div class="ttc" id="anamespaceluci_html_afb90d250392bef9190f8277d358e0172a0db45d2a4141101bdfe48e3314cfbca3"><div class="ttname"><a href="namespaceluci.html#afb90d250392bef9190f8277d358e0172a0db45d2a4141101bdfe48e3314cfbca3">luci::ShapeStatus::UNDEFINED</a></div><div class="ttdeci">@ UNDEFINED</div></div>
<div class="ttc" id="anamespaceluci_html_afb90d250392bef9190f8277d358e0172ac9f1a6384b1c466d4612f513bd8e13ea"><div class="ttname"><a href="namespaceluci.html#afb90d250392bef9190f8277d358e0172ac9f1a6384b1c466d4612f513bd8e13ea">luci::ShapeStatus::VALID</a></div><div class="ttdeci">@ VALID</div></div>
<div class="ttc" id="anamespacemir__caffe2_html_ad673211adad8f4f6c0abf122bd4e54e8a34ec78fcc91ffb1e54cd85e4a0924332"><div class="ttname"><a href="namespacemir__caffe2.html#ad673211adad8f4f6c0abf122bd4e54e8a34ec78fcc91ffb1e54cd85e4a0924332">mir_caffe2::SupportedCaffe2OpType::add</a></div><div class="ttdeci">@ add</div></div>
<div class="ttc" id="anamespacemir__caffe_html_a80d91a921af9e0cb352bf83b19ed18c8aa43c1b0aa53a0c908810c06ab1ff3967"><div class="ttname"><a href="namespacemir__caffe.html#a80d91a921af9e0cb352bf83b19ed18c8aa43c1b0aa53a0c908810c06ab1ff3967">mir_caffe::CaffeOpType::input</a></div><div class="ttdeci">@ input</div></div>
<div class="ttc" id="anamespacennc_html_a958b56e423709246f446a0dd3e7255a9a38696558dc98494c08d951c052900a2a"><div class="ttname"><a href="namespacennc.html#a958b56e423709246f446a0dd3e7255a9a38696558dc98494c08d951c052900a2a">nnc::ArtifactBinOp::div</a></div><div class="ttdeci">@ div</div></div>
<div class="ttc" id="anamespacennfw_1_1cker_1_1train_html_ab73263e409724ca45f5cf2dba525d4b0"><div class="ttname"><a href="namespacennfw_1_1cker_1_1train.html#ab73263e409724ca45f5cf2dba525d4b0">nnfw::cker::train::square</a></div><div class="ttdeci">T square(T value)</div><div class="ttdef"><b>Definition</b> <a href="compute_2cker_2include_2cker_2train_2operation_2_loss_8h_source.html#l00032">Loss.h:32</a></div></div>
<div class="ttc" id="anamespacevalidate__onnx2circle_html_aab02d6caf7220d2aaea2dd17c148f89d"><div class="ttname"><a href="namespacevalidate__onnx2circle.html#aab02d6caf7220d2aaea2dd17c148f89d">validate_onnx2circle.process</a></div><div class="ttdeci">process</div><div class="ttdef"><b>Definition</b> <a href="validate__onnx2circle_8py_source.html#l00116">validate_onnx2circle.py:116</a></div></div>
<div class="ttc" id="astructluci_1_1_circle_node_html"><div class="ttname"><a href="structluci_1_1_circle_node.html">luci::CircleNode</a></div><div class="ttdef"><b>Definition</b> <a href="luci_2lang_2include_2luci_2_i_r_2_circle_node_decl_8h_source.html#l00037">CircleNodeDecl.h:40</a></div></div>
<div class="ttc" id="astructluci_1_1_fuse_instance_norm_pass_html_a86529e8117ad4d2e853f1720e649bb10"><div class="ttname"><a href="structluci_1_1_fuse_instance_norm_pass.html#a86529e8117ad4d2e853f1720e649bb10">luci::FuseInstanceNormPass::run</a></div><div class="ttdeci">bool run(loco::Graph *g) final</div><div class="ttdoc">Run the pass.</div><div class="ttdef"><b>Definition</b> <a href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp_source.html#l01079">FuseInstanceNormPass.cpp:1079</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="af7d4f96ffef64ecadd824a9c8a5d0811" name="af7d4f96ffef64ecadd824a9c8a5d0811"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7d4f96ffef64ecadd824a9c8a5d0811">&#9670;&#160;</a></span>is_1D_float32_const()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool is_1D_float32_const </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>channel_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>true When node has the shape of 1D channel_size </dd></dl>

<p class="definition">Definition at line <a class="el" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp_source.html#l00089">89</a> of file <a class="el" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp_source.html">FuseInstanceNormPass.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   90</span>{</div>
<div class="line"><span class="lineno">   91</span>  <span class="keywordflow">if</span> (node-&gt;rank() != 1)</div>
<div class="line"><span class="lineno">   92</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   93</span> </div>
<div class="line"><span class="lineno">   94</span>  <span class="keywordflow">if</span> (node-&gt;dim(0).value() != channel_size)</div>
<div class="line"><span class="lineno">   95</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>  <span class="keywordflow">if</span> (node-&gt;dtype() != loco::DataType::FLOAT32)</div>
<div class="line"><span class="lineno">   98</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   99</span> </div>
<div class="line"><span class="lineno">  100</span>  <span class="keywordflow">if</span> (node-&gt;<a class="code hl_function" href="classluci_1_1_circle_const.html#a8afe1c3255b77a5d8e2a2a8efefdccba">size</a>&lt;loco::DataType::FLOAT32&gt;() != channel_size)</div>
<div class="line"><span class="lineno">  101</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  104</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lang_2src_2_nodes_2_circle_const_8cpp_source.html#l00024">luci::CircleConst::size()</a>.</p>

</div>
</div>
<a id="acc4619ae01f04b7675890043b72dfc65" name="acc4619ae01f04b7675890043b72dfc65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc4619ae01f04b7675890043b72dfc65">&#9670;&#160;</a></span>is_1D_with_dummy_dim()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool is_1D_with_dummy_dim </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>depth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>true When node has shape of '1 x .. x 1 x depth' </dd></dl>

<p class="definition">Definition at line <a class="el" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp_source.html#l00032">32</a> of file <a class="el" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp_source.html">FuseInstanceNormPass.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   33</span>{</div>
<div class="line"><span class="lineno">   34</span>  <span class="keyword">auto</span> rank = node-&gt;rank();</div>
<div class="line"><span class="lineno">   35</span>  uint32_t axis;</div>
<div class="line"><span class="lineno">   36</span>  <span class="keywordflow">for</span> (axis = 0; axis &lt; rank - 1; ++axis)</div>
<div class="line"><span class="lineno">   37</span>  {</div>
<div class="line"><span class="lineno">   38</span>    <span class="keywordflow">if</span> (node-&gt;dim(axis).value() != 1)</div>
<div class="line"><span class="lineno">   39</span>      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   40</span>  }</div>
<div class="line"><span class="lineno">   41</span>  <span class="keywordflow">return</span> node-&gt;dim(axis).value() == depth;</div>
<div class="line"><span class="lineno">   42</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6838e1c63c4fb4442519861b144b5b84" name="a6838e1c63c4fb4442519861b144b5b84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6838e1c63c4fb4442519861b144b5b84">&#9670;&#160;</a></span>is_instance_mean_v1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool is_instance_mean_v1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classluci_1_1_circle_mean.html">luci::CircleMean</a> *&#160;</td>
          <td class="paramname"><em>mean</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp_source.html#l00044">44</a> of file <a class="el" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp_source.html">FuseInstanceNormPass.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   45</span>{</div>
<div class="line"><span class="lineno">   46</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno">   47</span>  <span class="comment">// CHECK 1) input is rank 4</span></div>
<div class="line"><span class="lineno">   48</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno">   49</span>  <span class="keyword">auto</span> <a class="code hl_enumvalue" href="namespacemir__caffe.html#a80d91a921af9e0cb352bf83b19ed18c8aa43c1b0aa53a0c908810c06ab1ff3967">input</a> = loco::must_cast&lt;luci::CircleNode *&gt;(mean-&gt;<a class="code hl_function" href="classluci_1_1_circle_mean.html#a2bacd2ead2af3fba77e23a7cba03ebb2">input</a>());</div>
<div class="line"><span class="lineno">   50</span>  <span class="keywordflow">if</span> (<a class="code hl_enumvalue" href="namespacemir__caffe.html#a80d91a921af9e0cb352bf83b19ed18c8aa43c1b0aa53a0c908810c06ab1ff3967">input</a>-&gt;shape_status() != <a class="code hl_enumvalue" href="namespaceluci.html#afb90d250392bef9190f8277d358e0172ac9f1a6384b1c466d4612f513bd8e13ea">luci::ShapeStatus::VALID</a>)</div>
<div class="line"><span class="lineno">   51</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   52</span>  <span class="keywordflow">if</span> (<a class="code hl_enumvalue" href="namespacemir__caffe.html#a80d91a921af9e0cb352bf83b19ed18c8aa43c1b0aa53a0c908810c06ab1ff3967">input</a>-&gt;rank() != 4)</div>
<div class="line"><span class="lineno">   53</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   54</span> </div>
<div class="line"><span class="lineno">   55</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno">   56</span>  <span class="comment">// CHECK 2) &#39;reduction indices&#39; is CircleConst of value [1,2], that is HW of NHWC</span></div>
<div class="line"><span class="lineno">   57</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno">   58</span>  <span class="comment">// TODO Support equivalent case, like [-3,-2]</span></div>
<div class="line"><span class="lineno">   59</span>  <span class="comment">// TODO Support non-Const case?</span></div>
<div class="line"><span class="lineno">   60</span>  <span class="comment">// TODO What if input is NCHW format in Circle?</span></div>
<div class="line"><span class="lineno">   61</span>  <span class="keyword">auto</span> red_indices = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classluci_1_1_circle_const.html">luci::CircleConst</a> *<span class="keyword">&gt;</span>(mean-&gt;<a class="code hl_function" href="classluci_1_1_circle_mean.html#a9f29f2f5c7486ba1b27285d7c92c15e2">reduction_indices</a>());</div>
<div class="line"><span class="lineno">   62</span>  <span class="keywordflow">if</span> (not red_indices)</div>
<div class="line"><span class="lineno">   63</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   64</span>  <span class="keywordflow">if</span> (red_indices-&gt;rank() != 1)</div>
<div class="line"><span class="lineno">   65</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   66</span>  std::set&lt;int32_t&gt; red_indices_set;</div>
<div class="line"><span class="lineno">   67</span>  {</div>
<div class="line"><span class="lineno">   68</span>    <span class="comment">// TODO Currently only support S32, support other types</span></div>
<div class="line"><span class="lineno">   69</span>    assert(red_indices-&gt;dtype() == loco::DataType::S32);</div>
<div class="line"><span class="lineno">   70</span>    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; red_indices-&gt;dim(0).value(); ++i)</div>
<div class="line"><span class="lineno">   71</span>      red_indices_set.insert(red_indices-&gt;at&lt;loco::DataType::S32&gt;(i));</div>
<div class="line"><span class="lineno">   72</span>  }</div>
<div class="line"><span class="lineno">   73</span>  <span class="keywordflow">if</span> (red_indices_set.size() != 2)</div>
<div class="line"><span class="lineno">   74</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   75</span>  <span class="keywordflow">if</span> (red_indices_set.find(1) == red_indices_set.end())</div>
<div class="line"><span class="lineno">   76</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   77</span>  <span class="keywordflow">if</span> (red_indices_set.find(2) == red_indices_set.end())</div>
<div class="line"><span class="lineno">   78</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   79</span> </div>
<div class="line"><span class="lineno">   80</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno">   81</span>  <span class="comment">// CHECK 3) keep_dims == true (?)</span></div>
<div class="line"><span class="lineno">   82</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno">   83</span>  <span class="comment">// We only have case of &#39;keep_dims == true&#39; so far, but it might be okay with &#39;keep_dims == false&#39;</span></div>
<div class="line"><span class="lineno">   84</span>  <span class="comment">// TODO Check this fact, and if true, return true regardless of keep_dims</span></div>
<div class="line"><span class="lineno">   85</span>  <span class="keywordflow">return</span> mean-&gt;<a class="code hl_function" href="classluci_1_1_circle_mean.html#a1d51c00a06028fa41ef18e2399d28b95">keep_dims</a>();</div>
<div class="line"><span class="lineno">   86</span>}</div>
<div class="ttc" id="aclassluci_1_1_circle_mean_html_a1d51c00a06028fa41ef18e2399d28b95"><div class="ttname"><a href="classluci_1_1_circle_mean.html#a1d51c00a06028fa41ef18e2399d28b95">luci::CircleMean::keep_dims</a></div><div class="ttdeci">bool keep_dims(void) const</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_mean_8h_source.html#l00041">CircleMean.h:41</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_mean_html_a2bacd2ead2af3fba77e23a7cba03ebb2"><div class="ttname"><a href="classluci_1_1_circle_mean.html#a2bacd2ead2af3fba77e23a7cba03ebb2">luci::CircleMean::input</a></div><div class="ttdeci">loco::Node * input(void) const</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_mean_8h_source.html#l00034">CircleMean.h:34</a></div></div>
<div class="ttc" id="aclassluci_1_1_circle_mean_html_a9f29f2f5c7486ba1b27285d7c92c15e2"><div class="ttname"><a href="classluci_1_1_circle_mean.html#a9f29f2f5c7486ba1b27285d7c92c15e2">luci::CircleMean::reduction_indices</a></div><div class="ttdeci">loco::Node * reduction_indices(void) const</div><div class="ttdef"><b>Definition</b> <a href="lang_2include_2luci_2_i_r_2_nodes_2_circle_mean_8h_source.html#l00037">CircleMean.h:37</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lang_2include_2luci_2_i_r_2_nodes_2_circle_mean_8h_source.html#l00034">luci::CircleMean::input()</a>, <a class="el" href="lang_2include_2luci_2_i_r_2_nodes_2_circle_mean_8h_source.html#l00041">luci::CircleMean::keep_dims()</a>, <a class="el" href="lang_2include_2luci_2_i_r_2_nodes_2_circle_mean_8h_source.html#l00037">luci::CircleMean::reduction_indices()</a>, and <a class="el" href="namespaceluci.html#afb90d250392bef9190f8277d358e0172ac9f1a6384b1c466d4612f513bd8e13ea">luci::VALID</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_e955afc72e8af59637c9070b8690ff98.html">compiler</a></li><li class="navelem"><a class="el" href="dir_d868bd9b9ef6b656f76179dd48055579.html">luci</a></li><li class="navelem"><a class="el" href="dir_591e609db43d7de209e651ac54485af8.html">pass</a></li><li class="navelem"><a class="el" href="dir_939d5e73d71666b849ce8e91df2f372f.html">src</a></li><li class="navelem"><a class="el" href="luci_2pass_2src_2_fuse_instance_norm_pass_8cpp.html">FuseInstanceNormPass.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
