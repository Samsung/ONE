<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ONE - On-device Neural Engine: How to Build Compiler</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ONE - On-device Neural Engine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_howto_how_to_build_compiler.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">How to Build Compiler </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This document is based on the system where Ubuntu Desktop Linux 18.04 LTS is installed with default settings, and can be applied in other environments without much difference. For reference, the development of our project started in the Ubuntu Desktop Linux 16.04 LTS environment. As of now, to build in 16.04, please use gcc 7.x or above.</p>
<h1>Build Requires</h1>
<p >If you are going to build this project, the following modules must be installed on your system:</p>
<ul>
<li>CMake</li>
<li>Boost C++ libraries</li>
</ul>
<p >In the Ubuntu, you can easily install it with the following command.</p>
<div class="fragment"><div class="line">$ sudo apt-get install cmake libboost-all-dev</div>
</div><!-- fragment --><p >If your linux system does not have the basic development configuration, you will need to install more packages. A list of all packages needed to configure the development environment can be found in the <a href="https://github.com/Samsung/ONE/blob/master/infra/docker/Dockerfile.1804">https://github.com/Samsung/ONE/blob/master/infra/docker/Dockerfile.1804</a> file.</p>
<p >Here is a summary of it</p>
<div class="fragment"><div class="line">$ sudo apt-get install \</div>
<div class="line">build-essential \</div>
<div class="line">clang-format-8 \</div>
<div class="line">cmake \</div>
<div class="line">doxygen \</div>
<div class="line">git \</div>
<div class="line">hdf5-tools \</div>
<div class="line">lcov \</div>
<div class="line">libatlas-base-dev \</div>
<div class="line">libboost-all-dev \</div>
<div class="line">libgflags-dev \</div>
<div class="line">libgoogle-glog-dev \</div>
<div class="line">libgtest-dev \</div>
<div class="line">libhdf5-dev \</div>
<div class="line">libprotobuf-dev \</div>
<div class="line">protobuf-compiler \</div>
<div class="line">pylint \</div>
<div class="line">python3 \</div>
<div class="line">python3-pip \</div>
<div class="line">python3-venv \</div>
<div class="line">python3.8 \</div>
<div class="line">python3.8-dev \</div>
<div class="line">python3.8-venv \</div>
<div class="line">scons \</div>
<div class="line">software-properties-common \</div>
<div class="line">unzip \</div>
<div class="line">wget</div>
<div class="line"> </div>
<div class="line">$ mkdir /tmp/gtest</div>
<div class="line">$ cd /tmp/gtest</div>
<div class="line">$ cmake /usr/src/gtest</div>
<div class="line">$ make</div>
<div class="line">$ sudo mv *.a /usr/lib</div>
<div class="line"> </div>
<div class="line">$ pip install yapf==0.22.0 numpy</div>
</div><!-- fragment --><h1>Build for Ubuntu</h1>
<p >In a typical linux development environment, including Ubuntu, you can build the compiler with a simple command like this:</p>
<div class="fragment"><div class="line">$ git clone https://github.com/Samsung/ONE.git one</div>
<div class="line">$ cd one</div>
<div class="line">$ ./nncc configure</div>
<div class="line">$ ./nncc build</div>
</div><!-- fragment --><p> Build artifacts will be placed in <code>build</code> folder.</p>
<p >To run unit tests: </p><div class="fragment"><div class="line">$ ./nncc test</div>
</div><!-- fragment --><p >Above steps will build all the modules in the compiler folder. There are modules that are currently not active. To build only as of now active modules of the compiler, we provide a preset of modules to build with below command: </p><div class="fragment"><div class="line">$ ./nnas create-package --prefix $HOME/.local</div>
</div><!-- fragment --><p >With this command, <code>~/.local</code> folder will contain all files in release. If you have added <code>~/.local/bin</code> in PATH, then you will now have latest compiler binaries.</p>
<h2>Build for debug and release separately</h2>
<p >Build target folder can be customized by <code>NNCC_WORKSPACE</code> environment, as we may want to separate debug and release builds.</p>
<div class="fragment"><div class="line">$ NNCC_WORKSPACE=build/debug ./nncc configure</div>
<div class="line">$ ./nncc build</div>
</div><!-- fragment --><p> will build debug version in <code>build/debug</code> folder, and</p>
<div class="fragment"><div class="line">$ NNCC_WORKSPACE=build/release ./nncc configure -DCMAKE_BUILD_TYPE=Release</div>
<div class="line">$ ./nncc build</div>
</div><!-- fragment --><p> will build release version in <code>build/release</code> folder.</p>
<h2>Trouble shooting</h2>
<p >If you are using python3.8, as there is no TensorFlow1.13.2 package for python3.8, build may fail. Please install python3.7 or lower versions as default python3.</p>
<h1>Build for Windows</h1>
<p >To build for Windows, we use MinGW(Minimalist GNU for Windows). <a href="https://github.com/git-for-windows/build-extra/releases">Here</a> you can download a tool that includes it.</p>
<div class="fragment"><div class="line">$ git clone https://github.com/Samsung/ONE.git one</div>
<div class="line">$ cd one</div>
<div class="line">$ NNAS_BUILD_PREFIX=build ./nnas create-package --preset 20200731_windows --prefix install</div>
</div><!-- fragment --><ul>
<li><code>NNAS_BUILD_PREFIX</code> is the path to directory where compiler-build-artifacts will be stored.</li>
<li><code>--preset</code> is the one that specifies a version you will install. You can see <code>infra/packaging/preset/</code> directory for more details and getting latest version.</li>
<li><code>--prefix</code> is the install directory.</li>
</ul>
<h1>Cross build for Ubuntu/ARM32 (experimental)</h1>
<p >Some modules are availble to run in Ubuntu/ARM32 through cross building.</p>
<p >While configuring the build, some modules need to execute tools for generating test materials and they need to execute in the host(x86-64). So some modules are needed to build the tools for host before cross building.</p>
<p >Cross build overall steps are like, (1) configure for host (2) build tools for host (3) configure for ARM32 target (4) and then build for ARM32 target.</p>
<p >Unit tests can also run in target device. But value test needs to run TensorFlow lite to get expected results, and it would be a task to do this so the data files from host execution are used instead.</p>
<p >Thus to run the unit tests in the target, running in host is needed in prior.</p>
<h2>Prepare root file system</h2>
<p >You should prepare Ubuntu/ARM32 root file system for cross compilation. Please refer <a class="el" href="md_docs_howto_how_to_cross_build_runtime_for_arm.html">how-to-cross-build-runtime-for-arm.md</a> for preparation.</p>
<p >You can set <code>ROOTFS_ARM</code> environment variable if you have in alternative folder.</p>
<h2>Clean existing external source for patches</h2>
<p >Some external projects from source are not "cross compile ready with CMake" projects. This experimental project prepared some patches for this. Just remove the source and stamp file like below and the <code>make</code> will prepare patch applied source codes. </p><div class="fragment"><div class="line">rm -rf externals/HDF5</div>
<div class="line">rm -rf externals/PROTOBUF</div>
<div class="line">rm externals/HDF5.stamp</div>
<div class="line">rm externals/PROTOBUF.stamp</div>
</div><!-- fragment --><h2>Build</h2>
<p >To cross build, <code>infra/nncc/Makefile.arm32</code> file is provided as an example to work with <code>make</code> command. </p><div class="fragment"><div class="line">make -f infra/nncc/Makefile.arm32 cfg</div>
<div class="line">make -f infra/nncc/Makefile.arm32 debug</div>
</div><!-- fragment --><p> First <code>make</code> will run above steps (1), (2) and (3). Second <code>make</code> will run (4).</p>
<h2>Test</h2>
<p >Preprequisite for testing in ARM32 device. </p><div class="fragment"><div class="line"># numpy is required for value match in ARM32 target device</div>
<div class="line">sudo apt-get install python3-pip</div>
<div class="line">python3 -m pip install numpy</div>
</div><!-- fragment --><p >You can also run unit tests in ARM32 Ubuntu device with cross build results. First you need to run the test in host to prepare files that are currently complicated in target device. </p><div class="fragment"><div class="line"># run this in x86-64 host</div>
<div class="line">make -f infra/nncc/Makefile.arm32 test_prep</div>
<div class="line"> </div>
<div class="line"># run this in ARM32 target device</div>
<div class="line">make -f infra/nncc/Makefile.arm32 test</div>
</div><!-- fragment --><p >NOTE: this assumes</p><ul>
<li>host and target have same directoy structure</li>
<li>should copy <code>build</code> folder to target or</li>
<li>mounting <code>ONE</code> folder with NFS on the target would be simple </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
