<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ONE - On-device Neural Engine: How to Cross-build Runtime for ARM</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ONE - On-device Neural Engine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_howto_how_to_cross_build_runtime_for_arm.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">How to Cross-build Runtime for ARM </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Prepare ARM Ubuntu RootFS</h1>
<p >Install required packages</p>
<div class="fragment"><div class="line">$ sudo apt-get install qemu qemu-user-static binfmt-support debootstrap</div>
</div><!-- fragment --><p >Use <code>install_rootfs.sh</code> script to prepare Root File System. You should have <code>sudo</code></p>
<div class="fragment"><div class="line">$ sudo ./tools/cross/install_rootfs.sh arm</div>
</div><!-- fragment --><ul>
<li>supports <code>arm</code>(default) and <code>aarch</code> architecutre for now</li>
<li>supports <code>bionic</code>(default), and <code>focal</code> release</li>
</ul>
<p >To see the options, </p><div class="fragment"><div class="line">$ ./tools/cross/install_rootfs.sh -h</div>
</div><!-- fragment --><p >RootFS will be prepared at <code>tools/cross/rootfs/arm</code> folder.</p>
<p ><em><b>* CAUTION: The OS version of rootfs must match the OS version of execution target device. On the other hand, you need to match the Ubuntu version of the development PC with the Ubuntu version of rootfs to be used for cross-build. Otherwise, unexpected build errors may occur.</b></em></p>
<p >If you are using Ubuntu 18.04 LTS, select <code>bionic</code>, if you are using Ubuntu 20.04 LTS, select <code>focal</code>. You can check your Ubuntu code name in the following way.</p>
<div class="fragment"><div class="line">$ cat /etc/lsb-release</div>
<div class="line">DISTRIB_ID=Ubuntu</div>
<div class="line">DISTRIB_RELEASE=18.04</div>
<div class="line">DISTRIB_CODENAME=bionic</div>
<div class="line">DISTRIB_DESCRIPTION=&quot;Ubuntu 18.04.4 LTS&quot;</div>
</div><!-- fragment --><p >If a build error occurs because the version of the development system and the target system do not match, and if you can't replace your development system for any reason, you can consider <a class="el" href="md_docs_howto_how_to_build_runtime_using_prebuilt_docker_image.html">cross-build using the docker image</a>.</p>
<h2>Prepare RootFS at alternative folder</h2>
<p >Use <code>ROOTFS_DIR</code> to a full path to prepare at alternative path.</p>
<div class="fragment"><div class="line">$ ROOTFS_DIR=/home/user/rootfs/arm-bionic sudo -E ./tools/cross/install_rootfs.sh arm</div>
</div><!-- fragment --><h2>Using proxy</h2>
<p >If you need to use proxy server while building the rootfs, use <code>--setproxy</code> option.</p>
<div class="fragment"><div class="line"># for example,</div>
<div class="line">$ sudo ./tools/cross/install_rootfs.sh arm --setproxy=&quot;1.2.3.4:8080&quot;</div>
<div class="line"># or</div>
<div class="line">$ sudo ./tools/cross/install_rootfs.sh arm --setproxy=&quot;proxy.server.com:8888&quot;</div>
</div><!-- fragment --><p >This will put <code>apt</code> proxy settings in <code>rootfs/etc/apt/apt.conf.d/90proxy</code> file for <code>http</code>, <code>https</code> and <code>ftp</code> protocol.</p>
<h1>Install ARM Cross Toolchain</h1>
<p >We recommend you have g++ &gt;= 6 installed on your system because NN generated tests require it.</p>
<h2>Ubuntu 18.04 LTS</h2>
<p >On Ubuntu 18.04 LTS, you can install using <code>apt-get</code>.</p>
<p >Choose g++ version whatever you prefer: 7 (default), 6 or 8.</p>
<div class="fragment"><div class="line">$ sudo apt-get install g++-{6,7,8}-arm-linux-gnueabihf</div>
</div><!-- fragment --><p >If you select specific version, update symbolic link for build toolchain</p>
<div class="fragment"><div class="line">$ update-alternatives --install /usr/bin/arm-linux-gnueabihf-gcc arm-linux-gnueabihf-gcc /usr/bin/arm-linux-gnueabihf-gcc-8 80 \</div>
<div class="line">    --slave /usr/bin/arm-linux-gnueabihf-g++ arm-linux-gnueabihf-g++ /usr/bin/arm-linux-gnueabihf-g++-8 \</div>
<div class="line">    --slave /usr/bin/arm-linux-gnueabihf-gcov arm-linux-gnueabihf-gcov /usr/bin/arm-linux-gnueabihf-gcov-8</div>
</div><!-- fragment --><h2>Ubuntu 20.04 LTS</h2>
<p >Same with Ubuntu 18.04 LTS. (except g++ version)</p>
<h1>Build and install ARM Compute Library</h1>
<p >Mostly you only need once of ACL (ARM Compute Library) build.</p>
<p >To build ACL, you need to install scons</p>
<div class="fragment"><div class="line">$ sudo apt-get install scons</div>
</div><!-- fragment --><p >ACL will be automatically installed in <code>externals/acl</code> when you build runtime without any changes.</p>
<p >You can check ACL source information in <code>infra/cmake/packages/ARMComputeSourceConfig.cmake</code></p>
<h1>Cross build for ARM</h1>
<p >Give <code>TARGET_ARCH</code> variable to set the target architecture.</p>
<p >If you used <code>ROOTFS_DIR</code> to prepare in alternative folder, you should also give this to makefile.</p>
<div class="fragment"><div class="line">$ CROSS_BUILD=1 TARGET_ARCH=armv7l make</div>
<div class="line"> </div>
<div class="line"># If ROOTFS_DIR is in alternative folder</div>
<div class="line">$ ROOTFS_DIR=/path/to/your/rootfs/arm \</div>
<div class="line">CROSS_BUILD=1 TARGET_ARCH=armv7l make</div>
</div><!-- fragment --><p >You can also omit the <code>CROSS_BUILD=1</code> option if you explicitly pass <code>ROOTFS_DIR</code>. In that case, if the <code>TARGET_ARCH</code> are differs from the hostarchitecture, the make script automatically applies <code>CROSS_BUILD=1</code>. So, if you set <code>ROOTFS_DIR</code> as an environment variable, you can simply perform normal build and cross build as follows.</p>
<div class="fragment"><div class="line">$ export ROOTFS_DIR=xxx</div>
<div class="line">...</div>
<div class="line">$ make                       # do normal build</div>
<div class="line">$ TARGET_ARCH=armv7l make    # do cross build</div>
</div><!-- fragment --><h2>Run test</h2>
<p >To run and test the cross-compiled runtime, you need to copy the compiled output to the target device of the architecture in which it is executable.</p>
<ol type="1">
<li>Copy all artifacts under the <code>./Product</code> folder to the target device, Odroid-XU4 for example, as a whole.</li>
</ol>
<div class="fragment"><div class="line">$ ssh odroid mkdir -p one/Product</div>
<div class="line">sjlee@odroid&#39;s password:</div>
<div class="line">$ scp -rp ./Product/armv7l-linux.debug odroid:one/Product</div>
<div class="line">sjlee@odroid&#39;s password:</div>
<div class="line">FillFrom_runner                                                                                 100%  224KB 223.6KB/s   00:00</div>
<div class="line">benchmark_nnapi.sh                                                                              100% 7464     7.3KB/s   00:00</div>
<div class="line">common.sh                                                                                       100% 2084     2.0KB/s   00:00</div>
<div class="line">test_framework.sh                                                                               100% 3154     3.1KB/s   00:00</div>
<div class="line">test-driver.sh</div>
<div class="line">...</div>
</div><!-- fragment --><ol type="1">
<li>Log in to the target device, go to the copied path, and reestore the symbolic link settings of the <code>Product</code> directory.</li>
</ol>
<div class="fragment"><div class="line">$ ssh odroid</div>
<div class="line">sjlee@odroid&#39;s password:</div>
<div class="line">...</div>
<div class="line">$ cd ~/one/Product</div>
<div class="line">$ ln ${PWD}/armv7l-linux.debug/out out</div>
<div class="line">$ cd ..</div>
<div class="line">$ ls -la Product</div>
<div class="line">drwxrwxr-x  5 sjlee sjlee 4096 Jun  4 20:55 armv7l-linux.debug</div>
<div class="line">lrwxrwxrwx  1 sjlee sjlee   51 Jun  4 20:55 out -&gt; /home/sjlee/one/Product/armv7l-linux.debug/out</div>
</div><!-- fragment --><p >Now you can test the compilation result in the same way as the native build. Please refer to the following document for details on the test procedure.</p>
<ul>
<li><a href="./how-to-build-runtime.md#run-test">Testing neural network model inference using the runtime</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
