<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ONE - On-device Neural Engine: generate_bcq_output_arrays Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ONE - On-device Neural Engine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('namespacegenerate__bcq__output__arrays.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">generate_bcq_output_arrays Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af3df3e5b7e90c80fde8cfeed3f1c78db"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegenerate__bcq__output__arrays.html#af3df3e5b7e90c80fde8cfeed3f1c78db">load_graph</a> (model_file)</td></tr>
<tr class="separator:af3df3e5b7e90c80fde8cfeed3f1c78db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae66da93473f135d7bd948424ec59adfb"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegenerate__bcq__output__arrays.html#ae66da93473f135d7bd948424ec59adfb">get_bcq_version</a> (input_path)</td></tr>
<tr class="separator:ae66da93473f135d7bd948424ec59adfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62734fdc802a94399a6b048d84c2414b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegenerate__bcq__output__arrays.html#a62734fdc802a94399a6b048d84c2414b">get_bcqinfo_output_arrays_v1</a> (input_path, output_arrays)</td></tr>
<tr class="separator:a62734fdc802a94399a6b048d84c2414b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5846e41dc48e84f6cc47cc88a1b340d"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegenerate__bcq__output__arrays.html#ae5846e41dc48e84f6cc47cc88a1b340d">get_bcq_output_arrays</a> (input_path, output_arrays)</td></tr>
<tr class="separator:ae5846e41dc48e84f6cc47cc88a1b340d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ae5846e41dc48e84f6cc47cc88a1b340d" name="ae5846e41dc48e84f6cc47cc88a1b340d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5846e41dc48e84f6cc47cc88a1b340d">&#9670;&#160;</a></span>get_bcq_output_arrays()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def generate_bcq_output_arrays.get_bcq_output_arrays </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>input_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>output_arrays</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Returns BCQ output arrays that the model from input_path has</pre> 
<p class="definition">Definition at line <a class="el" href="generate__bcq__output__arrays_8py_source.html#l00105">105</a> of file <a class="el" href="generate__bcq__output__arrays_8py_source.html">generate_bcq_output_arrays.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  105</span><span class="keyword">def </span>get_bcq_output_arrays(input_path, output_arrays):</div>
<div class="line"><span class="lineno">  106</span>    <span class="stringliteral">&quot;&quot;&quot;Returns BCQ output arrays that the model from input_path has&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  107</span>    program_version = 1</div>
<div class="line"><span class="lineno">  108</span>    model_version = get_bcq_version(input_path)</div>
<div class="line"><span class="lineno">  109</span> </div>
<div class="line"><span class="lineno">  110</span>    <span class="keywordflow">if</span> model_version == 1:</div>
<div class="line"><span class="lineno">  111</span>        <span class="keywordflow">return</span> get_bcqinfo_output_arrays_v1(input_path, output_arrays)</div>
<div class="line"><span class="lineno">  112</span>    <span class="keywordflow">elif</span> model_version == -1:</div>
<div class="line"><span class="lineno">  113</span>        <span class="keywordflow">return</span> output_arrays.split(<span class="stringliteral">&#39;,&#39;</span>)</div>
<div class="line"><span class="lineno">  114</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  115</span>        err_msg = <span class="stringliteral">&quot;BCQ version of the model(v{}) &quot;</span>.format(model_version)</div>
<div class="line"><span class="lineno">  116</span>        err_msg += <span class="stringliteral">&quot;is higher than &quot;</span></div>
<div class="line"><span class="lineno">  117</span>        err_msg += <span class="stringliteral">&quot;the version supported by this program(v{})&quot;</span>.format(program_version)</div>
<div class="line"><span class="lineno">  118</span>        <span class="keywordflow">raise</span> SystemExit(err_msg)</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="generate__bcq__output__arrays_8py_source.html#l00038">get_bcq_version()</a>, and <a class="el" href="generate__bcq__output__arrays_8py_source.html#l00052">get_bcqinfo_output_arrays_v1()</a>.</p>

</div>
</div>
<a id="ae66da93473f135d7bd948424ec59adfb" name="ae66da93473f135d7bd948424ec59adfb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae66da93473f135d7bd948424ec59adfb">&#9670;&#160;</a></span>get_bcq_version()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def generate_bcq_output_arrays.get_bcq_version </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>input_path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">If BCQ metadata exists, BCQ version is in the second element.
Return -1 when the metadata is not found.
</pre> 
<p class="definition">Definition at line <a class="el" href="generate__bcq__output__arrays_8py_source.html#l00038">38</a> of file <a class="el" href="generate__bcq__output__arrays_8py_source.html">generate_bcq_output_arrays.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   38</span><span class="keyword">def </span>get_bcq_version(input_path):</div>
<div class="line"><span class="lineno">   39</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   40</span><span class="stringliteral">    If BCQ metadata exists, BCQ version </span><span class="keywordflow">is</span> <span class="keywordflow">in</span> the second element.</div>
<div class="line"><span class="lineno">   41</span>    Return -1 when the metadata <span class="keywordflow">is</span> <span class="keywordflow">not</span> found.</div>
<div class="line"><span class="lineno">   42</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   43</span><span class="stringliteral">    graph = load_graph(input_path)</span></div>
<div class="line"><span class="lineno">   44</span><span class="stringliteral">    graph_def = graph.as_graph_def()</span></div>
<div class="line"><span class="lineno">   45</span><span class="stringliteral">    </span><span class="keywordflow">for</span> node <span class="keywordflow">in</span> graph_def.node:</div>
<div class="line"><span class="lineno">   46</span>        <span class="keywordflow">if</span> node.op == <span class="stringliteral">&quot;Const&quot;</span> <span class="keywordflow">and</span> <span class="stringliteral">&quot;one_compiler/bcqinfo_one_metadata&quot;</span> <span class="keywordflow">in</span> node.name:</div>
<div class="line"><span class="lineno">   47</span>            metadata_tensor = tf.make_ndarray(node.attr[<span class="stringliteral">&quot;value&quot;</span>].tensor)</div>
<div class="line"><span class="lineno">   48</span>            <span class="keywordflow">return</span> metadata_tensor[1]</div>
<div class="line"><span class="lineno">   49</span>    <span class="keywordflow">return</span> -1</div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="generate__bcq__output__arrays_8py_source.html#l00026">load_graph()</a>.</p>

<p class="reference">Referenced by <a class="el" href="generate__bcq__output__arrays_8py_source.html#l00105">get_bcq_output_arrays()</a>.</p>

</div>
</div>
<a id="a62734fdc802a94399a6b048d84c2414b" name="a62734fdc802a94399a6b048d84c2414b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62734fdc802a94399a6b048d84c2414b">&#9670;&#160;</a></span>get_bcqinfo_output_arrays_v1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def generate_bcq_output_arrays.get_bcqinfo_output_arrays_v1 </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>input_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>output_arrays</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">This function generates a file which includes output arrays of BCQ v1
information bundles. Each bundle is consisted with one of candidate
operations (BCQ may be applied) and BCQ constant nodes related with
the operation.
</pre> 
<p class="definition">Definition at line <a class="el" href="generate__bcq__output__arrays_8py_source.html#l00052">52</a> of file <a class="el" href="generate__bcq__output__arrays_8py_source.html">generate_bcq_output_arrays.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   52</span><span class="keyword">def </span>get_bcqinfo_output_arrays_v1(input_path, output_arrays):</div>
<div class="line"><span class="lineno">   53</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   54</span><span class="stringliteral">    This function generates a file which includes output arrays of BCQ v1</span></div>
<div class="line"><span class="lineno">   55</span><span class="stringliteral">    information bundles. Each bundle </span><span class="keywordflow">is</span> consisted <span class="keyword">with</span> one of candidate</div>
<div class="line"><span class="lineno">   56</span>    operations (BCQ may be applied) <span class="keywordflow">and</span> BCQ constant nodes related <span class="keyword">with</span></div>
<div class="line"><span class="lineno">   57</span>    the operation.</div>
<div class="line"><span class="lineno">   58</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   59</span><span class="stringliteral">    graph = load_graph(input_path)</span></div>
<div class="line"><span class="lineno">   60</span><span class="stringliteral">    ops = graph.get_operations()</span></div>
<div class="line"><span class="lineno">   61</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   62</span><span class="stringliteral">    </span><span class="comment"># If there is a constant node named PREFIX_1/bcqinfo_alpha,</span></div>
<div class="line"><span class="lineno">   63</span>    <span class="comment"># it is used for applying BCQ to constant node named PREFIX_1.</span></div>
<div class="line"><span class="lineno">   64</span>    <span class="comment"># Collected prefixes will be used for connecting</span></div>
<div class="line"><span class="lineno">   65</span>    <span class="comment"># bcqinfo nodes and user operations of prefix nodes.</span></div>
<div class="line"><span class="lineno">   66</span>    prefix_set = set()</div>
<div class="line"><span class="lineno">   67</span>    has_dequant_weight = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">   68</span>    <span class="keywordflow">for</span> op <span class="keywordflow">in</span> ops:</div>
<div class="line"><span class="lineno">   69</span>        <span class="keywordflow">if</span> op.type == <span class="stringliteral">&quot;Const&quot;</span> <span class="keywordflow">and</span> <span class="stringliteral">&quot;/bcqinfo_&quot;</span> <span class="keywordflow">in</span> op.outputs[0].name:</div>
<div class="line"><span class="lineno">   70</span>            <span class="comment"># Metadata do not have prefix</span></div>
<div class="line"><span class="lineno">   71</span>            <span class="keywordflow">if</span> <span class="stringliteral">&quot;one_compiler/bcqinfo_one_metadata&quot;</span> <span class="keywordflow">in</span> op.outputs[0].name:</div>
<div class="line"><span class="lineno">   72</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">   73</span> </div>
<div class="line"><span class="lineno">   74</span>            prefix_index = op.outputs[0].name.index(<span class="stringliteral">&quot;/bcqinfo_&quot;</span>)</div>
<div class="line"><span class="lineno">   75</span>            prefix = op.outputs[0].name[:prefix_index]</div>
<div class="line"><span class="lineno">   76</span>            prefix_set.add(prefix)</div>
<div class="line"><span class="lineno">   77</span> </div>
<div class="line"><span class="lineno">   78</span>            <span class="comment"># Usually, output name of op is like &quot;outputname:0&quot;</span></div>
<div class="line"><span class="lineno">   79</span>            <span class="comment"># -2 is for removing &quot;:0&quot;</span></div>
<div class="line"><span class="lineno">   80</span>            infoname = op.outputs[0].name[prefix_index + 1:-2]</div>
<div class="line"><span class="lineno">   81</span>            <span class="keywordflow">if</span> infoname == <span class="stringliteral">&quot;bcqinfo_dequant_weight&quot;</span>:</div>
<div class="line"><span class="lineno">   82</span>                has_dequant_weight = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">   83</span> </div>
<div class="line"><span class="lineno">   84</span>    <span class="comment"># the name of metadata node</span></div>
<div class="line"><span class="lineno">   85</span>    ret_output_arrays = [<span class="stringliteral">&#39;one_compiler/bcqinfo_one_metadata&#39;</span>]</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span>    <span class="comment"># given node from user</span></div>
<div class="line"><span class="lineno">   88</span>    ret_output_arrays += output_arrays.split(<span class="stringliteral">&#39;,&#39;</span>)</div>
<div class="line"><span class="lineno">   89</span> </div>
<div class="line"><span class="lineno">   90</span>    <span class="comment"># all pairs of a constant node and related BCQ information nodes.</span></div>
<div class="line"><span class="lineno">   91</span>    <span class="keywordflow">for</span> prefix <span class="keywordflow">in</span> prefix_set:</div>
<div class="line"><span class="lineno">   92</span>        ret_output_arrays.append(prefix + <span class="stringliteral">&#39;/bcqinfo_do_w_x&#39;</span>)</div>
<div class="line"><span class="lineno">   93</span>        ret_output_arrays.append(prefix + <span class="stringliteral">&#39;/bcqinfo_alpha&#39;</span>)</div>
<div class="line"><span class="lineno">   94</span>        ret_output_arrays.append(prefix + <span class="stringliteral">&#39;/bcqinfo_packed_binary_code&#39;</span>)</div>
<div class="line"><span class="lineno">   95</span>        ret_output_arrays.append(prefix + <span class="stringliteral">&#39;/bcqinfo_number_of_clusters&#39;</span>)</div>
<div class="line"><span class="lineno">   96</span>        ret_output_arrays.append(prefix + <span class="stringliteral">&#39;/bcqinfo_size_of_clusters&#39;</span>)</div>
<div class="line"><span class="lineno">   97</span>        ret_output_arrays.append(prefix + <span class="stringliteral">&#39;/bcqinfo_qbits_of_clusters&#39;</span>)</div>
<div class="line"><span class="lineno">   98</span>        ret_output_arrays.append(prefix)</div>
<div class="line"><span class="lineno">   99</span>        <span class="keywordflow">if</span> has_dequant_weight:</div>
<div class="line"><span class="lineno">  100</span>            ret_output_arrays.append(prefix + <span class="stringliteral">&#39;/bcqinfo_dequant_weight&#39;</span>)</div>
<div class="line"><span class="lineno">  101</span> </div>
<div class="line"><span class="lineno">  102</span>    <span class="keywordflow">return</span> ret_output_arrays</div>
<div class="line"><span class="lineno">  103</span> </div>
<div class="line"><span class="lineno">  104</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="generate__bcq__output__arrays_8py_source.html#l00026">load_graph()</a>.</p>

<p class="reference">Referenced by <a class="el" href="generate__bcq__output__arrays_8py_source.html#l00105">get_bcq_output_arrays()</a>.</p>

</div>
</div>
<a id="af3df3e5b7e90c80fde8cfeed3f1c78db" name="af3df3e5b7e90c80fde8cfeed3f1c78db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3df3e5b7e90c80fde8cfeed3f1c78db">&#9670;&#160;</a></span>load_graph()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def generate_bcq_output_arrays.load_graph </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>model_file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="generate__bcq__output__arrays_8py_source.html#l00026">26</a> of file <a class="el" href="generate__bcq__output__arrays_8py_source.html">generate_bcq_output_arrays.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   26</span><span class="keyword">def </span>load_graph(model_file):</div>
<div class="line"><span class="lineno">   27</span>    graph = tf.Graph()</div>
<div class="line"><span class="lineno">   28</span>    graph_def = tf.compat.v1.GraphDef()</div>
<div class="line"><span class="lineno">   29</span> </div>
<div class="line"><span class="lineno">   30</span>    <span class="keyword">with</span> open(model_file, <span class="stringliteral">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</div>
<div class="line"><span class="lineno">   31</span>        graph_def.ParseFromString(f.read())</div>
<div class="line"><span class="lineno">   32</span>    <span class="keyword">with</span> graph.as_default():</div>
<div class="line"><span class="lineno">   33</span>        tf.import_graph_def(graph_def, name=<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><span class="lineno">   34</span> </div>
<div class="line"><span class="lineno">   35</span>    <span class="keywordflow">return</span> graph</div>
<div class="line"><span class="lineno">   36</span> </div>
<div class="line"><span class="lineno">   37</span> </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="generate__bcq__output__arrays_8py_source.html#l00038">get_bcq_version()</a>, and <a class="el" href="generate__bcq__output__arrays_8py_source.html#l00052">get_bcqinfo_output_arrays_v1()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacegenerate__bcq__output__arrays.html">generate_bcq_output_arrays</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
