nnas_find_package(Jsoncpp)
if(NOT Jsoncpp_FOUND)
  message(STATUS "Build jsoncpp: FAILED (missing jsoncpp)")
  return()
endif(NOT Jsoncpp_FOUND)

set(DRIVER "driver/Driver.cpp")

file(GLOB_RECURSE SOURCES "src/*.cpp")
file(GLOB_RECURSE TESTS "src/*.test.cpp")
list(REMOVE_ITEM SOURCES ${TESTS})

add_executable(fme-apply ${DRIVER} ${SOURCES})
target_include_directories(fme-apply PRIVATE ${Jsoncpp_INCLUDE_DIRS})
target_include_directories(fme-apply PRIVATE src)

target_link_libraries(fme-apply ${Jsoncpp_STATIC_LIB})
target_link_libraries(fme-apply safemain)
target_link_libraries(fme-apply foder)
target_link_libraries(fme-apply loco)
target_link_libraries(fme-apply logo)
target_link_libraries(fme-apply logo_core)
target_link_libraries(fme-apply luci_lang)
target_link_libraries(fme-apply luci_import)
target_link_libraries(fme-apply luci_service)
target_link_libraries(fme-apply luci_log)
target_link_libraries(fme-apply luci_logex)
target_link_libraries(fme-apply luci_pass)
target_link_libraries(fme-apply luci_export)
target_link_libraries(fme-apply luci_env)
target_link_libraries(fme-apply luci_profile)
target_link_libraries(fme-apply arser)

install(TARGETS fme-apply DESTINATION bin)

if(NOT ENABLE_TEST)
  return()
endif(NOT ENABLE_TEST)

nnas_find_package(GTest REQUIRED)
GTest_AddTest(fme_apply_test ${TESTS} ${SOURCES})
target_include_directories(fme_apply_test PRIVATE ${Jsoncpp_INCLUDE_DIRS})
target_include_directories(fme_apply_test PRIVATE src)
target_link_libraries(fme_apply_test ${Jsoncpp_STATIC_LIB})
target_link_libraries(fme_apply_test luci_testhelper)
target_link_libraries(fme_apply_test luci_lang)
target_link_libraries(fme_apply_test logo)
target_link_libraries(fme_apply_test logo_core)
target_link_libraries(fme_apply_test luci_pass)
target_link_libraries(fme_apply_test luci_service)
target_link_libraries(fme_apply_test luci_log)
target_link_libraries(fme_apply_test luci_logex)
target_link_libraries(fme_apply_test luci_profile)
