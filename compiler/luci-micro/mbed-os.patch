diff --git a/connectivity/libraries/mbed-coap/Makefile b/connectivity/libraries/mbed-coap/Makefile
index 2e43e5a1..b15fd603 100644
--- a/connectivity/libraries/mbed-coap/Makefile
+++ b/connectivity/libraries/mbed-coap/Makefile
@@ -1,42 +1,189 @@
-#
-# Makefile for COAP library
-#
-
-# Define compiler toolchain with CC or PLATFORM variables
-# Example (GCC toolchains, default $CC and $AR are used)
-# make
-#
-# OR (Cross-compile GCC toolchain)
-# make PLATFORM=arm-linux-gnueabi-
-#
-# OR (armcc/Keil)
-# make CC=armcc AR=ArmAR
-#
-# OR (IAR-ARM)
-# make CC=iccarm
-
-LIB = libmbedcoap.a
-SRCS := \
-	source/sn_coap_protocol.c \
-	source/sn_coap_parser.c \
-	source/sn_coap_header_check.c \
-	source/sn_coap_builder.c \
-
-override CFLAGS += -DVERSION='"$(VERSION)"'
-
-override CFLAGS += -Isource/include/
-SERVLIB_DIR := ../libService
-override CFLAGS += -I$(SERVLIB_DIR)/libService
-override CFLAGS += -I.
-
-include ../libService/toolchain_rules.mk
-
-$(eval $(call generate_rules,$(LIB),$(SRCS)))
-
-.PHONY: release
-release:
-	7z a nsdl-c_$(VERSION).zip *.a *.lib include
-
-.PHONY: deploy_to
-deploy_to: all
-	tar --transform 's,^,libcoap/,' --append -f $(TO) *.a libcoap
+# CMAKE generated file: DO NOT EDIT!
+# Generated by "Unix Makefiles" Generator, CMake Version 3.21
+
+# Default target executed when no arguments are given to make.
+default_target: all
+.PHONY : default_target
+
+# Allow only one "make -f Makefile2" at a time, but pass parallelism.
+.NOTPARALLEL:
+
+#=============================================================================
+# Special targets provided by cmake.
+
+# Disable implicit rules so canonical targets will work.
+.SUFFIXES:
+
+# Disable VCS-based implicit rules.
+% : %,v
+
+# Disable VCS-based implicit rules.
+% : RCS/%
+
+# Disable VCS-based implicit rules.
+% : RCS/%,v
+
+# Disable VCS-based implicit rules.
+% : SCCS/s.%
+
+# Disable VCS-based implicit rules.
+% : s.%
+
+.SUFFIXES: .hpux_make_needs_suffix_list
+
+# Command-line flag to silence nested $(MAKE).
+$(VERBOSE)MAKESILENT = -s
+
+#Suppress display of executed commands.
+$(VERBOSE).SILENT:
+
+# A target that is always out of date.
+cmake_force:
+.PHONY : cmake_force
+
+#=============================================================================
+# Set environment variables for the build.
+
+# The shell in which to execute make rules.
+SHELL = /bin/sh
+
+# The CMake executable.
+CMAKE_COMMAND = /usr/local/bin/cmake
+
+# The command to remove a file.
+RM = /usr/local/bin/cmake -E rm -f
+
+# Escaping for special characters.
+EQUALS = =
+
+# The top-level source directory on which CMake was run.
+CMAKE_SOURCE_DIR = /home/user/slavikmipt/ONE/compiler/luci-micro
+
+# The top-level build directory on which CMake was run.
+CMAKE_BINARY_DIR = /home/user/slavikmipt/ONE/compiler/luci-micro
+
+#=============================================================================
+# Targets provided globally by CMake.
+
+# Special rule for the target install/strip
+install/strip: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip
+
+# Special rule for the target install/strip
+install/strip/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip/fast
+
+# Special rule for the target install/local
+install/local: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local
+
+# Special rule for the target install/local
+install/local/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local/fast
+
+# Special rule for the target edit_cache
+edit_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake cache editor..."
+	/usr/local/bin/ccmake -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : edit_cache
+
+# Special rule for the target edit_cache
+edit_cache/fast: edit_cache
+.PHONY : edit_cache/fast
+
+# Special rule for the target rebuild_cache
+rebuild_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake to regenerate build system..."
+	/usr/local/bin/cmake --regenerate-during-build -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : rebuild_cache
+
+# Special rule for the target rebuild_cache
+rebuild_cache/fast: rebuild_cache
+.PHONY : rebuild_cache/fast
+
+# Special rule for the target list_install_components
+list_install_components:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Available install components are: \"Unspecified\""
+.PHONY : list_install_components
+
+# Special rule for the target list_install_components
+list_install_components/fast: list_install_components
+.PHONY : list_install_components/fast
+
+# Special rule for the target install
+install: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/local/bin/cmake -P cmake_install.cmake
+.PHONY : install
+
+# Special rule for the target install
+install/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/local/bin/cmake -P cmake_install.cmake
+.PHONY : install/fast
+
+# The main all target
+all: cmake_check_build_system
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -E cmake_progress_start /home/user/slavikmipt/ONE/compiler/luci-micro/CMakeFiles /home/user/slavikmipt/ONE/compiler/luci-micro/mbed-os/connectivity/libraries/mbed-coap//CMakeFiles/progress.marks
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/libraries/mbed-coap/all
+	$(CMAKE_COMMAND) -E cmake_progress_start /home/user/slavikmipt/ONE/compiler/luci-micro/CMakeFiles 0
+.PHONY : all
+
+# The main clean target
+clean:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/libraries/mbed-coap/clean
+.PHONY : clean
+
+# The main clean target
+clean/fast: clean
+.PHONY : clean/fast
+
+# Prepare targets for installation.
+preinstall: all
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/libraries/mbed-coap/preinstall
+.PHONY : preinstall
+
+# Prepare targets for installation.
+preinstall/fast:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/libraries/mbed-coap/preinstall
+.PHONY : preinstall/fast
+
+# clear depends
+depend:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 1
+.PHONY : depend
+
+# Help Target
+help:
+	@echo "The following are some of the valid targets for this Makefile:"
+	@echo "... all (the default if no target is provided)"
+	@echo "... clean"
+	@echo "... depend"
+	@echo "... edit_cache"
+	@echo "... install"
+	@echo "... install/local"
+	@echo "... install/strip"
+	@echo "... list_install_components"
+	@echo "... rebuild_cache"
+.PHONY : help
+
+
+
+#=============================================================================
+# Special targets to cleanup operation of make.
+
+# Special rule to run CMake to check the build system integrity.
+# No rule that depends on this can have commands that come from listfiles
+# because they might be regenerated.
+cmake_check_build_system:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 0
+.PHONY : cmake_check_build_system
+
diff --git a/connectivity/libraries/nanostack-libservice/Makefile b/connectivity/libraries/nanostack-libservice/Makefile
index 390ff1f7..634ed76d 100644
--- a/connectivity/libraries/nanostack-libservice/Makefile
+++ b/connectivity/libraries/nanostack-libservice/Makefile
@@ -1,14 +1,189 @@
-SRCS := \
-source/IPv6_fcf_lib/ip_fsc.c \
-source/libBits/common_functions.c \
-source/libip6string/ip6tos.c \
-source/libip6string/stoip6.c \
-source/libList/ns_list.c \
-source/nsdynmemLIB/nsdynmemLIB.c \
-source/nsdynmemtracker/nsdynmem_tracker_lib.c \
-source/nvmHelper/ns_nvm_helper.c \
-
-LIB := libservice.a
-EXPORT_HEADERS := mbed-client-libservice
-
-include ../exported_rules.mk
+# CMAKE generated file: DO NOT EDIT!
+# Generated by "Unix Makefiles" Generator, CMake Version 3.21
+
+# Default target executed when no arguments are given to make.
+default_target: all
+.PHONY : default_target
+
+# Allow only one "make -f Makefile2" at a time, but pass parallelism.
+.NOTPARALLEL:
+
+#=============================================================================
+# Special targets provided by cmake.
+
+# Disable implicit rules so canonical targets will work.
+.SUFFIXES:
+
+# Disable VCS-based implicit rules.
+% : %,v
+
+# Disable VCS-based implicit rules.
+% : RCS/%
+
+# Disable VCS-based implicit rules.
+% : RCS/%,v
+
+# Disable VCS-based implicit rules.
+% : SCCS/s.%
+
+# Disable VCS-based implicit rules.
+% : s.%
+
+.SUFFIXES: .hpux_make_needs_suffix_list
+
+# Command-line flag to silence nested $(MAKE).
+$(VERBOSE)MAKESILENT = -s
+
+#Suppress display of executed commands.
+$(VERBOSE).SILENT:
+
+# A target that is always out of date.
+cmake_force:
+.PHONY : cmake_force
+
+#=============================================================================
+# Set environment variables for the build.
+
+# The shell in which to execute make rules.
+SHELL = /bin/sh
+
+# The CMake executable.
+CMAKE_COMMAND = /usr/local/bin/cmake
+
+# The command to remove a file.
+RM = /usr/local/bin/cmake -E rm -f
+
+# Escaping for special characters.
+EQUALS = =
+
+# The top-level source directory on which CMake was run.
+CMAKE_SOURCE_DIR = /home/user/slavikmipt/ONE/compiler/luci-micro
+
+# The top-level build directory on which CMake was run.
+CMAKE_BINARY_DIR = /home/user/slavikmipt/ONE/compiler/luci-micro
+
+#=============================================================================
+# Targets provided globally by CMake.
+
+# Special rule for the target install/strip
+install/strip: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip
+
+# Special rule for the target install/strip
+install/strip/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip/fast
+
+# Special rule for the target install/local
+install/local: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local
+
+# Special rule for the target install/local
+install/local/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local/fast
+
+# Special rule for the target edit_cache
+edit_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake cache editor..."
+	/usr/local/bin/ccmake -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : edit_cache
+
+# Special rule for the target edit_cache
+edit_cache/fast: edit_cache
+.PHONY : edit_cache/fast
+
+# Special rule for the target rebuild_cache
+rebuild_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake to regenerate build system..."
+	/usr/local/bin/cmake --regenerate-during-build -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : rebuild_cache
+
+# Special rule for the target rebuild_cache
+rebuild_cache/fast: rebuild_cache
+.PHONY : rebuild_cache/fast
+
+# Special rule for the target list_install_components
+list_install_components:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Available install components are: \"Unspecified\""
+.PHONY : list_install_components
+
+# Special rule for the target list_install_components
+list_install_components/fast: list_install_components
+.PHONY : list_install_components/fast
+
+# Special rule for the target install
+install: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/local/bin/cmake -P cmake_install.cmake
+.PHONY : install
+
+# Special rule for the target install
+install/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/local/bin/cmake -P cmake_install.cmake
+.PHONY : install/fast
+
+# The main all target
+all: cmake_check_build_system
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -E cmake_progress_start /home/user/slavikmipt/ONE/compiler/luci-micro/CMakeFiles /home/user/slavikmipt/ONE/compiler/luci-micro/mbed-os/connectivity/libraries/nanostack-libservice//CMakeFiles/progress.marks
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/libraries/nanostack-libservice/all
+	$(CMAKE_COMMAND) -E cmake_progress_start /home/user/slavikmipt/ONE/compiler/luci-micro/CMakeFiles 0
+.PHONY : all
+
+# The main clean target
+clean:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/libraries/nanostack-libservice/clean
+.PHONY : clean
+
+# The main clean target
+clean/fast: clean
+.PHONY : clean/fast
+
+# Prepare targets for installation.
+preinstall: all
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/libraries/nanostack-libservice/preinstall
+.PHONY : preinstall
+
+# Prepare targets for installation.
+preinstall/fast:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/libraries/nanostack-libservice/preinstall
+.PHONY : preinstall/fast
+
+# clear depends
+depend:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 1
+.PHONY : depend
+
+# Help Target
+help:
+	@echo "The following are some of the valid targets for this Makefile:"
+	@echo "... all (the default if no target is provided)"
+	@echo "... clean"
+	@echo "... depend"
+	@echo "... edit_cache"
+	@echo "... install"
+	@echo "... install/local"
+	@echo "... install/strip"
+	@echo "... list_install_components"
+	@echo "... rebuild_cache"
+.PHONY : help
+
+
+
+#=============================================================================
+# Special targets to cleanup operation of make.
+
+# Special rule to run CMake to check the build system integrity.
+# No rule that depends on this can have commands that come from listfiles
+# because they might be regenerated.
+cmake_check_build_system:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 0
+.PHONY : cmake_check_build_system
+
diff --git a/connectivity/nanostack/coap-service/Makefile b/connectivity/nanostack/coap-service/Makefile
index 33852c05..ab8a0110 100644
--- a/connectivity/nanostack/coap-service/Makefile
+++ b/connectivity/nanostack/coap-service/Makefile
@@ -1,73 +1,189 @@
-# Copyright (c) 2015-2017, Pelion and affiliates.
-# SPDX-License-Identifier: Apache-2.0
-#
-# Licensed under the Apache License, Version 2.0 (the "License");
-# you may not use this file except in compliance with the License.
-# You may obtain a copy of the License at
-#
-#     http://www.apache.org/licenses/LICENSE-2.0
-#
-# Unless required by applicable law or agreed to in writing, software
-# distributed under the License is distributed on an "AS IS" BASIS,
-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-# See the License for the specific language governing permissions and
-# limitations under the License.
-#
-# Makefile for combined CoAP Service library
-#
-
-# Define compiler toolchain with CC or PLATFORM variables
-# Example (GCC toolchains, default $CC and $AR are used)
-# make
-#
-# OR (Cross-compile GCC toolchain)
-# make PLATFORM=arm-linux-gnueabi-
-#
-# OR (armcc/Keil)
-# make CC=armcc AR=ArmAR
-#
-# OR (IAR-ARM)
-# make CC=iccarm
-
-#
-# External sources from libService
-#
-SERVLIB_DIR := ../libService
-override CFLAGS += -I$(SERVLIB_DIR)/libService/
-
-NANOSTACK_DIR := ../nanostack
-override CFLAGS += -I$(NANOSTACK_DIR)/nanostack/
-
-COAP_DIR := ../mbed-coap
-override CFLAGS += -I$(COAP_DIR)/
-
-
-EVENTLOOP_DIR := ../event-loop
-override CFLAGS += -I$(EVENTLOOP_DIR)/nanostack-event-loop/
-
-COAPSERVICE_DIR := ../coap-service
-override CFLAGS += -I$(COAPSERVICE_DIR)/coap-service/
-override CFLAGS += -I$(COAPSERVICE_DIR)/source/include/
-override CFLAGS += -DHAVE_DEBUG
-
-LIB = libcoap-service.a
-
-SRCS := \
-	source/coap_connection_handler.c \
-	source/coap_message_handler.c \
-	source/coap_security_handler.c \
-	source/coap_service_api.c \
-
-override CFLAGS += -DVERSION='"$(VERSION)"'
-
-include ../libService/toolchain_rules.mk
-
-$(eval $(call generate_rules,$(LIB),$(SRCS)))
-
-.PHONY: release
-release:
-	7z a coap-service_$(VERSION).zip *.a *.lib include
-
-.PHONY: deploy_to
-deploy_to: all
-	tar --transform 's,^,coap-service/,' --append -f $(TO) *.a
+# CMAKE generated file: DO NOT EDIT!
+# Generated by "Unix Makefiles" Generator, CMake Version 3.21
+
+# Default target executed when no arguments are given to make.
+default_target: all
+.PHONY : default_target
+
+# Allow only one "make -f Makefile2" at a time, but pass parallelism.
+.NOTPARALLEL:
+
+#=============================================================================
+# Special targets provided by cmake.
+
+# Disable implicit rules so canonical targets will work.
+.SUFFIXES:
+
+# Disable VCS-based implicit rules.
+% : %,v
+
+# Disable VCS-based implicit rules.
+% : RCS/%
+
+# Disable VCS-based implicit rules.
+% : RCS/%,v
+
+# Disable VCS-based implicit rules.
+% : SCCS/s.%
+
+# Disable VCS-based implicit rules.
+% : s.%
+
+.SUFFIXES: .hpux_make_needs_suffix_list
+
+# Command-line flag to silence nested $(MAKE).
+$(VERBOSE)MAKESILENT = -s
+
+#Suppress display of executed commands.
+$(VERBOSE).SILENT:
+
+# A target that is always out of date.
+cmake_force:
+.PHONY : cmake_force
+
+#=============================================================================
+# Set environment variables for the build.
+
+# The shell in which to execute make rules.
+SHELL = /bin/sh
+
+# The CMake executable.
+CMAKE_COMMAND = /usr/local/bin/cmake
+
+# The command to remove a file.
+RM = /usr/local/bin/cmake -E rm -f
+
+# Escaping for special characters.
+EQUALS = =
+
+# The top-level source directory on which CMake was run.
+CMAKE_SOURCE_DIR = /home/user/slavikmipt/ONE/compiler/luci-micro
+
+# The top-level build directory on which CMake was run.
+CMAKE_BINARY_DIR = /home/user/slavikmipt/ONE/compiler/luci-micro
+
+#=============================================================================
+# Targets provided globally by CMake.
+
+# Special rule for the target install/strip
+install/strip: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip
+
+# Special rule for the target install/strip
+install/strip/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip/fast
+
+# Special rule for the target install/local
+install/local: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local
+
+# Special rule for the target install/local
+install/local/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local/fast
+
+# Special rule for the target edit_cache
+edit_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake cache editor..."
+	/usr/local/bin/ccmake -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : edit_cache
+
+# Special rule for the target edit_cache
+edit_cache/fast: edit_cache
+.PHONY : edit_cache/fast
+
+# Special rule for the target rebuild_cache
+rebuild_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake to regenerate build system..."
+	/usr/local/bin/cmake --regenerate-during-build -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : rebuild_cache
+
+# Special rule for the target rebuild_cache
+rebuild_cache/fast: rebuild_cache
+.PHONY : rebuild_cache/fast
+
+# Special rule for the target list_install_components
+list_install_components:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Available install components are: \"Unspecified\""
+.PHONY : list_install_components
+
+# Special rule for the target list_install_components
+list_install_components/fast: list_install_components
+.PHONY : list_install_components/fast
+
+# Special rule for the target install
+install: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/local/bin/cmake -P cmake_install.cmake
+.PHONY : install
+
+# Special rule for the target install
+install/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/local/bin/cmake -P cmake_install.cmake
+.PHONY : install/fast
+
+# The main all target
+all: cmake_check_build_system
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -E cmake_progress_start /home/user/slavikmipt/ONE/compiler/luci-micro/CMakeFiles /home/user/slavikmipt/ONE/compiler/luci-micro/mbed-os/connectivity/nanostack/coap-service//CMakeFiles/progress.marks
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/nanostack/coap-service/all
+	$(CMAKE_COMMAND) -E cmake_progress_start /home/user/slavikmipt/ONE/compiler/luci-micro/CMakeFiles 0
+.PHONY : all
+
+# The main clean target
+clean:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/nanostack/coap-service/clean
+.PHONY : clean
+
+# The main clean target
+clean/fast: clean
+.PHONY : clean/fast
+
+# Prepare targets for installation.
+preinstall: all
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/nanostack/coap-service/preinstall
+.PHONY : preinstall
+
+# Prepare targets for installation.
+preinstall/fast:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/nanostack/coap-service/preinstall
+.PHONY : preinstall/fast
+
+# clear depends
+depend:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 1
+.PHONY : depend
+
+# Help Target
+help:
+	@echo "The following are some of the valid targets for this Makefile:"
+	@echo "... all (the default if no target is provided)"
+	@echo "... clean"
+	@echo "... depend"
+	@echo "... edit_cache"
+	@echo "... install"
+	@echo "... install/local"
+	@echo "... install/strip"
+	@echo "... list_install_components"
+	@echo "... rebuild_cache"
+.PHONY : help
+
+
+
+#=============================================================================
+# Special targets to cleanup operation of make.
+
+# Special rule to run CMake to check the build system integrity.
+# No rule that depends on this can have commands that come from listfiles
+# because they might be regenerated.
+cmake_check_build_system:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 0
+.PHONY : cmake_check_build_system
+
diff --git a/connectivity/nanostack/sal-stack-nanostack-eventloop/Makefile b/connectivity/nanostack/sal-stack-nanostack-eventloop/Makefile
index 2eb702ce..36e0adce 100644
--- a/connectivity/nanostack/sal-stack-nanostack-eventloop/Makefile
+++ b/connectivity/nanostack/sal-stack-nanostack-eventloop/Makefile
@@ -1,36 +1,189 @@
-# Copyright (c) 2019 ARM Limited
-# SPDX-License-Identifier: Apache-2.0
-# Define compiler toolchain with CC or PLATFORM variables
-# Example (GCC toolchains)
-# make PLATFORM=arm-linux-gnueabi-
-# OR
-# make CC=armcc AR=ArmAR
-# OR
-# make CC=iccarm
-
-LIB = libeventOS.a
-SRCS += \
-		source/event.c \
-		source/ns_timer.c \
-		source/system_timer.c\
-		source/ns_timeout.c
-
-include ../libService/toolchain_rules.mk
-
-override CFLAGS += -I nanostack-event-loop
-
-#
-# External sources from libService
-#
-SERVLIB_DIR := ../libService
-override CFLAGS += -I$(SERVLIB_DIR)/libService
-
-$(eval $(call generate_rules,$(LIB),$(SRCS)))
-
-.PHONY: release
-release:
-	7z a edtls-lib_$(VERSION).zip *.a *.lib include
-
-.PHONY: deploy_to
-deploy_to: all
-	tar --transform 's,^,event-loop/,' --append -f $(TO) *.a
+# CMAKE generated file: DO NOT EDIT!
+# Generated by "Unix Makefiles" Generator, CMake Version 3.21
+
+# Default target executed when no arguments are given to make.
+default_target: all
+.PHONY : default_target
+
+# Allow only one "make -f Makefile2" at a time, but pass parallelism.
+.NOTPARALLEL:
+
+#=============================================================================
+# Special targets provided by cmake.
+
+# Disable implicit rules so canonical targets will work.
+.SUFFIXES:
+
+# Disable VCS-based implicit rules.
+% : %,v
+
+# Disable VCS-based implicit rules.
+% : RCS/%
+
+# Disable VCS-based implicit rules.
+% : RCS/%,v
+
+# Disable VCS-based implicit rules.
+% : SCCS/s.%
+
+# Disable VCS-based implicit rules.
+% : s.%
+
+.SUFFIXES: .hpux_make_needs_suffix_list
+
+# Command-line flag to silence nested $(MAKE).
+$(VERBOSE)MAKESILENT = -s
+
+#Suppress display of executed commands.
+$(VERBOSE).SILENT:
+
+# A target that is always out of date.
+cmake_force:
+.PHONY : cmake_force
+
+#=============================================================================
+# Set environment variables for the build.
+
+# The shell in which to execute make rules.
+SHELL = /bin/sh
+
+# The CMake executable.
+CMAKE_COMMAND = /usr/local/bin/cmake
+
+# The command to remove a file.
+RM = /usr/local/bin/cmake -E rm -f
+
+# Escaping for special characters.
+EQUALS = =
+
+# The top-level source directory on which CMake was run.
+CMAKE_SOURCE_DIR = /home/user/slavikmipt/ONE/compiler/luci-micro
+
+# The top-level build directory on which CMake was run.
+CMAKE_BINARY_DIR = /home/user/slavikmipt/ONE/compiler/luci-micro
+
+#=============================================================================
+# Targets provided globally by CMake.
+
+# Special rule for the target install/strip
+install/strip: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip
+
+# Special rule for the target install/strip
+install/strip/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip/fast
+
+# Special rule for the target install/local
+install/local: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local
+
+# Special rule for the target install/local
+install/local/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local/fast
+
+# Special rule for the target edit_cache
+edit_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake cache editor..."
+	/usr/local/bin/ccmake -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : edit_cache
+
+# Special rule for the target edit_cache
+edit_cache/fast: edit_cache
+.PHONY : edit_cache/fast
+
+# Special rule for the target rebuild_cache
+rebuild_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake to regenerate build system..."
+	/usr/local/bin/cmake --regenerate-during-build -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : rebuild_cache
+
+# Special rule for the target rebuild_cache
+rebuild_cache/fast: rebuild_cache
+.PHONY : rebuild_cache/fast
+
+# Special rule for the target list_install_components
+list_install_components:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Available install components are: \"Unspecified\""
+.PHONY : list_install_components
+
+# Special rule for the target list_install_components
+list_install_components/fast: list_install_components
+.PHONY : list_install_components/fast
+
+# Special rule for the target install
+install: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/local/bin/cmake -P cmake_install.cmake
+.PHONY : install
+
+# Special rule for the target install
+install/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/local/bin/cmake -P cmake_install.cmake
+.PHONY : install/fast
+
+# The main all target
+all: cmake_check_build_system
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -E cmake_progress_start /home/user/slavikmipt/ONE/compiler/luci-micro/CMakeFiles /home/user/slavikmipt/ONE/compiler/luci-micro/mbed-os/connectivity/nanostack/sal-stack-nanostack-eventloop//CMakeFiles/progress.marks
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/nanostack/sal-stack-nanostack-eventloop/all
+	$(CMAKE_COMMAND) -E cmake_progress_start /home/user/slavikmipt/ONE/compiler/luci-micro/CMakeFiles 0
+.PHONY : all
+
+# The main clean target
+clean:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/nanostack/sal-stack-nanostack-eventloop/clean
+.PHONY : clean
+
+# The main clean target
+clean/fast: clean
+.PHONY : clean/fast
+
+# Prepare targets for installation.
+preinstall: all
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/nanostack/sal-stack-nanostack-eventloop/preinstall
+.PHONY : preinstall
+
+# Prepare targets for installation.
+preinstall/fast:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/nanostack/sal-stack-nanostack-eventloop/preinstall
+.PHONY : preinstall/fast
+
+# clear depends
+depend:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 1
+.PHONY : depend
+
+# Help Target
+help:
+	@echo "The following are some of the valid targets for this Makefile:"
+	@echo "... all (the default if no target is provided)"
+	@echo "... clean"
+	@echo "... depend"
+	@echo "... edit_cache"
+	@echo "... install"
+	@echo "... install/local"
+	@echo "... install/strip"
+	@echo "... list_install_components"
+	@echo "... rebuild_cache"
+.PHONY : help
+
+
+
+#=============================================================================
+# Special targets to cleanup operation of make.
+
+# Special rule to run CMake to check the build system integrity.
+# No rule that depends on this can have commands that come from listfiles
+# because they might be regenerated.
+cmake_check_build_system:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 0
+.PHONY : cmake_check_build_system
+
diff --git a/connectivity/nanostack/sal-stack-nanostack/Makefile b/connectivity/nanostack/sal-stack-nanostack/Makefile
index c9b7d240..231bdf81 100644
--- a/connectivity/nanostack/sal-stack-nanostack/Makefile
+++ b/connectivity/nanostack/sal-stack-nanostack/Makefile
@@ -1,197 +1,189 @@
-#
-# Makefile for NanoStack
-#
-# Define compiler toolchain with CC variable
-# Example (GCC toolchains, default $CC and $AR are used)
-# make
-#
-# OR (armcc/Keil)
-# make CC=armcc AR=ArmAR
-#
-# OR (IAR-ARM)
-# make CC=iccarm
-
-LIB = libnanostack.a
-
-# If configuration is not specified, use generic
-ifeq (,$(CONFIG))
-CONFIG=generic
-endif
-
-include sources.mk
-include include_dirs.mk
-override CFLAGS += -DNSCONFIG=$(CONFIG)
-
-COAP_SERVICE_LIB := ../coap-service
-SERVLIB_DIR := ../libService
-EVENTLOOP_DIR := ../event-loop
-NSDL_DIR := ../nsdl-c
-COAP_DIR := ../mbed-coap
-MDNS_DIR := source/Service_Libs/mdns
-MDNS_SRV_DIR := source/Service_Libs/mdns/fnet/fnet_stack/services
-MBEDTLS_DIR := ../mbedtls
-override CFLAGS += -I$(MDNS_DIR) -I$(MDNS_DIR)/fnet -I$(MDNS_DIR)/fnet/fnet_stack -I$(MDNS_DIR)/fnet/fnet_stack/stack
-override CFLAGS += -I$(MDNS_SRV_DIR) -I$(MDNS_SRV_DIR)/poll -I$(MDNS_SRV_DIR)/mdns -I$(MDNS_SRV_DIR)/serial
-override CFLAGS += -I$(SERVLIB_DIR)/libService
-override CFLAGS += -I$(EVENTLOOP_DIR)/nanostack-event-loop
-override CFLAGS += -I$(NSDL_DIR)/nsdl-c
-override CFLAGS += -I$(COAP_DIR)
-override CFLAGS += -I$(COAP_SERVICE_LIB)/coap-service
-override CFLAGS += -I$(MBEDTLS_DIR)/include -I$(MBEDTLS_DIR)/crypto/include
-override CFLAGS += $(addprefix -I,$(INCLUDE_DIRS))
-override CFLAGS += $(addprefix -D,$(FLAGS))
-
-
-#
-# Define compiler toolchain
-#
-include ../libService/toolchain_rules.mk
-
-$(eval $(call generate_rules,$(LIB),$(SRCS)))
-
-.PHONY: $(LIB)
-
-# Extend default clean rule
-clean: clean-extra
-
-TEST_FOLDER := ./test/
-UNITTESTS := $(sort $(dir $(wildcard $(TEST_FOLDER)*/unittest/*)))
-TESTDIRS := $(UNITTESTS:%=build-%)
-CLEANTESTDIRS := $(UNITTESTS:%=clean-%)
-COVERAGEFILE := ./lcov/coverage.info
-
-$(TESTDIRS):
-	@make -C $(@:build-%=%)
-
-$(CLEANTESTDIRS):
-	@make -C $(@:clean-%=%) clean
-	@rm -fr results
-
-.PHONY: release
-release:
-	7z a nanostack_$(VERSION).zip *.a *.lib include
-
-.PHONY: deploy_to
-deploy_to: all
-	tar --transform 's,^,nanostack/,' --append -f $(TO) *.a
-
-.PHONY: test
-test: $(TESTDIRS)
-	@rm -rf lcov
-	@rm -rf results
-	@mkdir -p lcov
-	@mkdir -p results
-	@./xsl_script.sh
-	@cp junit_xsl.xslt results/.
-	@xsltproc -o results/index.html results/junit_xsl.xslt results/index.xml
-	@lcov -d test/. -c -o $(COVERAGEFILE)
-	@lcov -q -r $(COVERAGEFILE) "/usr*" -o $(COVERAGEFILE)
-	@lcov -q -r $(COVERAGEFILE) "/test*" -o $(COVERAGEFILE)
-	@lcov -q -r $(COVERAGEFILE) "/libService*" -o $(COVERAGEFILE)
-	@genhtml -q $(COVERAGEFILE) --show-details --prefix $(CURDIR:%/applications/nanostack=%) --output-directory lcov
-	@echo Nanostack unit tests built, see results/index.html and lcov/index.html
-	@sed -n 's/.*\(failures: [0-9]\+\).*/\1/p' results/index.html
-
-clean-extra: $(CLEANTESTDIRS)
-	@rm -rf lcov/
-
-#
-# Releasing the binary for mbed module
-#
-# This must be runned from fully cloned Nanomesh application repository
-# with all submodules.
-#
-# 1. `make mbed-release-build`
-#	You can also separate this step per toolchain:
-#	`make mbed-release-build-GCC`
-#	`make mbed-release-build-ARM`
-#	`make mbed-release-build-IAR`
-# 2. `make mbed-release`
-# 3. TBD: importing to mbed OS
-
-TARGET_DIR:=release
-CONFIGURATIONS_TO_BUILD:=lowpan_border_router lowpan_host lowpan_router nanostack_full thread_border_router thread_router thread_end_device ethernet_host ws_border_router ws_router
-TOOLCHAINS_TO_BUILD:=GCC ARM ARMC6 IAR
-CORES_TO_BUILD:=Cortex-M0 Cortex-M3
-
-CC_GCC:=arm-none-eabi-gcc
-CC_ARM:=armcc
-CC_ARMC6=armclang
-CC_IAR:=iccarm
-LIB_SUFFIX_GCC:=a
-LIB_SUFFIX_ARM:=ar
-LIB_SUFFIX_ARMC6:=ar
-LIB_SUFFIX_IAR:=a
-
-.PHONY: mbed-release
-mbed-release: mbed-release-copy
-	cd release; git add -A
-	(TAG=$$(git describe --tag); cd release; git commit -m "$$TAG")
-	git add release; git commit -m "Update release pointer"
-
-.PHONY: mbed-release-copy
-mbed-release-copy: mbed-release-pre-clean
-	cp mbed_lib.json $(TARGET_DIR)
-	cp -r nanostack $(TARGET_DIR)
-	cp -r docs README.md $(TARGET_DIR)
-	cp -r Doxyfile DOXYGEN_FRONTPAGE.md doxygen $(TARGET_DIR)
-	cp mkdocs.yml $(TARGET_DIR)
-	cp binary_release_template_lisense $(TARGET_DIR)/LICENSE
-	cp binary_release_template_lisense_txt $(TARGET_DIR)/LICENSE-permissive-binary-license-1.0.txt
-	for header in `find release/nanostack -name \*.h`;do awk 'BEGIN{found=0;}{if(!found){print >"tmp-head";}else{print >"tmp-tail"}}/Copyright/{found=1;}' $$header; cat tmp-head binary_release_template_header tmp-tail > tmp && mv tmp $$header; rm tmp-head tmp-tail; done
-
-# Template for generating rules for all configuration options
-# $(1) is Toolchain, GCC, ARM or IAR
-# $(2) is Configuration
-# $(3) is CPU variant
-#
-# Here be dragons... This is dangerous territory. Touch only if you have a beard.
-#
-define mbed-rel-build-template
-mbed-release-build: $(1)-$(2)-$(3)-build
-mbed-release-build-$(1): $(1)-$(2)-$(3)-build
-.PHONY: $(1)-$(2)-build
-$(1)-$(2)-$(3)-build: export-headers
-	@echo Build $(2) on $(1) for $(3)
-	make CC=$(CC_$(1)) CONFIG=$(2) CPU=$(3) APPEND_LIB_NAME=1 CFLAGS="-DNS_USE_EXTERNAL_MBED_TLS -I../mbedtls/include/ -I../crypto/include/"
-
-# Generate target directory name
-# Like: FEATURE_NANOSTACK/FEATURE_LOWPAN_ROUTER/TOOLCHAIN_ARM/TARGET_CORTEX_M0P
-$(1)-$(2)-$(3)-target-dir:=$(TARGET_DIR)/FEATURE_$(shell echo $(2) | tr '[:lower:]' '[:upper:]')/TOOLCHAIN_$(1)/TARGET_$(shell echo $(3) | tr '[:lower:]' '[:upper:]' | tr - _ | sed 's/CORTEX_//')
-# Cortex-M3 is also used for M4...M7, there is alias for them
-ifeq (Cortex-M3,$(3))
-$(1)-$(2)-$(3)-alt-target-dir:=$(TARGET_DIR)/FEATURE_$(shell echo $(2) | tr '[:lower:]' '[:upper:]')/TOOLCHAIN_$(1)/TARGET_RTOS_M4_M7
-endif
-# M0 is used as M0 and M0+. There is alias for them
-ifeq (Cortex-M0,$(3))
-$(1)-$(2)-$(3)-target-dir:=$(TARGET_DIR)/FEATURE_$(shell echo $(2) | tr '[:lower:]' '[:upper:]')/TOOLCHAIN_$(1)/TARGET_LIKE_CORTEX_M0
-endif
-mbed-release-copy: $(1)-$(2)-$(3)-copy
-$(1)-$(2)-$(3)-copy: mbed-release-pre-clean
-	mkdir -p $$($(1)-$(2)-$(3)-target-dir)
-	cp libnanostack_$(CC_$(1))_$(3)_$(2).* $$($(1)-$(2)-$(3)-target-dir)/libnanostack.$(LIB_SUFFIX_$(1))
-ifneq (,$$($(1)-$(2)-$(3)-alt-target-dir))
-	mkdir -p $$($(1)-$(2)-$(3)-alt-target-dir)
-	cp libnanostack_$(CC_$(1))_$(3)_$(2).* $$($(1)-$(2)-$(3)-alt-target-dir)/libnanostack.$(LIB_SUFFIX_$(1))
-endif
-endef
-# Now generate rules
-$(foreach tool,$(TOOLCHAINS_TO_BUILD),$(foreach cpu,$(CORES_TO_BUILD),$(foreach cfg,$(CONFIGURATIONS_TO_BUILD),$(eval $(call mbed-rel-build-template,$(tool),$(cfg),$(cpu))))))
-
-#
-# End of dangerous territory
-#
-
-
-# Run export-headers before build
-.PHONY: export-headers
-export-headers:
-	make -C ../ -f build_external_libs.mk export-headers
-
-.PHONY: mbed-release-pre-clean
-mbed-release-pre-clean:
-	rm -rf $(TARGET_DIR)/*
-
-.PHONY: mbed-release-build
-mbed-release-build:
-	@echo Done
+# CMAKE generated file: DO NOT EDIT!
+# Generated by "Unix Makefiles" Generator, CMake Version 3.21
+
+# Default target executed when no arguments are given to make.
+default_target: all
+.PHONY : default_target
+
+# Allow only one "make -f Makefile2" at a time, but pass parallelism.
+.NOTPARALLEL:
+
+#=============================================================================
+# Special targets provided by cmake.
+
+# Disable implicit rules so canonical targets will work.
+.SUFFIXES:
+
+# Disable VCS-based implicit rules.
+% : %,v
+
+# Disable VCS-based implicit rules.
+% : RCS/%
+
+# Disable VCS-based implicit rules.
+% : RCS/%,v
+
+# Disable VCS-based implicit rules.
+% : SCCS/s.%
+
+# Disable VCS-based implicit rules.
+% : s.%
+
+.SUFFIXES: .hpux_make_needs_suffix_list
+
+# Command-line flag to silence nested $(MAKE).
+$(VERBOSE)MAKESILENT = -s
+
+#Suppress display of executed commands.
+$(VERBOSE).SILENT:
+
+# A target that is always out of date.
+cmake_force:
+.PHONY : cmake_force
+
+#=============================================================================
+# Set environment variables for the build.
+
+# The shell in which to execute make rules.
+SHELL = /bin/sh
+
+# The CMake executable.
+CMAKE_COMMAND = /usr/local/bin/cmake
+
+# The command to remove a file.
+RM = /usr/local/bin/cmake -E rm -f
+
+# Escaping for special characters.
+EQUALS = =
+
+# The top-level source directory on which CMake was run.
+CMAKE_SOURCE_DIR = /home/user/slavikmipt/ONE/compiler/luci-micro
+
+# The top-level build directory on which CMake was run.
+CMAKE_BINARY_DIR = /home/user/slavikmipt/ONE/compiler/luci-micro
+
+#=============================================================================
+# Targets provided globally by CMake.
+
+# Special rule for the target install/strip
+install/strip: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip
+
+# Special rule for the target install/strip
+install/strip/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip/fast
+
+# Special rule for the target install/local
+install/local: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local
+
+# Special rule for the target install/local
+install/local/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local/fast
+
+# Special rule for the target edit_cache
+edit_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake cache editor..."
+	/usr/local/bin/ccmake -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : edit_cache
+
+# Special rule for the target edit_cache
+edit_cache/fast: edit_cache
+.PHONY : edit_cache/fast
+
+# Special rule for the target rebuild_cache
+rebuild_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake to regenerate build system..."
+	/usr/local/bin/cmake --regenerate-during-build -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : rebuild_cache
+
+# Special rule for the target rebuild_cache
+rebuild_cache/fast: rebuild_cache
+.PHONY : rebuild_cache/fast
+
+# Special rule for the target list_install_components
+list_install_components:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Available install components are: \"Unspecified\""
+.PHONY : list_install_components
+
+# Special rule for the target list_install_components
+list_install_components/fast: list_install_components
+.PHONY : list_install_components/fast
+
+# Special rule for the target install
+install: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/local/bin/cmake -P cmake_install.cmake
+.PHONY : install
+
+# Special rule for the target install
+install/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/local/bin/cmake -P cmake_install.cmake
+.PHONY : install/fast
+
+# The main all target
+all: cmake_check_build_system
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -E cmake_progress_start /home/user/slavikmipt/ONE/compiler/luci-micro/CMakeFiles /home/user/slavikmipt/ONE/compiler/luci-micro/mbed-os/connectivity/nanostack/sal-stack-nanostack//CMakeFiles/progress.marks
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/nanostack/sal-stack-nanostack/all
+	$(CMAKE_COMMAND) -E cmake_progress_start /home/user/slavikmipt/ONE/compiler/luci-micro/CMakeFiles 0
+.PHONY : all
+
+# The main clean target
+clean:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/nanostack/sal-stack-nanostack/clean
+.PHONY : clean
+
+# The main clean target
+clean/fast: clean
+.PHONY : clean/fast
+
+# Prepare targets for installation.
+preinstall: all
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/nanostack/sal-stack-nanostack/preinstall
+.PHONY : preinstall
+
+# Prepare targets for installation.
+preinstall/fast:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/connectivity/nanostack/sal-stack-nanostack/preinstall
+.PHONY : preinstall/fast
+
+# clear depends
+depend:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 1
+.PHONY : depend
+
+# Help Target
+help:
+	@echo "The following are some of the valid targets for this Makefile:"
+	@echo "... all (the default if no target is provided)"
+	@echo "... clean"
+	@echo "... depend"
+	@echo "... edit_cache"
+	@echo "... install"
+	@echo "... install/local"
+	@echo "... install/strip"
+	@echo "... list_install_components"
+	@echo "... rebuild_cache"
+.PHONY : help
+
+
+
+#=============================================================================
+# Special targets to cleanup operation of make.
+
+# Special rule to run CMake to check the build system integrity.
+# No rule that depends on this can have commands that come from listfiles
+# because they might be regenerated.
+cmake_check_build_system:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 0
+.PHONY : cmake_check_build_system
+
diff --git a/platform/randlib/Makefile b/platform/randlib/Makefile
index 9a40f3cd..86358d49 100644
--- a/platform/randlib/Makefile
+++ b/platform/randlib/Makefile
@@ -1,5 +1,189 @@
-SRCS := $(wildcard source/*)
-LIB := librand.a
-EXPORT_HEADERS := mbed-client-randlib
+# CMAKE generated file: DO NOT EDIT!
+# Generated by "Unix Makefiles" Generator, CMake Version 3.21
+
+# Default target executed when no arguments are given to make.
+default_target: all
+.PHONY : default_target
+
+# Allow only one "make -f Makefile2" at a time, but pass parallelism.
+.NOTPARALLEL:
+
+#=============================================================================
+# Special targets provided by cmake.
+
+# Disable implicit rules so canonical targets will work.
+.SUFFIXES:
+
+# Disable VCS-based implicit rules.
+% : %,v
+
+# Disable VCS-based implicit rules.
+% : RCS/%
+
+# Disable VCS-based implicit rules.
+% : RCS/%,v
+
+# Disable VCS-based implicit rules.
+% : SCCS/s.%
+
+# Disable VCS-based implicit rules.
+% : s.%
+
+.SUFFIXES: .hpux_make_needs_suffix_list
+
+# Command-line flag to silence nested $(MAKE).
+$(VERBOSE)MAKESILENT = -s
+
+#Suppress display of executed commands.
+$(VERBOSE).SILENT:
+
+# A target that is always out of date.
+cmake_force:
+.PHONY : cmake_force
+
+#=============================================================================
+# Set environment variables for the build.
+
+# The shell in which to execute make rules.
+SHELL = /bin/sh
+
+# The CMake executable.
+CMAKE_COMMAND = /usr/local/bin/cmake
+
+# The command to remove a file.
+RM = /usr/local/bin/cmake -E rm -f
+
+# Escaping for special characters.
+EQUALS = =
+
+# The top-level source directory on which CMake was run.
+CMAKE_SOURCE_DIR = /home/user/slavikmipt/ONE/compiler/luci-micro
+
+# The top-level build directory on which CMake was run.
+CMAKE_BINARY_DIR = /home/user/slavikmipt/ONE/compiler/luci-micro
+
+#=============================================================================
+# Targets provided globally by CMake.
+
+# Special rule for the target install/strip
+install/strip: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip
+
+# Special rule for the target install/strip
+install/strip/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip/fast
+
+# Special rule for the target install/local
+install/local: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local
+
+# Special rule for the target install/local
+install/local/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/local/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local/fast
+
+# Special rule for the target edit_cache
+edit_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake cache editor..."
+	/usr/local/bin/ccmake -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : edit_cache
+
+# Special rule for the target edit_cache
+edit_cache/fast: edit_cache
+.PHONY : edit_cache/fast
+
+# Special rule for the target rebuild_cache
+rebuild_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake to regenerate build system..."
+	/usr/local/bin/cmake --regenerate-during-build -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : rebuild_cache
+
+# Special rule for the target rebuild_cache
+rebuild_cache/fast: rebuild_cache
+.PHONY : rebuild_cache/fast
+
+# Special rule for the target install
+install: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/local/bin/cmake -P cmake_install.cmake
+.PHONY : install
+
+# Special rule for the target install
+install/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/local/bin/cmake -P cmake_install.cmake
+.PHONY : install/fast
+
+# Special rule for the target list_install_components
+list_install_components:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Available install components are: \"Unspecified\""
+.PHONY : list_install_components
+
+# Special rule for the target list_install_components
+list_install_components/fast: list_install_components
+.PHONY : list_install_components/fast
+
+# The main all target
+all: cmake_check_build_system
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -E cmake_progress_start /home/user/slavikmipt/ONE/compiler/luci-micro/CMakeFiles /home/user/slavikmipt/ONE/compiler/luci-micro/mbed-os/platform/randlib//CMakeFiles/progress.marks
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/platform/randlib/all
+	$(CMAKE_COMMAND) -E cmake_progress_start /home/user/slavikmipt/ONE/compiler/luci-micro/CMakeFiles 0
+.PHONY : all
+
+# The main clean target
+clean:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/platform/randlib/clean
+.PHONY : clean
+
+# The main clean target
+clean/fast: clean
+.PHONY : clean/fast
+
+# Prepare targets for installation.
+preinstall: all
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/platform/randlib/preinstall
+.PHONY : preinstall
+
+# Prepare targets for installation.
+preinstall/fast:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 mbed-os/platform/randlib/preinstall
+.PHONY : preinstall/fast
+
+# clear depends
+depend:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 1
+.PHONY : depend
+
+# Help Target
+help:
+	@echo "The following are some of the valid targets for this Makefile:"
+	@echo "... all (the default if no target is provided)"
+	@echo "... clean"
+	@echo "... depend"
+	@echo "... edit_cache"
+	@echo "... install"
+	@echo "... install/local"
+	@echo "... install/strip"
+	@echo "... list_install_components"
+	@echo "... rebuild_cache"
+.PHONY : help
+
+
+
+#=============================================================================
+# Special targets to cleanup operation of make.
+
+# Special rule to run CMake to check the build system integrity.
+# No rule that depends on this can have commands that come from listfiles
+# because they might be regenerated.
+cmake_check_build_system:
+	cd /home/user/slavikmipt/ONE/compiler/luci-micro && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 0
+.PHONY : cmake_check_build_system

-include ../exported_rules.mk
diff --git a/tools/cmake/toolchains/GCC_ARM.cmake b/tools/cmake/toolchains/GCC_ARM.cmake
index 7c187a0b..9f960d2b 100644
--- a/tools/cmake/toolchains/GCC_ARM.cmake
+++ b/tools/cmake/toolchains/GCC_ARM.cmake
@@ -1,10 +1,6 @@
 # Copyright (c) 2020 ARM Limited. All rights reserved.
 # SPDX-License-Identifier: Apache-2.0

-set(CMAKE_ASM_COMPILER "arm-none-eabi-gcc")
-set(CMAKE_C_COMPILER "arm-none-eabi-gcc")
-set(CMAKE_CXX_COMPILER "arm-none-eabi-g++")
-set(GCC_ELF2BIN "arm-none-eabi-objcopy")
 set_property(GLOBAL PROPERTY ELF2BIN ${GCC_ELF2BIN})

 # build toolchain flags that get passed to everything (including CMake compiler checks)
