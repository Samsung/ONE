<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ONE - On-device Neural Engine: nnfw::cker::optimized::depthwise_conv Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ONE - On-device Neural Engine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('namespacennfw_1_1cker_1_1optimized_1_1depthwise__conv.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">nnfw::cker::optimized::depthwise_conv Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnnfw_1_1cker_1_1optimized_1_1depthwise__conv_1_1_quantized_depthwise_conv_kernel.html">QuantizedDepthwiseConvKernel</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adf2547e9a7129861ac2bb8a7b32ab4b2"><td class="memTemplParams" colspan="2">template&lt;bool kAllowStrided, int kFixedInputDepth, int kFixedDepthMultiplier&gt; </td></tr>
<tr class="memitem:adf2547e9a7129861ac2bb8a7b32ab4b2"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacennfw_1_1cker_1_1optimized_1_1depthwise__conv.html#adf2547e9a7129861ac2bb8a7b32ab4b2">QuantizedDepthwiseConvAccumRow</a> (int stride, int dilation_factor, int input_depth, int input_width, const uint8_t *input_data, int16_t input_offset, int pad_width, int depth_multiplier, int filter_width, const uint8_t *filter_data, int16_t filter_offset, int out_x_buffer_start, int out_x_buffer_end, int output_depth, int32_t *acc_buffer)</td></tr>
<tr class="separator:adf2547e9a7129861ac2bb8a7b32ab4b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa432b80504a69aefe8ee0a4f0a4d94f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacennfw_1_1cker_1_1optimized_1_1depthwise__conv.html#aa432b80504a69aefe8ee0a4f0a4d94f8">QuantizedDepthwiseConvAccumRowGeneric</a> (int stride, int dilation_factor, int input_depth, int input_width, const uint8_t *input_data, int16_t input_offset, int pad_width, int depth_multiplier, int filter_width, const uint8_t *filter_data, int16_t filter_offset, int out_x_buffer_start, int out_x_buffer_end, int output_depth, int32_t *acc_buffer)</td></tr>
<tr class="separator:aa432b80504a69aefe8ee0a4f0a4d94f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b1b66890f9515899386cdb50acafbe3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacennfw_1_1cker_1_1optimized_1_1depthwise__conv.html#a2b1b66890f9515899386cdb50acafbe3">DepthwiseConvInitAccBuffer</a> (int num_output_pixels, int output_depth, const int32_t *bias_data, int32_t *acc_buffer)</td></tr>
<tr class="separator:a2b1b66890f9515899386cdb50acafbe3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e5f7a3eadfba82e028f4983a462c5cb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacennfw_1_1cker_1_1optimized_1_1depthwise__conv.html#a9e5f7a3eadfba82e028f4983a462c5cb">DepthwiseConvGeneral</a> (const <a class="el" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html">DepthwiseConvParams</a> &amp;params, const <a class="el" href="classnnfw_1_1cker_1_1_shape.html">Shape</a> &amp;input_shape, const uint8_t *input_data, const <a class="el" href="classnnfw_1_1cker_1_1_shape.html">Shape</a> &amp;filter_shape, const uint8_t *filter_data, const <a class="el" href="classnnfw_1_1cker_1_1_shape.html">Shape</a> &amp;bias_shape, const int32_t *bias_data, const <a class="el" href="classnnfw_1_1cker_1_1_shape.html">Shape</a> &amp;output_shape, uint8_t *output_data, int thread_start, int thread_end, int thread_dim)</td></tr>
<tr class="separator:a9e5f7a3eadfba82e028f4983a462c5cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a9e5f7a3eadfba82e028f4983a462c5cb" name="a9e5f7a3eadfba82e028f4983a462c5cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e5f7a3eadfba82e028f4983a462c5cb">&#9670;&#160;</a></span>DepthwiseConvGeneral()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void nnfw::cker::optimized::depthwise_conv::DepthwiseConvGeneral </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html">DepthwiseConvParams</a> &amp;&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classnnfw_1_1cker_1_1_shape.html">Shape</a> &amp;&#160;</td>
          <td class="paramname"><em>input_shape</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>input_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classnnfw_1_1cker_1_1_shape.html">Shape</a> &amp;&#160;</td>
          <td class="paramname"><em>filter_shape</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>filter_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classnnfw_1_1cker_1_1_shape.html">Shape</a> &amp;&#160;</td>
          <td class="paramname"><em>bias_shape</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t *&#160;</td>
          <td class="paramname"><em>bias_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classnnfw_1_1cker_1_1_shape.html">Shape</a> &amp;&#160;</td>
          <td class="paramname"><em>output_shape</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>output_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>thread_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>thread_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>thread_dim</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimized_2_depthwise_conv_u_int8_8h_source.html#l01814">1814</a> of file <a class="el" href="optimized_2_depthwise_conv_u_int8_8h_source.html">DepthwiseConvUint8.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1820</span>{</div>
<div class="line"><span class="lineno"> 1821</span>  (void)bias_shape;</div>
<div class="line"><span class="lineno"> 1822</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> stride_width = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a65cb7bfeb2b801d8a574a85da10598ff">stride_width</a>;</div>
<div class="line"><span class="lineno"> 1823</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> stride_height = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#ad2dbdcb99cb6434e20c073adf4266bef">stride_height</a>;</div>
<div class="line"><span class="lineno"> 1824</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> pad_width = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#ab424f92784d7f28eba2b61dcb1be277b">padding_values</a>.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_padding_values.html#a2a3dd79d28c30c5da865290160601fd1">width</a>;</div>
<div class="line"><span class="lineno"> 1825</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> pad_height = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#ab424f92784d7f28eba2b61dcb1be277b">padding_values</a>.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_padding_values.html#a1dc41a9ebbd61a7c34ed2b5dd2ec10eb">height</a>;</div>
<div class="line"><span class="lineno"> 1826</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> depth_multiplier = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#aaa0e9f0f50f1ed3c8e25886d51a45f75">depth_multiplier</a>;</div>
<div class="line"><span class="lineno"> 1827</span>  <span class="keyword">const</span> int32_t output_activation_min = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a7cc7d4366172494e8a67dc7b69de07b1">quantized_activation_min</a>;</div>
<div class="line"><span class="lineno"> 1828</span>  <span class="keyword">const</span> int32_t output_activation_max = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a54c8882742f94c3f5f601a9d81fce456">quantized_activation_max</a>;</div>
<div class="line"><span class="lineno"> 1829</span>  <span class="keyword">const</span> int32_t input_offset = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a2660e5e3746138d3f3d31c6a17012fc1">input_offset</a>;</div>
<div class="line"><span class="lineno"> 1830</span>  <span class="keyword">const</span> int32_t filter_offset = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#aa9b7463f82fb236bef93376ae9b4c71c">weights_offset</a>;</div>
<div class="line"><span class="lineno"> 1831</span>  <span class="keyword">const</span> int32_t output_offset = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a01a008eb3a82ad7cd76020c35c944b25">output_offset</a>;</div>
<div class="line"><span class="lineno"> 1832</span>  <span class="keyword">const</span> int32_t output_multiplier = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a45543a54fe9f6a5c89cc1fde2aea8bd1">output_multiplier</a>;</div>
<div class="line"><span class="lineno"> 1833</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> output_shift = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#af0b74f66af25169d9aee4b30ec105ced">output_shift</a>;</div>
<div class="line"><span class="lineno"> 1834</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> dilation_width_factor = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a50d46dad3a5d5bec206a3f10f1168768">dilation_width_factor</a>;</div>
<div class="line"><span class="lineno"> 1835</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> dilation_height_factor = params.<a class="code hl_variable" href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a2a11fa7f567b0faa4551dfe628d6de2b">dilation_height_factor</a>;</div>
<div class="line"><span class="lineno"> 1836</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> batches = <a class="code hl_function" href="namespacennfw_1_1cker.html#a0a74e72b1bffcb6519de7fc224416ff9">MatchingDim</a>(input_shape, 0, output_shape, 0);</div>
<div class="line"><span class="lineno"> 1837</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> output_depth = <a class="code hl_function" href="namespacennfw_1_1cker.html#a0a74e72b1bffcb6519de7fc224416ff9">MatchingDim</a>(filter_shape, 3, output_shape, 3);</div>
<div class="line"><span class="lineno"> 1838</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> input_height = input_shape.<a class="code hl_function" href="classnnfw_1_1cker_1_1_shape.html#a497180ee7844bbef51b36bd58e61fa31">Dims</a>(1);</div>
<div class="line"><span class="lineno"> 1839</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> input_width = input_shape.<a class="code hl_function" href="classnnfw_1_1cker_1_1_shape.html#a497180ee7844bbef51b36bd58e61fa31">Dims</a>(2);</div>
<div class="line"><span class="lineno"> 1840</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> input_depth = input_shape.<a class="code hl_function" href="classnnfw_1_1cker_1_1_shape.html#a497180ee7844bbef51b36bd58e61fa31">Dims</a>(3);</div>
<div class="line"><span class="lineno"> 1841</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> filter_height = filter_shape.<a class="code hl_function" href="classnnfw_1_1cker_1_1_shape.html#a497180ee7844bbef51b36bd58e61fa31">Dims</a>(1);</div>
<div class="line"><span class="lineno"> 1842</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> filter_width = filter_shape.<a class="code hl_function" href="classnnfw_1_1cker_1_1_shape.html#a497180ee7844bbef51b36bd58e61fa31">Dims</a>(2);</div>
<div class="line"><span class="lineno"> 1843</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> output_height = output_shape.Dims(1);</div>
<div class="line"><span class="lineno"> 1844</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> output_width = output_shape.Dims(2);</div>
<div class="line"><span class="lineno"> 1845</span><span class="preprocessor">#ifdef USE_NEON</span></div>
<div class="line"><span class="lineno"> 1846</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> shift_left = (output_shift &gt; 0);</div>
<div class="line"><span class="lineno"> 1847</span>  <span class="keyword">const</span> int32_t multiplier_power_of_two = shift_left ? (1 &lt;&lt; output_shift) : 1;</div>
<div class="line"><span class="lineno"> 1848</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1849</span> </div>
<div class="line"><span class="lineno"> 1850</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kAccBufferMaxSize = 2048;</div>
<div class="line"><span class="lineno"> 1851</span>  int32_t acc_buffer[kAccBufferMaxSize];</div>
<div class="line"><span class="lineno"> 1852</span>  assert(kAccBufferMaxSize &gt;= output_depth);</div>
<div class="line"><span class="lineno"> 1853</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> kOutputPixelsInAccBuffer = kAccBufferMaxSize / output_depth;</div>
<div class="line"><span class="lineno"> 1854</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> kAccBufferActualSize = kOutputPixelsInAccBuffer * output_depth;</div>
<div class="line"><span class="lineno"> 1855</span>  assert(kOutputPixelsInAccBuffer * output_depth &lt;= kAccBufferActualSize);</div>
<div class="line"><span class="lineno"> 1856</span>  assert(kAccBufferActualSize &lt;= kAccBufferMaxSize);</div>
<div class="line"><span class="lineno"> 1857</span>  assert(kOutputPixelsInAccBuffer &gt;= 1);</div>
<div class="line"><span class="lineno"> 1858</span>  assert(thread_dim == 0 || thread_dim == 1);</div>
<div class="line"><span class="lineno"> 1859</span> </div>
<div class="line"><span class="lineno"> 1860</span>  <a class="code hl_define" href="compute_2cker_2include_2cker_2_shape_8h.html#a044d7f999713173dd3360b0aa40370fd">UNUSED_RELEASE</a>(kAccBufferActualSize);</div>
<div class="line"><span class="lineno"> 1861</span> </div>
<div class="line"><span class="lineno"> 1862</span>  <span class="comment">// row_accum_func will point to the core accumulation function to be used</span></div>
<div class="line"><span class="lineno"> 1863</span>  <span class="comment">// for this DepthwiseConv op.</span></div>
<div class="line"><span class="lineno"> 1864</span>  <span class="keyword">using </span>row_accum_func_t = <span class="keyword">decltype</span>(&amp;<a class="code hl_function" href="namespacennfw_1_1cker_1_1optimized_1_1depthwise__conv.html#aa432b80504a69aefe8ee0a4f0a4d94f8">QuantizedDepthwiseConvAccumRowGeneric</a>);</div>
<div class="line"><span class="lineno"> 1865</span>  row_accum_func_t row_accum_func = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno"> 1866</span> </div>
<div class="line"><span class="lineno"> 1867</span><span class="preprocessor">#define TFMINI_USE_DEPTHWISECONV_KERNEL(ALLOW_STRIDED, FIXED_INPUT_DEPTH, FIXED_DEPTH_MULTIPLIER) \</span></div>
<div class="line"><span class="lineno"> 1868</span><span class="preprocessor">  if (!row_accum_func &amp;&amp; (stride_width == 1 || ALLOW_STRIDED) &amp;&amp;                                  \</span></div>
<div class="line"><span class="lineno"> 1869</span><span class="preprocessor">      (input_depth == FIXED_INPUT_DEPTH || FIXED_INPUT_DEPTH == 0) &amp;&amp;                             \</span></div>
<div class="line"><span class="lineno"> 1870</span><span class="preprocessor">      depth_multiplier == FIXED_DEPTH_MULTIPLIER)                                                 \</span></div>
<div class="line"><span class="lineno"> 1871</span><span class="preprocessor">  {                                                                                               \</span></div>
<div class="line"><span class="lineno"> 1872</span><span class="preprocessor">    row_accum_func =                                                                              \</span></div>
<div class="line"><span class="lineno"> 1873</span><span class="preprocessor">      QuantizedDepthwiseConvAccumRow&lt;ALLOW_STRIDED, FIXED_INPUT_DEPTH, FIXED_DEPTH_MULTIPLIER&gt;;   \</span></div>
<div class="line"><span class="lineno"> 1874</span><span class="preprocessor">  }</span></div>
<div class="line"><span class="lineno"> 1875</span> </div>
<div class="line"><span class="lineno"> 1876</span><span class="preprocessor">#ifdef USE_NEON</span></div>
<div class="line"><span class="lineno"> 1877</span>  <span class="comment">// We go over our list of kernels by decreasing order of preference</span></div>
<div class="line"><span class="lineno"> 1878</span>  <span class="comment">// for the cases where multiple kernels could apply.</span></div>
<div class="line"><span class="lineno"> 1879</span> </div>
<div class="line"><span class="lineno"> 1880</span>  <span class="comment">// Start with the fastest kernels: AllowStrided=false, fixed input depth.</span></div>
<div class="line"><span class="lineno"> 1881</span> </div>
<div class="line"><span class="lineno"> 1882</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(<span class="keyword">false</span>, 1, 2)</div>
<div class="line"><span class="lineno"> 1883</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(false, 2, 2)</div>
<div class="line"><span class="lineno"> 1884</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(false, 4, 2)</div>
<div class="line"><span class="lineno"> 1885</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(false, 1, 4)</div>
<div class="line"><span class="lineno"> 1886</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(false, 4, 1)</div>
<div class="line"><span class="lineno"> 1887</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(false, 4, 4)</div>
<div class="line"><span class="lineno"> 1888</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(false, 8, 1)</div>
<div class="line"><span class="lineno"> 1889</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(false, 2, 8)</div>
<div class="line"><span class="lineno"> 1890</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(false, 2, 1)</div>
<div class="line"><span class="lineno"> 1891</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(false, 12, 1)</div>
<div class="line"><span class="lineno"> 1892</span> </div>
<div class="line"><span class="lineno"> 1893</span>  <span class="comment">// Next come the strided kernels: AllowStrided=true, fixed input depth.</span></div>
<div class="line"><span class="lineno"> 1894</span>  <span class="comment">// They are a bit less efficient, but allow stride!=1.</span></div>
<div class="line"><span class="lineno"> 1895</span> </div>
<div class="line"><span class="lineno"> 1896</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(true, 8, 2)</div>
<div class="line"><span class="lineno"> 1897</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(true, 16, 1)</div>
<div class="line"><span class="lineno"> 1898</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(true, 1, 16)</div>
<div class="line"><span class="lineno"> 1899</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(true, 1, 20)</div>
<div class="line"><span class="lineno"> 1900</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(true, 1, 32)</div>
<div class="line"><span class="lineno"> 1901</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(true, 1, 8)</div>
<div class="line"><span class="lineno"> 1902</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(true, 8, 1)</div>
<div class="line"><span class="lineno"> 1903</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(true, 2, 1)</div>
<div class="line"><span class="lineno"> 1904</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(true, 4, 1)</div>
<div class="line"><span class="lineno"> 1905</span> </div>
<div class="line"><span class="lineno"> 1906</span>  <span class="comment">// Finally, the kernels allowing a variable input depth,</span></div>
<div class="line"><span class="lineno"> 1907</span>  <span class="comment">// these are the least efficient but most general kernels.</span></div>
<div class="line"><span class="lineno"> 1908</span> </div>
<div class="line"><span class="lineno"> 1909</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(true, 0, 1)</div>
<div class="line"><span class="lineno"> 1910</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(true, 0, 2)</div>
<div class="line"><span class="lineno"> 1911</span>  <a class="code hl_define" href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>(true, 0, 3)</div>
<div class="line"><span class="lineno"> 1912</span><span class="preprocessor">#endif </span><span class="comment">// USE_NEON</span></div>
<div class="line"><span class="lineno"> 1913</span> </div>
<div class="line"><span class="lineno"> 1914</span>  <span class="comment">// No matching fast kernel found, use slow fallback.</span></div>
<div class="line"><span class="lineno"> 1915</span>  <span class="keywordflow">if</span> (!row_accum_func)</div>
<div class="line"><span class="lineno"> 1916</span>  {</div>
<div class="line"><span class="lineno"> 1917</span>    row_accum_func = <a class="code hl_function" href="namespacennfw_1_1cker_1_1optimized_1_1depthwise__conv.html#aa432b80504a69aefe8ee0a4f0a4d94f8">QuantizedDepthwiseConvAccumRowGeneric</a>;</div>
<div class="line"><span class="lineno"> 1918</span>  }</div>
<div class="line"><span class="lineno"> 1919</span> </div>
<div class="line"><span class="lineno"> 1920</span><span class="preprocessor">#undef TFMINI_USE_DEPTHWISECONV_KERNEL</span></div>
<div class="line"><span class="lineno"> 1921</span> </div>
<div class="line"><span class="lineno"> 1922</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> input_height_stride = input_shape.<a class="code hl_function" href="classnnfw_1_1cker_1_1_shape.html#a497180ee7844bbef51b36bd58e61fa31">Dims</a>(3) * input_shape.<a class="code hl_function" href="classnnfw_1_1cker_1_1_shape.html#a497180ee7844bbef51b36bd58e61fa31">Dims</a>(2);</div>
<div class="line"><span class="lineno"> 1923</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> input_batch_stride = input_height_stride * input_shape.<a class="code hl_function" href="classnnfw_1_1cker_1_1_shape.html#a497180ee7844bbef51b36bd58e61fa31">Dims</a>(1);</div>
<div class="line"><span class="lineno"> 1924</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> filter_height_stride = filter_shape.<a class="code hl_function" href="classnnfw_1_1cker_1_1_shape.html#a497180ee7844bbef51b36bd58e61fa31">Dims</a>(3) * filter_shape.<a class="code hl_function" href="classnnfw_1_1cker_1_1_shape.html#a497180ee7844bbef51b36bd58e61fa31">Dims</a>(2);</div>
<div class="line"><span class="lineno"> 1925</span> </div>
<div class="line"><span class="lineno"> 1926</span>  <span class="comment">// Now that we have determined row_accum_func, we can start work.</span></div>
<div class="line"><span class="lineno"> 1927</span>  <span class="keywordtype">int</span> batch_start = 0;</div>
<div class="line"><span class="lineno"> 1928</span>  <span class="keywordtype">int</span> batch_end = batches;</div>
<div class="line"><span class="lineno"> 1929</span>  <span class="keywordtype">int</span> row_start = 0;</div>
<div class="line"><span class="lineno"> 1930</span>  <span class="keywordtype">int</span> row_end = output_height;</div>
<div class="line"><span class="lineno"> 1931</span>  <span class="keywordtype">int</span> output_ptr_offset = 0;</div>
<div class="line"><span class="lineno"> 1932</span> </div>
<div class="line"><span class="lineno"> 1933</span>  <span class="keywordflow">switch</span> (thread_dim)</div>
<div class="line"><span class="lineno"> 1934</span>  {</div>
<div class="line"><span class="lineno"> 1935</span>    <span class="keywordflow">case</span> 0:</div>
<div class="line"><span class="lineno"> 1936</span>      <span class="comment">// Multithread along with the batch axis</span></div>
<div class="line"><span class="lineno"> 1937</span>      assert(thread_start &gt;= 0);</div>
<div class="line"><span class="lineno"> 1938</span>      assert(thread_end &lt;= batches);</div>
<div class="line"><span class="lineno"> 1939</span>      batch_start = thread_start;</div>
<div class="line"><span class="lineno"> 1940</span>      batch_end = thread_end;</div>
<div class="line"><span class="lineno"> 1941</span>      output_ptr_offset = batch_start * <a class="code hl_function" href="namespacennfw_1_1cker.html#a59fdb0b28360a8fcf55b1080b63eefb3">FlatSizeSkipDim</a>(output_shape, 0);</div>
<div class="line"><span class="lineno"> 1942</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1943</span>    <span class="keywordflow">case</span> 1:</div>
<div class="line"><span class="lineno"> 1944</span>      <span class="comment">// Multithread along with the row axis</span></div>
<div class="line"><span class="lineno"> 1945</span>      assert(thread_start &gt;= 0);</div>
<div class="line"><span class="lineno"> 1946</span>      assert(thread_end &lt;= output_height);</div>
<div class="line"><span class="lineno"> 1947</span>      row_start = thread_start;</div>
<div class="line"><span class="lineno"> 1948</span>      row_end = thread_end;</div>
<div class="line"><span class="lineno"> 1949</span>      output_ptr_offset = row_start * output_width * output_depth;</div>
<div class="line"><span class="lineno"> 1950</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1951</span>  }</div>
<div class="line"><span class="lineno"> 1952</span> </div>
<div class="line"><span class="lineno"> 1953</span>  uint8_t *output_ptr = output_data + output_ptr_offset;</div>
<div class="line"><span class="lineno"> 1954</span>  <span class="keywordtype">int</span> batch_step = (output_height + row_start - row_end) * output_width * output_depth;</div>
<div class="line"><span class="lineno"> 1955</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> b = batch_start; b &lt; batch_end; ++b)</div>
<div class="line"><span class="lineno"> 1956</span>  {</div>
<div class="line"><span class="lineno"> 1957</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> out_y = row_start; out_y &lt; row_end; ++out_y)</div>
<div class="line"><span class="lineno"> 1958</span>    {</div>
<div class="line"><span class="lineno"> 1959</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> in_y_origin = (out_y * stride_height) - pad_height;</div>
<div class="line"><span class="lineno"> 1960</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> filter_y_start =</div>
<div class="line"><span class="lineno"> 1961</span>        std::max(0, (-in_y_origin + dilation_height_factor - 1) / dilation_height_factor);</div>
<div class="line"><span class="lineno"> 1962</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> filter_y_end =</div>
<div class="line"><span class="lineno"> 1963</span>        std::min(filter_height, (input_height - in_y_origin + dilation_height_factor - 1) /</div>
<div class="line"><span class="lineno"> 1964</span>                                  dilation_height_factor);</div>
<div class="line"><span class="lineno"> 1965</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> out_x_buffer_start = 0; out_x_buffer_start &lt; output_width;</div>
<div class="line"><span class="lineno"> 1966</span>           out_x_buffer_start += kOutputPixelsInAccBuffer)</div>
<div class="line"><span class="lineno"> 1967</span>      {</div>
<div class="line"><span class="lineno"> 1968</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> out_x_buffer_end =</div>
<div class="line"><span class="lineno"> 1969</span>          std::min(output_width, out_x_buffer_start + kOutputPixelsInAccBuffer);</div>
<div class="line"><span class="lineno"> 1970</span>        <span class="comment">// We call a &#39;pixel&#39; a group of activation that share all but the</span></div>
<div class="line"><span class="lineno"> 1971</span>        <span class="comment">// &#39;depth&#39;/&#39;channel&#39; coordinate. num_output_pixels is the number of</span></div>
<div class="line"><span class="lineno"> 1972</span>        <span class="comment">// output pixels that we will accumulate in this loop iteration.</span></div>
<div class="line"><span class="lineno"> 1973</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> num_output_pixels = out_x_buffer_end - out_x_buffer_start;</div>
<div class="line"><span class="lineno"> 1974</span>        <span class="comment">// Initialize our local accumulator with the bias values, so we don&#39;t</span></div>
<div class="line"><span class="lineno"> 1975</span>        <span class="comment">// have to add them later.</span></div>
<div class="line"><span class="lineno"> 1976</span>        DepthwiseConvInitAccBuffer(num_output_pixels, output_depth, bias_data, acc_buffer);</div>
<div class="line"><span class="lineno"> 1977</span>        <span class="comment">// Accumulation loop. Most of the time should be spent in here.</span></div>
<div class="line"><span class="lineno"> 1978</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> filter_y = filter_y_start; filter_y &lt; filter_y_end; ++filter_y)</div>
<div class="line"><span class="lineno"> 1979</span>        {</div>
<div class="line"><span class="lineno"> 1980</span>          <span class="keyword">const</span> <span class="keywordtype">int</span> in_y = in_y_origin + dilation_height_factor * filter_y;</div>
<div class="line"><span class="lineno"> 1981</span>          row_accum_func(stride_width, dilation_width_factor, input_depth, input_width,</div>
<div class="line"><span class="lineno"> 1982</span>                         input_data + in_y * input_height_stride + b * input_batch_stride,</div>
<div class="line"><span class="lineno"> 1983</span>                         input_offset, pad_width, depth_multiplier, filter_width,</div>
<div class="line"><span class="lineno"> 1984</span>                         filter_data + filter_y * filter_height_stride, filter_offset,</div>
<div class="line"><span class="lineno"> 1985</span>                         out_x_buffer_start, out_x_buffer_end, output_depth, acc_buffer);</div>
<div class="line"><span class="lineno"> 1986</span>        }</div>
<div class="line"><span class="lineno"> 1987</span>        <span class="comment">// Finished accumulating int32_t values. Now need to convert them to</span></div>
<div class="line"><span class="lineno"> 1988</span>        <span class="comment">// the final 8bit form and store them.</span></div>
<div class="line"><span class="lineno"> 1989</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> num_output_values = output_depth * num_output_pixels;</div>
<div class="line"><span class="lineno"> 1990</span>        <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><span class="lineno"> 1991</span><span class="preprocessor">#ifdef USE_NEON</span></div>
<div class="line"><span class="lineno"> 1992</span>        <span class="keyword">using </span>gemmlowp::RoundingDivideByPOT;</div>
<div class="line"><span class="lineno"> 1993</span>        <span class="keyword">const</span> int32x4_t output_offset_vec = vdupq_n_s32(output_offset);</div>
<div class="line"><span class="lineno"> 1994</span>        <span class="keyword">const</span> int32x4_t output_activation_min_vec = vdupq_n_s32(output_activation_min);</div>
<div class="line"><span class="lineno"> 1995</span>        <span class="keyword">const</span> int32x4_t output_activation_max_vec = vdupq_n_s32(output_activation_max);</div>
<div class="line"><span class="lineno"> 1996</span>        <span class="comment">// Handle 16 values at once.</span></div>
<div class="line"><span class="lineno"> 1997</span>        <span class="comment">// This allows us to issue 4 mutually independent int32</span></div>
<div class="line"><span class="lineno"> 1998</span>        <span class="comment">// multiplications (vqrdmulh), which should alleviate most of their</span></div>
<div class="line"><span class="lineno"> 1999</span>        <span class="comment">// high latency.</span></div>
<div class="line"><span class="lineno"> 2000</span>        <span class="keywordflow">for</span> (; i &lt;= num_output_values - 16; i += 16)</div>
<div class="line"><span class="lineno"> 2001</span>        {</div>
<div class="line"><span class="lineno"> 2002</span>          int32x4_t acc[4];</div>
<div class="line"><span class="lineno"> 2003</span>          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; j++)</div>
<div class="line"><span class="lineno"> 2004</span>          {</div>
<div class="line"><span class="lineno"> 2005</span>            acc[j] = vld1q_s32(acc_buffer + i + 4 * j);</div>
<div class="line"><span class="lineno"> 2006</span>          }</div>
<div class="line"><span class="lineno"> 2007</span> </div>
<div class="line"><span class="lineno"> 2008</span>          <span class="keywordflow">if</span> (!shift_left)</div>
<div class="line"><span class="lineno"> 2009</span>          {</div>
<div class="line"><span class="lineno"> 2010</span>            <span class="comment">// Fixed-point multiplication.</span></div>
<div class="line"><span class="lineno"> 2011</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; j++)</div>
<div class="line"><span class="lineno"> 2012</span>            {</div>
<div class="line"><span class="lineno"> 2013</span>              acc[j] = vqrdmulhq_n_s32(acc[j], output_multiplier);</div>
<div class="line"><span class="lineno"> 2014</span>            }</div>
<div class="line"><span class="lineno"> 2015</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; j++)</div>
<div class="line"><span class="lineno"> 2016</span>            {</div>
<div class="line"><span class="lineno"> 2017</span>              acc[j] = <a class="code hl_function" href="namespacemir__interpreter.html#ad9d7c658eff8ea0271be68502b878395">RoundingDivideByPOT</a>(acc[j], -output_shift);</div>
<div class="line"><span class="lineno"> 2018</span>            }</div>
<div class="line"><span class="lineno"> 2019</span>          }</div>
<div class="line"><span class="lineno"> 2020</span>          <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 2021</span>          {</div>
<div class="line"><span class="lineno"> 2022</span>            <span class="comment">// Fixed-point multiplication.</span></div>
<div class="line"><span class="lineno"> 2023</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; j++)</div>
<div class="line"><span class="lineno"> 2024</span>            {</div>
<div class="line"><span class="lineno"> 2025</span>              acc[j] = vmulq_n_s32(acc[j], multiplier_power_of_two);</div>
<div class="line"><span class="lineno"> 2026</span>              acc[j] = vqrdmulhq_n_s32(acc[j], output_multiplier);</div>
<div class="line"><span class="lineno"> 2027</span>            }</div>
<div class="line"><span class="lineno"> 2028</span>          }</div>
<div class="line"><span class="lineno"> 2029</span>          <span class="comment">// Add the output offset.</span></div>
<div class="line"><span class="lineno"> 2030</span>          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; j++)</div>
<div class="line"><span class="lineno"> 2031</span>          {</div>
<div class="line"><span class="lineno"> 2032</span>            acc[j] = vaddq_s32(acc[j], output_offset_vec);</div>
<div class="line"><span class="lineno"> 2033</span>          }</div>
<div class="line"><span class="lineno"> 2034</span>          <span class="comment">// Apply the activation function.</span></div>
<div class="line"><span class="lineno"> 2035</span>          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; j++)</div>
<div class="line"><span class="lineno"> 2036</span>          {</div>
<div class="line"><span class="lineno"> 2037</span>            acc[j] = vmaxq_s32(acc[j], output_activation_min_vec);</div>
<div class="line"><span class="lineno"> 2038</span>          }</div>
<div class="line"><span class="lineno"> 2039</span>          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; j++)</div>
<div class="line"><span class="lineno"> 2040</span>          {</div>
<div class="line"><span class="lineno"> 2041</span>            acc[j] = vminq_s32(acc[j], output_activation_max_vec);</div>
<div class="line"><span class="lineno"> 2042</span>          }</div>
<div class="line"><span class="lineno"> 2043</span>          <span class="comment">// Saturating cast to uint8_t and store to destination.</span></div>
<div class="line"><span class="lineno"> 2044</span>          int16x4_t acc_s16[4];</div>
<div class="line"><span class="lineno"> 2045</span>          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; j++)</div>
<div class="line"><span class="lineno"> 2046</span>          {</div>
<div class="line"><span class="lineno"> 2047</span>            acc_s16[j] = vqmovn_s32(acc[j]);</div>
<div class="line"><span class="lineno"> 2048</span>          }</div>
<div class="line"><span class="lineno"> 2049</span>          <span class="keyword">const</span> int16x8_t res_s16_0 = vcombine_s16(acc_s16[0], acc_s16[1]);</div>
<div class="line"><span class="lineno"> 2050</span>          <span class="keyword">const</span> int16x8_t res_s16_1 = vcombine_s16(acc_s16[2], acc_s16[3]);</div>
<div class="line"><span class="lineno"> 2051</span>          <span class="keyword">const</span> uint8x8_t res_u8_0 = vqmovun_s16(res_s16_0);</div>
<div class="line"><span class="lineno"> 2052</span>          <span class="keyword">const</span> uint8x8_t res_u8_1 = vqmovun_s16(res_s16_1);</div>
<div class="line"><span class="lineno"> 2053</span>          vst1q_u8(output_ptr, vcombine_u8(res_u8_0, res_u8_1));</div>
<div class="line"><span class="lineno"> 2054</span>          output_ptr += 16;</div>
<div class="line"><span class="lineno"> 2055</span>        }</div>
<div class="line"><span class="lineno"> 2056</span>        <span class="comment">// Handle 8 values at once.</span></div>
<div class="line"><span class="lineno"> 2057</span>        <span class="comment">// Not as good as 16 (now we&#39;re only issuing 2 mutually independent</span></div>
<div class="line"><span class="lineno"> 2058</span>        <span class="comment">// vqrdmulh instructions, so we&#39;re probably paying for their high</span></div>
<div class="line"><span class="lineno"> 2059</span>        <span class="comment">// latency).</span></div>
<div class="line"><span class="lineno"> 2060</span>        <span class="keywordflow">for</span> (; i &lt;= num_output_values - 8; i += 8)</div>
<div class="line"><span class="lineno"> 2061</span>        {</div>
<div class="line"><span class="lineno"> 2062</span>          int32x4_t acc0 = vld1q_s32(acc_buffer + i);</div>
<div class="line"><span class="lineno"> 2063</span>          int32x4_t acc1 = vld1q_s32(acc_buffer + i + 4);</div>
<div class="line"><span class="lineno"> 2064</span>          <span class="keywordflow">if</span> (!shift_left)</div>
<div class="line"><span class="lineno"> 2065</span>          {</div>
<div class="line"><span class="lineno"> 2066</span>            <span class="comment">// Fixed-point multiplication.</span></div>
<div class="line"><span class="lineno"> 2067</span>            acc0 = vqrdmulhq_n_s32(acc0, output_multiplier);</div>
<div class="line"><span class="lineno"> 2068</span>            acc1 = vqrdmulhq_n_s32(acc1, output_multiplier);</div>
<div class="line"><span class="lineno"> 2069</span>            <span class="comment">// Rounding right shift.</span></div>
<div class="line"><span class="lineno"> 2070</span>            acc0 = <a class="code hl_function" href="namespacemir__interpreter.html#ad9d7c658eff8ea0271be68502b878395">RoundingDivideByPOT</a>(acc0, -output_shift);</div>
<div class="line"><span class="lineno"> 2071</span>            acc1 = <a class="code hl_function" href="namespacemir__interpreter.html#ad9d7c658eff8ea0271be68502b878395">RoundingDivideByPOT</a>(acc1, -output_shift);</div>
<div class="line"><span class="lineno"> 2072</span>          }</div>
<div class="line"><span class="lineno"> 2073</span>          <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 2074</span>          {</div>
<div class="line"><span class="lineno"> 2075</span>            <span class="comment">// Fixed-point multiplication.</span></div>
<div class="line"><span class="lineno"> 2076</span>            acc0 = vmulq_n_s32(acc0, multiplier_power_of_two);</div>
<div class="line"><span class="lineno"> 2077</span>            acc0 = vqrdmulhq_n_s32(acc0, output_multiplier);</div>
<div class="line"><span class="lineno"> 2078</span> </div>
<div class="line"><span class="lineno"> 2079</span>            acc1 = vmulq_n_s32(acc1, multiplier_power_of_two);</div>
<div class="line"><span class="lineno"> 2080</span>            acc1 = vqrdmulhq_n_s32(acc1, output_multiplier);</div>
<div class="line"><span class="lineno"> 2081</span>          }</div>
<div class="line"><span class="lineno"> 2082</span>          <span class="comment">// Add the output offset.</span></div>
<div class="line"><span class="lineno"> 2083</span>          acc0 = vaddq_s32(acc0, output_offset_vec);</div>
<div class="line"><span class="lineno"> 2084</span>          acc1 = vaddq_s32(acc1, output_offset_vec);</div>
<div class="line"><span class="lineno"> 2085</span>          <span class="comment">// Apply the activation function.</span></div>
<div class="line"><span class="lineno"> 2086</span>          acc0 = vmaxq_s32(acc0, output_activation_min_vec);</div>
<div class="line"><span class="lineno"> 2087</span>          acc1 = vmaxq_s32(acc1, output_activation_min_vec);</div>
<div class="line"><span class="lineno"> 2088</span>          acc0 = vminq_s32(acc0, output_activation_max_vec);</div>
<div class="line"><span class="lineno"> 2089</span>          acc1 = vminq_s32(acc1, output_activation_max_vec);</div>
<div class="line"><span class="lineno"> 2090</span>          <span class="comment">// Saturating cast to uint8_t and store to destination.</span></div>
<div class="line"><span class="lineno"> 2091</span>          <span class="keyword">const</span> int16x4_t acc0_s16 = vqmovn_s32(acc0);</div>
<div class="line"><span class="lineno"> 2092</span>          <span class="keyword">const</span> int16x4_t acc1_s16 = vqmovn_s32(acc1);</div>
<div class="line"><span class="lineno"> 2093</span>          <span class="keyword">const</span> int16x8_t res_s16 = vcombine_s16(acc0_s16, acc1_s16);</div>
<div class="line"><span class="lineno"> 2094</span>          <span class="keyword">const</span> uint8x8_t res_u8 = vqmovun_s16(res_s16);</div>
<div class="line"><span class="lineno"> 2095</span>          vst1_u8(output_ptr, res_u8);</div>
<div class="line"><span class="lineno"> 2096</span>          output_ptr += 8;</div>
<div class="line"><span class="lineno"> 2097</span>        }</div>
<div class="line"><span class="lineno"> 2098</span>        <span class="comment">// Handle 4 values at once. Now we&#39;re paying the full price of the</span></div>
<div class="line"><span class="lineno"> 2099</span>        <span class="comment">// high latency of vqrdmulh. Also, storing only 4 bytes at the end</span></div>
<div class="line"><span class="lineno"> 2100</span>        <span class="comment">// (without any alignment) can only be done 1 byte at a time.</span></div>
<div class="line"><span class="lineno"> 2101</span>        <span class="comment">// Yet, that is still worth doing to minimize the amount of leftover</span></div>
<div class="line"><span class="lineno"> 2102</span>        <span class="comment">// that will have to go through the very slow scalar code.</span></div>
<div class="line"><span class="lineno"> 2103</span>        <span class="keywordflow">for</span> (; i &lt;= num_output_values - 4; i += 4)</div>
<div class="line"><span class="lineno"> 2104</span>        {</div>
<div class="line"><span class="lineno"> 2105</span>          int32x4_t acc = vld1q_s32(acc_buffer + i);</div>
<div class="line"><span class="lineno"> 2106</span>          <span class="keywordflow">if</span> (!shift_left)</div>
<div class="line"><span class="lineno"> 2107</span>          {</div>
<div class="line"><span class="lineno"> 2108</span>            <span class="comment">// Fixed-point multiplication.</span></div>
<div class="line"><span class="lineno"> 2109</span>            acc = vqrdmulhq_n_s32(acc, output_multiplier);</div>
<div class="line"><span class="lineno"> 2110</span>            <span class="comment">// Rounding right shift.</span></div>
<div class="line"><span class="lineno"> 2111</span>            acc = <a class="code hl_function" href="namespacemir__interpreter.html#ad9d7c658eff8ea0271be68502b878395">RoundingDivideByPOT</a>(acc, -output_shift);</div>
<div class="line"><span class="lineno"> 2112</span>          }</div>
<div class="line"><span class="lineno"> 2113</span>          <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 2114</span>          {</div>
<div class="line"><span class="lineno"> 2115</span>            <span class="comment">// Fixed-point multiplication.</span></div>
<div class="line"><span class="lineno"> 2116</span>            acc = vmulq_n_s32(acc, multiplier_power_of_two);</div>
<div class="line"><span class="lineno"> 2117</span>            acc = vqrdmulhq_n_s32(acc, output_multiplier);</div>
<div class="line"><span class="lineno"> 2118</span>          }</div>
<div class="line"><span class="lineno"> 2119</span>          <span class="comment">// Add the output offset.</span></div>
<div class="line"><span class="lineno"> 2120</span>          acc = vaddq_s32(acc, output_offset_vec);</div>
<div class="line"><span class="lineno"> 2121</span>          <span class="comment">// Apply the activation function.</span></div>
<div class="line"><span class="lineno"> 2122</span>          acc = vmaxq_s32(acc, output_activation_min_vec);</div>
<div class="line"><span class="lineno"> 2123</span>          acc = vminq_s32(acc, output_activation_max_vec);</div>
<div class="line"><span class="lineno"> 2124</span>          <span class="comment">// Saturating cast to uint8_t and store to destination.</span></div>
<div class="line"><span class="lineno"> 2125</span>          <span class="keyword">const</span> int16x4_t acc_s16 = vqmovn_s32(acc);</div>
<div class="line"><span class="lineno"> 2126</span>          <span class="keyword">const</span> int16x8_t res_s16 = vcombine_s16(acc_s16, acc_s16);</div>
<div class="line"><span class="lineno"> 2127</span>          <span class="keyword">const</span> uint8x8_t res_u8 = vqmovun_s16(res_s16);</div>
<div class="line"><span class="lineno"> 2128</span>          vst1_lane_u8(output_ptr + 0, res_u8, 0);</div>
<div class="line"><span class="lineno"> 2129</span>          vst1_lane_u8(output_ptr + 1, res_u8, 1);</div>
<div class="line"><span class="lineno"> 2130</span>          vst1_lane_u8(output_ptr + 2, res_u8, 2);</div>
<div class="line"><span class="lineno"> 2131</span>          vst1_lane_u8(output_ptr + 3, res_u8, 3);</div>
<div class="line"><span class="lineno"> 2132</span>          output_ptr += 4;</div>
<div class="line"><span class="lineno"> 2133</span>        }</div>
<div class="line"><span class="lineno"> 2134</span><span class="preprocessor">#endif </span><span class="comment">// USE_NEON</span></div>
<div class="line"><span class="lineno"> 2135</span> </div>
<div class="line"><span class="lineno"> 2136</span>        <span class="comment">// Handle leftover values, one by one. This is very slow.</span></div>
<div class="line"><span class="lineno"> 2137</span>        <span class="keywordflow">for</span> (; i &lt; num_output_values; i++)</div>
<div class="line"><span class="lineno"> 2138</span>        {</div>
<div class="line"><span class="lineno"> 2139</span>          int32_t acc = acc_buffer[i];</div>
<div class="line"><span class="lineno"> 2140</span>          acc = <a class="code hl_function" href="namespacennfw_1_1cker.html#af6b33a8f0c1d60e578337bdb8dcb3673">MultiplyByQuantizedMultiplier</a>(acc, output_multiplier, output_shift);</div>
<div class="line"><span class="lineno"> 2141</span>          acc += output_offset;</div>
<div class="line"><span class="lineno"> 2142</span>          acc = std::max(acc, output_activation_min);</div>
<div class="line"><span class="lineno"> 2143</span>          acc = std::min(acc, output_activation_max);</div>
<div class="line"><span class="lineno"> 2144</span>          *output_ptr++ = <span class="keyword">static_cast&lt;</span>uint8_t<span class="keyword">&gt;</span>(acc);</div>
<div class="line"><span class="lineno"> 2145</span>        }</div>
<div class="line"><span class="lineno"> 2146</span>      }</div>
<div class="line"><span class="lineno"> 2147</span>    }</div>
<div class="line"><span class="lineno"> 2148</span>    output_ptr += batch_step;</div>
<div class="line"><span class="lineno"> 2149</span>  }</div>
<div class="line"><span class="lineno"> 2150</span>}</div>
<div class="ttc" id="aclassnnfw_1_1cker_1_1_shape_html_a497180ee7844bbef51b36bd58e61fa31"><div class="ttname"><a href="classnnfw_1_1cker_1_1_shape.html#a497180ee7844bbef51b36bd58e61fa31">nnfw::cker::Shape::Dims</a></div><div class="ttdeci">int32_t Dims(int i) const</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_shape_8h_source.html#l00094">Shape.h:94</a></div></div>
<div class="ttc" id="acompute_2cker_2include_2cker_2_shape_8h_html_a044d7f999713173dd3360b0aa40370fd"><div class="ttname"><a href="compute_2cker_2include_2cker_2_shape_8h.html#a044d7f999713173dd3360b0aa40370fd">UNUSED_RELEASE</a></div><div class="ttdeci">#define UNUSED_RELEASE(a)</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_shape_8h_source.html#l00026">Shape.h:26</a></div></div>
<div class="ttc" id="anamespacemir__interpreter_html_ad9d7c658eff8ea0271be68502b878395"><div class="ttname"><a href="namespacemir__interpreter.html#ad9d7c658eff8ea0271be68502b878395">mir_interpreter::RoundingDivideByPOT</a></div><div class="ttdeci">int32_t RoundingDivideByPOT(int32_t x, int exponent)</div><div class="ttdef"><b>Definition:</b> <a href="_quantization_helpers_8h_source.html#l00087">QuantizationHelpers.h:87</a></div></div>
<div class="ttc" id="anamespacennfw_1_1cker_1_1optimized_1_1depthwise__conv_html_aa432b80504a69aefe8ee0a4f0a4d94f8"><div class="ttname"><a href="namespacennfw_1_1cker_1_1optimized_1_1depthwise__conv.html#aa432b80504a69aefe8ee0a4f0a4d94f8">nnfw::cker::optimized::depthwise_conv::QuantizedDepthwiseConvAccumRowGeneric</a></div><div class="ttdeci">void QuantizedDepthwiseConvAccumRowGeneric(int stride, int dilation_factor, int input_depth, int input_width, const uint8_t *input_data, int16_t input_offset, int pad_width, int depth_multiplier, int filter_width, const uint8_t *filter_data, int16_t filter_offset, int out_x_buffer_start, int out_x_buffer_end, int output_depth, int32_t *acc_buffer)</div><div class="ttdef"><b>Definition:</b> <a href="optimized_2_depthwise_conv_u_int8_8h_source.html#l01684">DepthwiseConvUint8.h:1684</a></div></div>
<div class="ttc" id="anamespacennfw_1_1cker_html_a0a74e72b1bffcb6519de7fc224416ff9"><div class="ttname"><a href="namespacennfw_1_1cker.html#a0a74e72b1bffcb6519de7fc224416ff9">nnfw::cker::MatchingDim</a></div><div class="ttdeci">int MatchingDim(const Shape &amp;shape1, int index1, const Shape &amp;shape2, int index2)</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_shape_8h_source.html#l00222">Shape.h:222</a></div></div>
<div class="ttc" id="anamespacennfw_1_1cker_html_a59fdb0b28360a8fcf55b1080b63eefb3"><div class="ttname"><a href="namespacennfw_1_1cker.html#a59fdb0b28360a8fcf55b1080b63eefb3">nnfw::cker::FlatSizeSkipDim</a></div><div class="ttdeci">int FlatSizeSkipDim(const Shape &amp;shape, int skip_dim)</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_shape_8h_source.html#l00257">Shape.h:257</a></div></div>
<div class="ttc" id="anamespacennfw_1_1cker_html_af6b33a8f0c1d60e578337bdb8dcb3673"><div class="ttname"><a href="namespacennfw_1_1cker.html#af6b33a8f0c1d60e578337bdb8dcb3673">nnfw::cker::MultiplyByQuantizedMultiplier</a></div><div class="ttdeci">int32_t MultiplyByQuantizedMultiplier(int32_t x, int32_t quantized_multiplier, int shift)</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_utils_8h_source.html#l00093">Utils.h:93</a></div></div>
<div class="ttc" id="aoptimized_2_depthwise_conv_u_int8_8h_html_a5d6cdde4feb9761abaa001f402b79f27"><div class="ttname"><a href="optimized_2_depthwise_conv_u_int8_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a></div><div class="ttdeci">#define TFMINI_USE_DEPTHWISECONV_KERNEL(ALLOW_STRIDED, FIXED_INPUT_DEPTH, FIXED_DEPTH_MULTIPLIER)</div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_depthwise_conv_params_html_a01a008eb3a82ad7cd76020c35c944b25"><div class="ttname"><a href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a01a008eb3a82ad7cd76020c35c944b25">nnfw::cker::DepthwiseConvParams::output_offset</a></div><div class="ttdeci">int32_t output_offset</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00236">Types.h:236</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_depthwise_conv_params_html_a2660e5e3746138d3f3d31c6a17012fc1"><div class="ttname"><a href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a2660e5e3746138d3f3d31c6a17012fc1">nnfw::cker::DepthwiseConvParams::input_offset</a></div><div class="ttdeci">int32_t input_offset</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00234">Types.h:234</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_depthwise_conv_params_html_a2a11fa7f567b0faa4551dfe628d6de2b"><div class="ttname"><a href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a2a11fa7f567b0faa4551dfe628d6de2b">nnfw::cker::DepthwiseConvParams::dilation_height_factor</a></div><div class="ttdeci">int16_t dilation_height_factor</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00230">Types.h:230</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_depthwise_conv_params_html_a45543a54fe9f6a5c89cc1fde2aea8bd1"><div class="ttname"><a href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a45543a54fe9f6a5c89cc1fde2aea8bd1">nnfw::cker::DepthwiseConvParams::output_multiplier</a></div><div class="ttdeci">int32_t output_multiplier</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00237">Types.h:237</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_depthwise_conv_params_html_a50d46dad3a5d5bec206a3f10f1168768"><div class="ttname"><a href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a50d46dad3a5d5bec206a3f10f1168768">nnfw::cker::DepthwiseConvParams::dilation_width_factor</a></div><div class="ttdeci">int16_t dilation_width_factor</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00229">Types.h:229</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_depthwise_conv_params_html_a54c8882742f94c3f5f601a9d81fce456"><div class="ttname"><a href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a54c8882742f94c3f5f601a9d81fce456">nnfw::cker::DepthwiseConvParams::quantized_activation_max</a></div><div class="ttdeci">int32_t quantized_activation_max</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00241">Types.h:241</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_depthwise_conv_params_html_a65cb7bfeb2b801d8a574a85da10598ff"><div class="ttname"><a href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a65cb7bfeb2b801d8a574a85da10598ff">nnfw::cker::DepthwiseConvParams::stride_width</a></div><div class="ttdeci">int16_t stride_width</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00227">Types.h:227</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_depthwise_conv_params_html_a7cc7d4366172494e8a67dc7b69de07b1"><div class="ttname"><a href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#a7cc7d4366172494e8a67dc7b69de07b1">nnfw::cker::DepthwiseConvParams::quantized_activation_min</a></div><div class="ttdeci">int32_t quantized_activation_min</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00240">Types.h:240</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_depthwise_conv_params_html_aa9b7463f82fb236bef93376ae9b4c71c"><div class="ttname"><a href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#aa9b7463f82fb236bef93376ae9b4c71c">nnfw::cker::DepthwiseConvParams::weights_offset</a></div><div class="ttdeci">int32_t weights_offset</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00235">Types.h:235</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_depthwise_conv_params_html_aaa0e9f0f50f1ed3c8e25886d51a45f75"><div class="ttname"><a href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#aaa0e9f0f50f1ed3c8e25886d51a45f75">nnfw::cker::DepthwiseConvParams::depth_multiplier</a></div><div class="ttdeci">int16_t depth_multiplier</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00231">Types.h:231</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_depthwise_conv_params_html_ab424f92784d7f28eba2b61dcb1be277b"><div class="ttname"><a href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#ab424f92784d7f28eba2b61dcb1be277b">nnfw::cker::DepthwiseConvParams::padding_values</a></div><div class="ttdeci">PaddingValues padding_values</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00226">Types.h:226</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_depthwise_conv_params_html_ad2dbdcb99cb6434e20c073adf4266bef"><div class="ttname"><a href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#ad2dbdcb99cb6434e20c073adf4266bef">nnfw::cker::DepthwiseConvParams::stride_height</a></div><div class="ttdeci">int16_t stride_height</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00228">Types.h:228</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_depthwise_conv_params_html_af0b74f66af25169d9aee4b30ec105ced"><div class="ttname"><a href="structnnfw_1_1cker_1_1_depthwise_conv_params.html#af0b74f66af25169d9aee4b30ec105ced">nnfw::cker::DepthwiseConvParams::output_shift</a></div><div class="ttdeci">int output_shift</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00238">Types.h:238</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_padding_values_html_a1dc41a9ebbd61a7c34ed2b5dd2ec10eb"><div class="ttname"><a href="structnnfw_1_1cker_1_1_padding_values.html#a1dc41a9ebbd61a7c34ed2b5dd2ec10eb">nnfw::cker::PaddingValues::height</a></div><div class="ttdeci">int16_t height</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00069">Types.h:69</a></div></div>
<div class="ttc" id="astructnnfw_1_1cker_1_1_padding_values_html_a2a3dd79d28c30c5da865290160601fd1"><div class="ttname"><a href="structnnfw_1_1cker_1_1_padding_values.html#a2a3dd79d28c30c5da865290160601fd1">nnfw::cker::PaddingValues::width</a></div><div class="ttdeci">int16_t width</div><div class="ttdef"><b>Definition:</b> <a href="compute_2cker_2include_2cker_2_types_8h_source.html#l00068">Types.h:68</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00231">nnfw::cker::DepthwiseConvParams::depth_multiplier</a>, <a class="el" href="optimized_2_depthwise_conv_u_int8_8h_source.html#l01724">DepthwiseConvInitAccBuffer()</a>, <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00230">nnfw::cker::DepthwiseConvParams::dilation_height_factor</a>, <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00229">nnfw::cker::DepthwiseConvParams::dilation_width_factor</a>, <a class="el" href="compute_2cker_2include_2cker_2_shape_8h_source.html#l00094">nnfw::cker::Shape::Dims()</a>, <a class="el" href="compute_2cker_2include_2cker_2_shape_8h_source.html#l00257">nnfw::cker::FlatSizeSkipDim()</a>, <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00069">nnfw::cker::PaddingValues::height</a>, <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00234">nnfw::cker::DepthwiseConvParams::input_offset</a>, <a class="el" href="compute_2cker_2include_2cker_2_shape_8h_source.html#l00222">nnfw::cker::MatchingDim()</a>, <a class="el" href="compute_2cker_2include_2cker_2_utils_8h_source.html#l00093">nnfw::cker::MultiplyByQuantizedMultiplier()</a>, <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00237">nnfw::cker::DepthwiseConvParams::output_multiplier</a>, <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00236">nnfw::cker::DepthwiseConvParams::output_offset</a>, <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00238">nnfw::cker::DepthwiseConvParams::output_shift</a>, <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00226">nnfw::cker::DepthwiseConvParams::padding_values</a>, <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00241">nnfw::cker::DepthwiseConvParams::quantized_activation_max</a>, <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00240">nnfw::cker::DepthwiseConvParams::quantized_activation_min</a>, <a class="el" href="optimized_2_depthwise_conv_u_int8_8h_source.html#l01684">QuantizedDepthwiseConvAccumRowGeneric()</a>, <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00228">nnfw::cker::DepthwiseConvParams::stride_height</a>, <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00227">nnfw::cker::DepthwiseConvParams::stride_width</a>, <a class="el" href="_depthwise_conv_float_8h.html#a5d6cdde4feb9761abaa001f402b79f27">TFMINI_USE_DEPTHWISECONV_KERNEL</a>, <a class="el" href="compute_2cker_2include_2cker_2_shape_8h_source.html#l00026">UNUSED_RELEASE</a>, <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00235">nnfw::cker::DepthwiseConvParams::weights_offset</a>, and <a class="el" href="compute_2cker_2include_2cker_2_types_8h_source.html#l00068">nnfw::cker::PaddingValues::width</a>.</p>

<p class="reference">Referenced by <a class="el" href="optimized_2_depthwise_conv_u_int8_8h_source.html#l02155">nnfw::cker::optimized::DepthwiseConvWithRounding()</a>.</p>

</div>
</div>
<a id="a2b1b66890f9515899386cdb50acafbe3" name="a2b1b66890f9515899386cdb50acafbe3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b1b66890f9515899386cdb50acafbe3">&#9670;&#160;</a></span>DepthwiseConvInitAccBuffer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void nnfw::cker::optimized::depthwise_conv::DepthwiseConvInitAccBuffer </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_output_pixels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>output_depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t *&#160;</td>
          <td class="paramname"><em>bias_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t *&#160;</td>
          <td class="paramname"><em>acc_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimized_2_depthwise_conv_u_int8_8h_source.html#l01724">1724</a> of file <a class="el" href="optimized_2_depthwise_conv_u_int8_8h_source.html">DepthwiseConvUint8.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1726</span>{</div>
<div class="line"><span class="lineno"> 1727</span>  <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><span class="lineno"> 1728</span><span class="preprocessor">#ifdef USE_NEON</span></div>
<div class="line"><span class="lineno"> 1729</span>  <span class="keywordflow">if</span> (output_depth == 1)</div>
<div class="line"><span class="lineno"> 1730</span>  {</div>
<div class="line"><span class="lineno"> 1731</span>    <span class="keyword">const</span> int32x4_t b = vdupq_n_s32(bias_data[0]);</div>
<div class="line"><span class="lineno"> 1732</span>    <span class="keywordflow">for</span> (; i &lt;= num_output_pixels - 16; i += 16)</div>
<div class="line"><span class="lineno"> 1733</span>    {</div>
<div class="line"><span class="lineno"> 1734</span>      vst1q_s32(acc_buffer + i + 0, b);</div>
<div class="line"><span class="lineno"> 1735</span>      vst1q_s32(acc_buffer + i + 4, b);</div>
<div class="line"><span class="lineno"> 1736</span>      vst1q_s32(acc_buffer + i + 8, b);</div>
<div class="line"><span class="lineno"> 1737</span>      vst1q_s32(acc_buffer + i + 12, b);</div>
<div class="line"><span class="lineno"> 1738</span>    }</div>
<div class="line"><span class="lineno"> 1739</span>    <span class="keywordflow">for</span> (; i &lt;= num_output_pixels - 4; i += 4)</div>
<div class="line"><span class="lineno"> 1740</span>    {</div>
<div class="line"><span class="lineno"> 1741</span>      vst1q_s32(acc_buffer + i, b);</div>
<div class="line"><span class="lineno"> 1742</span>    }</div>
<div class="line"><span class="lineno"> 1743</span>  }</div>
<div class="line"><span class="lineno"> 1744</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (output_depth == 2)</div>
<div class="line"><span class="lineno"> 1745</span>  {</div>
<div class="line"><span class="lineno"> 1746</span>    int32x4_t b = vdupq_n_s32(bias_data[0]);</div>
<div class="line"><span class="lineno"> 1747</span>    b = vsetq_lane_s32(bias_data[1], b, 1);</div>
<div class="line"><span class="lineno"> 1748</span>    b = vsetq_lane_s32(bias_data[1], b, 3);</div>
<div class="line"><span class="lineno"> 1749</span>    <span class="keywordflow">for</span> (; i &lt;= num_output_pixels - 8; i += 8)</div>
<div class="line"><span class="lineno"> 1750</span>    {</div>
<div class="line"><span class="lineno"> 1751</span>      vst1q_s32(acc_buffer + 2 * i + 0, b);</div>
<div class="line"><span class="lineno"> 1752</span>      vst1q_s32(acc_buffer + 2 * i + 4, b);</div>
<div class="line"><span class="lineno"> 1753</span>      vst1q_s32(acc_buffer + 2 * i + 8, b);</div>
<div class="line"><span class="lineno"> 1754</span>      vst1q_s32(acc_buffer + 2 * i + 12, b);</div>
<div class="line"><span class="lineno"> 1755</span>    }</div>
<div class="line"><span class="lineno"> 1756</span>    <span class="keywordflow">for</span> (; i &lt;= num_output_pixels - 2; i += 2)</div>
<div class="line"><span class="lineno"> 1757</span>    {</div>
<div class="line"><span class="lineno"> 1758</span>      vst1q_s32(acc_buffer + 2 * i, b);</div>
<div class="line"><span class="lineno"> 1759</span>    }</div>
<div class="line"><span class="lineno"> 1760</span>  }</div>
<div class="line"><span class="lineno"> 1761</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (output_depth == 4)</div>
<div class="line"><span class="lineno"> 1762</span>  {</div>
<div class="line"><span class="lineno"> 1763</span>    <span class="keyword">const</span> int32x4_t <a class="code hl_variable" href="namespacejpeg2hdf5.html#a1a0fe2ec4c2bc8757bcf4f0fcd4f74c1">b</a> = vld1q_s32(bias_data);</div>
<div class="line"><span class="lineno"> 1764</span>    <span class="keywordflow">for</span> (; i &lt;= num_output_pixels - 4; i += 4)</div>
<div class="line"><span class="lineno"> 1765</span>    {</div>
<div class="line"><span class="lineno"> 1766</span>      vst1q_s32(acc_buffer + 4 * i + 0, b);</div>
<div class="line"><span class="lineno"> 1767</span>      vst1q_s32(acc_buffer + 4 * i + 4, b);</div>
<div class="line"><span class="lineno"> 1768</span>      vst1q_s32(acc_buffer + 4 * i + 8, b);</div>
<div class="line"><span class="lineno"> 1769</span>      vst1q_s32(acc_buffer + 4 * i + 12, b);</div>
<div class="line"><span class="lineno"> 1770</span>    }</div>
<div class="line"><span class="lineno"> 1771</span>    <span class="keywordflow">for</span> (; i &lt; num_output_pixels; i++)</div>
<div class="line"><span class="lineno"> 1772</span>    {</div>
<div class="line"><span class="lineno"> 1773</span>      vst1q_s32(acc_buffer + 4 * i, b);</div>
<div class="line"><span class="lineno"> 1774</span>    }</div>
<div class="line"><span class="lineno"> 1775</span>  }</div>
<div class="line"><span class="lineno"> 1776</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (output_depth == 8)</div>
<div class="line"><span class="lineno"> 1777</span>  {</div>
<div class="line"><span class="lineno"> 1778</span>    <span class="keyword">const</span> int32x4_t b0 = vld1q_s32(bias_data);</div>
<div class="line"><span class="lineno"> 1779</span>    <span class="keyword">const</span> int32x4_t b1 = vld1q_s32(bias_data + 4);</div>
<div class="line"><span class="lineno"> 1780</span>    <span class="keywordflow">for</span> (; i &lt;= num_output_pixels - 2; i += 2)</div>
<div class="line"><span class="lineno"> 1781</span>    {</div>
<div class="line"><span class="lineno"> 1782</span>      vst1q_s32(acc_buffer + 8 * i + 0, b0);</div>
<div class="line"><span class="lineno"> 1783</span>      vst1q_s32(acc_buffer + 8 * i + 4, b1);</div>
<div class="line"><span class="lineno"> 1784</span>      vst1q_s32(acc_buffer + 8 * i + 8, b0);</div>
<div class="line"><span class="lineno"> 1785</span>      vst1q_s32(acc_buffer + 8 * i + 12, b1);</div>
<div class="line"><span class="lineno"> 1786</span>    }</div>
<div class="line"><span class="lineno"> 1787</span>    <span class="keywordflow">for</span> (; i &lt; num_output_pixels; i++)</div>
<div class="line"><span class="lineno"> 1788</span>    {</div>
<div class="line"><span class="lineno"> 1789</span>      vst1q_s32(acc_buffer + 8 * i + 0, b0);</div>
<div class="line"><span class="lineno"> 1790</span>      vst1q_s32(acc_buffer + 8 * i + 4, b1);</div>
<div class="line"><span class="lineno"> 1791</span>    }</div>
<div class="line"><span class="lineno"> 1792</span>  }</div>
<div class="line"><span class="lineno"> 1793</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (output_depth == 16)</div>
<div class="line"><span class="lineno"> 1794</span>  {</div>
<div class="line"><span class="lineno"> 1795</span>    <span class="keyword">const</span> int32x4_t b0 = vld1q_s32(bias_data);</div>
<div class="line"><span class="lineno"> 1796</span>    <span class="keyword">const</span> int32x4_t b1 = vld1q_s32(bias_data + 4);</div>
<div class="line"><span class="lineno"> 1797</span>    <span class="keyword">const</span> int32x4_t b2 = vld1q_s32(bias_data + 8);</div>
<div class="line"><span class="lineno"> 1798</span>    <span class="keyword">const</span> int32x4_t b3 = vld1q_s32(bias_data + 12);</div>
<div class="line"><span class="lineno"> 1799</span>    <span class="keywordflow">for</span> (; i &lt; num_output_pixels; i++)</div>
<div class="line"><span class="lineno"> 1800</span>    {</div>
<div class="line"><span class="lineno"> 1801</span>      vst1q_s32(acc_buffer + 16 * i + 0, b0);</div>
<div class="line"><span class="lineno"> 1802</span>      vst1q_s32(acc_buffer + 16 * i + 4, b1);</div>
<div class="line"><span class="lineno"> 1803</span>      vst1q_s32(acc_buffer + 16 * i + 8, b2);</div>
<div class="line"><span class="lineno"> 1804</span>      vst1q_s32(acc_buffer + 16 * i + 12, b3);</div>
<div class="line"><span class="lineno"> 1805</span>    }</div>
<div class="line"><span class="lineno"> 1806</span>  }</div>
<div class="line"><span class="lineno"> 1807</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1808</span>  <span class="keywordflow">for</span> (; i &lt; num_output_pixels; i++)</div>
<div class="line"><span class="lineno"> 1809</span>  {</div>
<div class="line"><span class="lineno"> 1810</span>    memcpy(acc_buffer + i * output_depth, bias_data, <span class="keyword">sizeof</span>(acc_buffer[0]) * output_depth);</div>
<div class="line"><span class="lineno"> 1811</span>  }</div>
<div class="line"><span class="lineno"> 1812</span>}</div>
<div class="ttc" id="anamespacejpeg2hdf5_html_a1a0fe2ec4c2bc8757bcf4f0fcd4f74c1"><div class="ttname"><a href="namespacejpeg2hdf5.html#a1a0fe2ec4c2bc8757bcf4f0fcd4f74c1">jpeg2hdf5.b</a></div><div class="ttdeci">b</div><div class="ttdef"><b>Definition:</b> <a href="jpeg2hdf5_8py_source.html#l00105">jpeg2hdf5.py:105</a></div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="optimized_2_depthwise_conv_u_int8_8h_source.html#l01814">DepthwiseConvGeneral()</a>.</p>

</div>
</div>
<a id="adf2547e9a7129861ac2bb8a7b32ab4b2" name="adf2547e9a7129861ac2bb8a7b32ab4b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf2547e9a7129861ac2bb8a7b32ab4b2">&#9670;&#160;</a></span>QuantizedDepthwiseConvAccumRow()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;bool kAllowStrided, int kFixedInputDepth, int kFixedDepthMultiplier&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void nnfw::cker::optimized::depthwise_conv::QuantizedDepthwiseConvAccumRow </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stride</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dilation_factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>input_depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>input_width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>input_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>input_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pad_width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>depth_multiplier</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>filter_width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>filter_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>filter_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>out_x_buffer_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>out_x_buffer_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>output_depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t *&#160;</td>
          <td class="paramname"><em>acc_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimized_2_depthwise_conv_u_int8_8h_source.html#l01612">1612</a> of file <a class="el" href="optimized_2_depthwise_conv_u_int8_8h_source.html">DepthwiseConvUint8.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1618</span>{</div>
<div class="line"><span class="lineno"> 1619</span>  <span class="comment">// Sanity check parameters. This is important in particular to ensure</span></div>
<div class="line"><span class="lineno"> 1620</span>  <span class="comment">// that we keep the number of template instantiations minimal, so we don&#39;t</span></div>
<div class="line"><span class="lineno"> 1621</span>  <span class="comment">// increase binary size unnecessarily.</span></div>
<div class="line"><span class="lineno"> 1622</span>  <span class="keyword">static_assert</span>(kFixedDepthMultiplier || !kFixedInputDepth, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno"> 1623</span>  <span class="keyword">static_assert</span>(kFixedInputDepth || kAllowStrided, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno"> 1624</span>  assert(stride == 1 || kAllowStrided);</div>
<div class="line"><span class="lineno"> 1625</span>  <span class="keywordflow">if</span> (kFixedInputDepth)</div>
<div class="line"><span class="lineno"> 1626</span>  {</div>
<div class="line"><span class="lineno"> 1627</span>    assert(input_depth == kFixedInputDepth);</div>
<div class="line"><span class="lineno"> 1628</span>  }</div>
<div class="line"><span class="lineno"> 1629</span>  <span class="keywordflow">if</span> (kFixedDepthMultiplier)</div>
<div class="line"><span class="lineno"> 1630</span>  {</div>
<div class="line"><span class="lineno"> 1631</span>    assert(depth_multiplier == kFixedDepthMultiplier);</div>
<div class="line"><span class="lineno"> 1632</span>  }</div>
<div class="line"><span class="lineno"> 1633</span>  assert(output_depth == input_depth * depth_multiplier);</div>
<div class="line"><span class="lineno"> 1634</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> input_ptr_increment = stride * input_depth;</div>
<div class="line"><span class="lineno"> 1635</span>  <span class="keyword">const</span> uint8_t *filter_base_ptr = filter_data;</div>
<div class="line"><span class="lineno"> 1636</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> filter_x = 0; filter_x &lt; filter_width; ++filter_x)</div>
<div class="line"><span class="lineno"> 1637</span>  {</div>
<div class="line"><span class="lineno"> 1638</span>    <span class="comment">// For the current (filter_x, filter_y) point in the filter,</span></div>
<div class="line"><span class="lineno"> 1639</span>    <span class="comment">// compute the boundaries of the corresponding output row segment.</span></div>
<div class="line"><span class="lineno"> 1640</span>    <span class="keywordtype">int</span> out_x_loop_start_unclampled = 0;</div>
<div class="line"><span class="lineno"> 1641</span>    <span class="keywordtype">int</span> out_x_loop_end_unclampled = 0;</div>
<div class="line"><span class="lineno"> 1642</span>    <span class="keywordflow">if</span> (kAllowStrided)</div>
<div class="line"><span class="lineno"> 1643</span>    {</div>
<div class="line"><span class="lineno"> 1644</span>      <span class="keywordflow">if</span> (stride == 2)</div>
<div class="line"><span class="lineno"> 1645</span>      {</div>
<div class="line"><span class="lineno"> 1646</span>        out_x_loop_start_unclampled = (pad_width - dilation_factor * filter_x + 1) / 2;</div>
<div class="line"><span class="lineno"> 1647</span>        out_x_loop_end_unclampled = (pad_width + input_width - dilation_factor * filter_x + 1) / 2;</div>
<div class="line"><span class="lineno"> 1648</span>      }</div>
<div class="line"><span class="lineno"> 1649</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stride == 4)</div>
<div class="line"><span class="lineno"> 1650</span>      {</div>
<div class="line"><span class="lineno"> 1651</span>        out_x_loop_start_unclampled = (pad_width - dilation_factor * filter_x + 3) / 4;</div>
<div class="line"><span class="lineno"> 1652</span>        out_x_loop_end_unclampled = (pad_width + input_width - dilation_factor * filter_x + 3) / 4;</div>
<div class="line"><span class="lineno"> 1653</span>      }</div>
<div class="line"><span class="lineno"> 1654</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1655</span>      {</div>
<div class="line"><span class="lineno"> 1656</span>        out_x_loop_start_unclampled =</div>
<div class="line"><span class="lineno"> 1657</span>          (pad_width - dilation_factor * filter_x + stride - 1) / stride;</div>
<div class="line"><span class="lineno"> 1658</span>        out_x_loop_end_unclampled =</div>
<div class="line"><span class="lineno"> 1659</span>          (pad_width + input_width - dilation_factor * filter_x + stride - 1) / stride;</div>
<div class="line"><span class="lineno"> 1660</span>      }</div>
<div class="line"><span class="lineno"> 1661</span>    }</div>
<div class="line"><span class="lineno"> 1662</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1663</span>    {</div>
<div class="line"><span class="lineno"> 1664</span>      out_x_loop_start_unclampled = pad_width - dilation_factor * filter_x;</div>
<div class="line"><span class="lineno"> 1665</span>      out_x_loop_end_unclampled = pad_width + input_width - dilation_factor * filter_x;</div>
<div class="line"><span class="lineno"> 1666</span>    }</div>
<div class="line"><span class="lineno"> 1667</span>    <span class="comment">// The kernel will have to iterate on the segment of the</span></div>
<div class="line"><span class="lineno"> 1668</span>    <span class="comment">// output row that starts at out_x_loop_start and out_x_loop_end.</span></div>
<div class="line"><span class="lineno"> 1669</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> out_x_loop_start = std::max(out_x_buffer_start, out_x_loop_start_unclampled);</div>
<div class="line"><span class="lineno"> 1670</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> out_x_loop_end = std::min(out_x_buffer_end, out_x_loop_end_unclampled);</div>
<div class="line"><span class="lineno"> 1671</span> </div>
<div class="line"><span class="lineno"> 1672</span>    int32_t *acc_buffer_ptr = acc_buffer + (out_x_loop_start - out_x_buffer_start) * output_depth;</div>
<div class="line"><span class="lineno"> 1673</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> in_x_origin = (out_x_loop_start * stride) - pad_width + dilation_factor * filter_x;</div>
<div class="line"><span class="lineno"> 1674</span>    <span class="keyword">const</span> uint8_t *input_ptr = <a class="code hl_variable" href="namespacepart__eval__one.html#a818987310f1a181c06a880dab57fcf39">input_data</a> + in_x_origin * input_depth;</div>
<div class="line"><span class="lineno"> 1675</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> num_output_pixels = out_x_loop_end - out_x_loop_start;</div>
<div class="line"><span class="lineno"> 1676</span>    QuantizedDepthwiseConvKernel&lt;kAllowStrided, kFixedInputDepth, kFixedDepthMultiplier&gt;::Run(</div>
<div class="line"><span class="lineno"> 1677</span>      num_output_pixels, input_depth, depth_multiplier, input_ptr, input_offset,</div>
<div class="line"><span class="lineno"> 1678</span>      input_ptr_increment, filter_base_ptr, filter_offset, acc_buffer_ptr);</div>
<div class="line"><span class="lineno"> 1679</span>    filter_base_ptr += output_depth;</div>
<div class="line"><span class="lineno"> 1680</span>  }</div>
<div class="line"><span class="lineno"> 1681</span>}</div>
<div class="ttc" id="anamespacepart__eval__one_html_a818987310f1a181c06a880dab57fcf39"><div class="ttname"><a href="namespacepart__eval__one.html#a818987310f1a181c06a880dab57fcf39">part_eval_one.input_data</a></div><div class="ttdeci">input_data</div><div class="ttdef"><b>Definition:</b> <a href="part__eval__one_8py_source.html#l00075">part_eval_one.py:75</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa432b80504a69aefe8ee0a4f0a4d94f8" name="aa432b80504a69aefe8ee0a4f0a4d94f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa432b80504a69aefe8ee0a4f0a4d94f8">&#9670;&#160;</a></span>QuantizedDepthwiseConvAccumRowGeneric()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void nnfw::cker::optimized::depthwise_conv::QuantizedDepthwiseConvAccumRowGeneric </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stride</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dilation_factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>input_depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>input_width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>input_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>input_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pad_width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>depth_multiplier</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>filter_width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>filter_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>filter_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>out_x_buffer_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>out_x_buffer_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>output_depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t *&#160;</td>
          <td class="paramname"><em>acc_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimized_2_depthwise_conv_u_int8_8h_source.html#l01684">1684</a> of file <a class="el" href="optimized_2_depthwise_conv_u_int8_8h_source.html">DepthwiseConvUint8.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1691</span>{</div>
<div class="line"><span class="lineno"> 1692</span>  <span class="keyword">const</span> uint8_t *filter_base_ptr = filter_data;</div>
<div class="line"><span class="lineno"> 1693</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> filter_x = 0; filter_x &lt; filter_width; ++filter_x)</div>
<div class="line"><span class="lineno"> 1694</span>  {</div>
<div class="line"><span class="lineno"> 1695</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> out_x_loop_start =</div>
<div class="line"><span class="lineno"> 1696</span>      std::max(out_x_buffer_start, (pad_width - dilation_factor * filter_x + stride - 1) / stride);</div>
<div class="line"><span class="lineno"> 1697</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> out_x_loop_end =</div>
<div class="line"><span class="lineno"> 1698</span>      std::min(out_x_buffer_end,</div>
<div class="line"><span class="lineno"> 1699</span>               (pad_width + input_width - dilation_factor * filter_x + stride - 1) / stride);</div>
<div class="line"><span class="lineno"> 1700</span> </div>
<div class="line"><span class="lineno"> 1701</span>    int32_t *acc_buffer_ptr = acc_buffer + (out_x_loop_start - out_x_buffer_start) * output_depth;</div>
<div class="line"><span class="lineno"> 1702</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> in_x_origin = (out_x_loop_start * stride) - pad_width + dilation_factor * filter_x;</div>
<div class="line"><span class="lineno"> 1703</span>    <span class="keyword">const</span> uint8_t *input_ptr = input_data + in_x_origin * input_depth;</div>
<div class="line"><span class="lineno"> 1704</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> input_ptr_increment = (stride - 1) * input_depth;</div>
<div class="line"><span class="lineno"> 1705</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> out_x = out_x_loop_start; out_x &lt; out_x_loop_end; out_x++)</div>
<div class="line"><span class="lineno"> 1706</span>    {</div>
<div class="line"><span class="lineno"> 1707</span>      <span class="keyword">const</span> uint8_t *filter_ptr = filter_base_ptr;</div>
<div class="line"><span class="lineno"> 1708</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ic = 0; ic &lt; input_depth; ++ic)</div>
<div class="line"><span class="lineno"> 1709</span>      {</div>
<div class="line"><span class="lineno"> 1710</span>        <span class="keyword">const</span> int16_t input_val = *input_ptr++ + input_offset;</div>
<div class="line"><span class="lineno"> 1711</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="_n_e_g_e_m_m_matrix_accumulate_biases_kernel_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a> = 0; <a class="code hl_variable" href="_n_e_g_e_m_m_matrix_accumulate_biases_kernel_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a> &lt; depth_multiplier; <a class="code hl_variable" href="_n_e_g_e_m_m_matrix_accumulate_biases_kernel_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a>++)</div>
<div class="line"><span class="lineno"> 1712</span>        {</div>
<div class="line"><span class="lineno"> 1713</span>          <span class="keyword">const</span> int16_t filter_val = *filter_ptr++ + filter_offset;</div>
<div class="line"><span class="lineno"> 1714</span>          *acc_buffer_ptr++ += <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(filter_val) * input_val;</div>
<div class="line"><span class="lineno"> 1715</span>        }</div>
<div class="line"><span class="lineno"> 1716</span>      }</div>
<div class="line"><span class="lineno"> 1717</span>      input_ptr += input_ptr_increment;</div>
<div class="line"><span class="lineno"> 1718</span>    }</div>
<div class="line"><span class="lineno"> 1719</span>    filter_base_ptr += output_depth;</div>
<div class="line"><span class="lineno"> 1720</span>  }</div>
<div class="line"><span class="lineno"> 1721</span>}</div>
<div class="ttc" id="a_n_e_g_e_m_m_matrix_accumulate_biases_kernel_8cpp_html_aa73e018b04368e7afaded77ef0ac69db"><div class="ttname"><a href="_n_e_g_e_m_m_matrix_accumulate_biases_kernel_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a></div><div class="ttdeci">std::mutex m</div><div class="ttdef"><b>Definition:</b> <a href="_n_e_g_e_m_m_matrix_accumulate_biases_kernel_8cpp_source.html#l00135">NEGEMMMatrixAccumulateBiasesKernel.cpp:135</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_n_e_g_e_m_m_matrix_accumulate_biases_kernel_8cpp_source.html#l00135">m</a>.</p>

<p class="reference">Referenced by <a class="el" href="optimized_2_depthwise_conv_u_int8_8h_source.html#l01814">DepthwiseConvGeneral()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacennfw.html">nnfw</a></li><li class="navelem"><a class="el" href="namespacennfw_1_1cker.html">cker</a></li><li class="navelem"><a class="el" href="namespacennfw_1_1cker_1_1optimized.html">optimized</a></li><li class="navelem"><a class="el" href="namespacennfw_1_1cker_1_1optimized_1_1depthwise__conv.html">depthwise_conv</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
