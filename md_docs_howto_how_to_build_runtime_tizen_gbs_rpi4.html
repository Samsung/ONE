<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ONE - On-device Neural Engine: How to Build Runtime with GBS for Tizen/RPi4</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ONE - On-device Neural Engine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_howto_how_to_build_runtime_tizen_gbs_rpi4.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">How to Build Runtime with GBS for Tizen/RPi4 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This document describes how to build runtime with GBS for Tizen AARCH64. As a real example, we'll also describe how to prepare Tizen on Raspberry Pi 4 and show you how to run our test package runner <code>onert_run</code>.</p>
<p >For ARM32, there would be not much difference with some changes.</p>
<p >Host PC is Ubuntu 18.04 but other versions or distro may work with a little adjustments.</p>
<p >Detailed technical informations are not described here so please read referecnce pages while you go on.</p>
<h1>Setting up build environment</h1>
<p >(1) Add Tizen build tools repo </p><div class="fragment"><div class="line">$ sudo vim /etc/apt/sources.list</div>
</div><!-- fragment --><p> Add this at the end </p><div class="fragment"><div class="line">deb [trusted=yes] http://download.tizen.org/tools/latest-release/Ubuntu_18.04/ /</div>
</div><!-- fragment --><p> Note: There's a slash('/`) at the end.</p>
<p >For other versions of Ubuntu, please refer <a href="http://download.tizen.org/tools/latest-release/">http://download.tizen.org/tools/latest-release/</a> lists.</p>
<p >(2) Update package informations and upgrade to latest </p><div class="fragment"><div class="line">$ sudo apt-get update</div>
<div class="line">$ sudo apt-get upgrade</div>
</div><!-- fragment --><p >(3) Install GBS tools </p><div class="fragment"><div class="line">$ sudo apt-get install gbs mic</div>
</div><!-- fragment --><p >To get more informations, please refer <a href="https://source.tizen.org/ko/documentation/developer-guide/getting-started-guide/installing-development-tools">HERE</a></p>
<h1>Build ONERT</h1>
<p >(1) Set <code>python2</code> as default python</p>
<p >Some tools of GBS run in <code>python2</code> and won't run with <code>python3</code>. Please check <code>python</code> version and set it to 2.x.</p>
<p >(2) set <code>TIZEN_BUILD_ROOT</code></p>
<p >You may set <code>GBS-ROOT</code> to any place you like. Ususally we use home folder. </p><div class="fragment"><div class="line">$ export TIZEN_BUILD_ROOT=$HOME/GBS-ROOT/</div>
</div><!-- fragment --><p> Adding to <code>$HOME/.profile</code> file would be a good thing.</p>
<p >(3) clone ONE repo</p>
<div class="fragment"><div class="line">git clone https://github.com/Samsung/ONE.git</div>
</div><!-- fragment --><p >(4) Build</p>
<div class="fragment"><div class="line">$ cd ONE</div>
<div class="line"> </div>
<div class="line">$ gbs -c infra/nnfw/config/gbs.conf build --include-all -A aarch64 --define &#39;test_build 1&#39;</div>
</div><!-- fragment --><ul>
<li><code>-A aarch64</code> is to set architecture to AARCH64. Use <code>arm32</code> for ARM32 target.</li>
<li>&lsquo;--define 'test_build 1&rsquo;<code>is to enable test build so that we can use</code>onert_run`</li>
</ul>
<p >Now take a cup of coffee.</p>
<p >(5) Build result RPM packages</p>
<div class="fragment"><div class="line">$ ls ~/GBS-ROOT/local/repos/tizen/aarch64/RPMS</div>
<div class="line">nnfw-1.10.0-1.aarch64.rpm</div>
<div class="line">nnfw-debuginfo-1.10.0-1.aarch64.rpm</div>
<div class="line">nnfw-debugsource-1.10.0-1.aarch64.rpm</div>
<div class="line">nnfw-devel-1.10.0-1.aarch64.rpm</div>
<div class="line">nnfw-minimal-app-1.10.0-1.aarch64.rpm</div>
<div class="line">nnfw-minimal-app-debuginfo-1.10.0-1.aarch64.rpm</div>
<div class="line">nnfw-plugin-devel-1.10.0-1.aarch64.rpm</div>
<div class="line">nnfw-test-1.10.0-1.aarch64.rpm</div>
<div class="line">nnfw-test-debuginfo-1.10.0-1.aarch64.rpm</div>
</div><!-- fragment --><p ><code>-1.10.0-1</code> may differ as this document was written with under <code>1.10.0</code> development.</p>
<h1>Prepare Tizen on Raspberry Pi 4</h1>
<p >Please refer <a href="https://wiki.tizen.org/Quick_guide_for_RPI4">https://wiki.tizen.org/Quick_guide_for_RPI4</a> for detailed descriptions.</p>
<p >(1) Download flashing tool </p><div class="fragment"><div class="line">$ wget \</div>
<div class="line">https://git.tizen.org/cgit/platform/kernel/u-boot/plain/scripts/tizen/sd_fusing_rpi3.sh?h=tizen \</div>
<div class="line">--output-document=sd_fusing_rpi3.sh</div>
<div class="line"> </div>
<div class="line">$ chmod 755 sd_fusing_rpi3.sh</div>
</div><!-- fragment --><p >(2) Prepare Micro-SD memory card.</p>
<p >You first need to find out device name. This document will skip how to find this. Suppose it's <code>/dev/sdj</code>: </p><div class="fragment"><div class="line">$ sudo ./sd_fusing_rpi3.sh -d /dev/sdj --format</div>
</div><!-- fragment --><p> You need to change <code>/dev/sdj</code> to your configuration.</p>
<p >Partition table may look like this </p><div class="fragment"><div class="line">Device     Boot    Start      End  Sectors  Size Id Type</div>
<div class="line">/dev/sdj1  *        8192   139263   131072   64M  e W95 FAT16 (LBA)</div>
<div class="line">/dev/sdj2         139264  6430719  6291456    3G 83 Linux</div>
<div class="line">/dev/sdj3        6430720  9183231  2752512  1.3G 83 Linux</div>
<div class="line">/dev/sdj4        9183232 62521343 53338112 25.4G  5 Extended</div>
<div class="line">/dev/sdj5        9185280 61958143 52772864 25.2G 83 Linux</div>
<div class="line">/dev/sdj6       61960192 62025727    65536   32M 83 Linux</div>
<div class="line">/dev/sdj7       62027776 62044159    16384    8M 83 Linux</div>
<div class="line">/dev/sdj8       62046208 62111743    65536   32M 83 Linux</div>
<div class="line">/dev/sdj9       62113792 62130175    16384    8M 83 Linux</div>
<div class="line">/dev/sdj10      62132224 62263295   131072   64M 83 Linux</div>
<div class="line">/dev/sdj11      62265344 62521343   256000  125M 83 Linux</div>
</div><!-- fragment --><p >(3) Download images</p>
<p >Please visit <a href="http://download.tizen.org/snapshots/tizen/unified/latest/images/standard/iot-boot-arm64-rpi4/">http://download.tizen.org/snapshots/tizen/unified/latest/images/standard/iot-boot-arm64-rpi4/</a> and <a href="http://download.tizen.org/snapshots/tizen/unified/latest/images/standard/iot-headed-3parts-aarch64-rpi">http://download.tizen.org/snapshots/tizen/unified/latest/images/standard/iot-headed-3parts-aarch64-rpi</a>.</p>
<p >Please visit <code>iot-boot-armv7l-rpi4</code> folder for ARM32 images.</p>
<p >Get latest file. As of writing this document, name has <code>20200908.3</code>. </p><div class="fragment"><div class="line">$ wget  http://download.tizen.org/snapshots/tizen/unified/latest/images/standard/iot-boot-arm64-rpi4/tizen-unified_20200908.3_iot-boot-arm64-rpi4.tar.gz</div>
<div class="line"> </div>
<div class="line">$ wget http://download.tizen.org/snapshots/tizen/unified/latest/images/standard/iot-headed-3parts-aarch64-rpi/tizen-unified_20200908.3_iot-headed-3parts-aarch64-rpi.tar.gz</div>
</div><!-- fragment --><p >(4) Flash images to memory card</p>
<p >As like above, suppose memory card is at <code>/dev/sdj</code> </p><div class="fragment"><div class="line">$ sudo ./sd_fusing_rpi3.sh -d /dev/sdj \</div>
<div class="line">-b tizen-unified_20200908.3_iot-boot-arm64-rpi4.tar.gz \</div>
<div class="line">tizen-unified_20200908.3_iot-headed-3parts-aarch64-rpi.tar.gz</div>
</div><!-- fragment --><p> You need to change <code>/dev/sdj</code> to your configuration and also <code>tizen-unified_...</code> file to your latest download file name.</p>
<p >(5) Assign IP address for <code>sdb</code> connection</p>
<p >Here, we provide a way to connect <code>sdb</code> tool through TCP/IP.</p>
<p >Below steps will modify root image and set fixed IP address.</p>
<p >(5-1) Mount image to host </p><div class="fragment"><div class="line">$ mkdir j2</div>
<div class="line">$ sudo mount /dev/sdj2 j2</div>
</div><!-- fragment --><p> As like above, please update <code>/dev/sdj2</code> to your configuration.</p>
<p >(5-2) Add a new file </p><div class="fragment"><div class="line">$ vi j2/etc/systemd/system/ip.service</div>
</div><!-- fragment --><p> and set as like: </p><div class="fragment"><div class="line">[Service]</div>
<div class="line">Restart=always</div>
<div class="line">RestartSec=1</div>
<div class="line">User=root</div>
<div class="line">ExecStart=/bin/sh -c &quot;ifconfig eth0 192.168.x.y netmask 255.255.255.0 up&quot;</div>
<div class="line"> </div>
<div class="line">[Install]</div>
<div class="line">WantedBy=multi-user.target</div>
</div><!-- fragment --><p> Replace 192.168.x.y to your actual ip address.</p>
<p >(5-3) Add a symbolic link </p><div class="fragment"><div class="line">$ sudo mkdir -p j2/etc/systemd/system/multi-user.target.wants/</div>
<div class="line">$ pushd j2/etc/systemd/system/multi-user.target.wants/</div>
<div class="line">$ sudo ln -s ../../system/ip.service .</div>
<div class="line">$ popd</div>
</div><!-- fragment --><p >(5-4) Now that every thing is ready, unmount and unplug your memory card and plug into RPi4, turn on the power. </p><div class="fragment"><div class="line">$ sync</div>
<div class="line">$ sudo umount j2</div>
</div><!-- fragment --><h1>sdb connect to Tizen/RPi4</h1>
<p >You may need to install Tizen Studio to use <code>sdb</code> command. Please visit <a href="https://developer.tizen.org/">https://developer.tizen.org/</a> if you don't have this.</p>
<p >We assume <code>sdb</code> command is in the PATH.</p>
<p >(1) Connect</p>
<div class="fragment"><div class="line">$ sdb connect 192.168.x.y</div>
<div class="line">connecting to 192.168.x.y:26101 ...</div>
<div class="line">connected to 192.168.x.y:26101</div>
</div><!-- fragment --><p> Please update <code>192.168.x.y</code> part to your actual IP address.</p>
<p >Check with <code>devices</code> command: you should see <code>rpi3</code> or alike. </p><div class="fragment"><div class="line">$ sdb devices</div>
<div class="line">List of devices attached</div>
<div class="line">192.168.x.y:26101     device          rpi3</div>
</div><!-- fragment --><p >(2) Remount filesystem with R/W</p>
<p >You need to remount file system with Read/Write so that you can install packages. </p><div class="fragment"><div class="line">$ sdb root on</div>
<div class="line">$ sdb shell</div>
</div><!-- fragment --><p> Inside your Tizen/RPi4: </p><div class="fragment"><div class="line">sh-3.2# mount -o rw,remount /</div>
</div><!-- fragment --><p >(3) Download dependent packages</p>
<p >In your host, maybe with another terminal, download packages from <a href="http://download.tizen.org/releases/daily/tizen/unified/latest/repos/standard/packages/aarch64/">http://download.tizen.org/releases/daily/tizen/unified/latest/repos/standard/packages/aarch64/</a></p>
<div class="fragment"><div class="line">$ wget http://download.tizen.org/releases/daily/tizen/unified/latest/repos/standard/packages/aarch64/libarmcl-v21.02-17.5.aarch64.rpm</div>
<div class="line"> </div>
<div class="line">$ wget http://download.tizen.org/releases/daily/tizen/unified/latest/repos/standard/packages/aarch64/libhdf5-101-1.10.1-3.85.aarch64.rpm</div>
<div class="line"> </div>
<div class="line">$ wget http://download.tizen.org/releases/daily/tizen/unified/latest/repos/standard/packages/aarch64/libhdf5_cpp101-1.10.1-3.85.aarch64.rpm</div>
</div><!-- fragment --><p >(4) Copy to device </p><div class="fragment"><div class="line">$ sdb push libarmcl-v21.02-17.5.aarch64.rpm /opt/usr/home/owner/share/tmp/</div>
<div class="line">$ sdb push libhdf5-101-1.10.1-3.85.aarch64.rpm /opt/usr/home/owner/share/tmp/</div>
<div class="line">$ sdb push libhdf5_cpp101-1.10.1-3.85.aarch64.rpm /opt/usr/home/owner/share/tmp/</div>
</div><!-- fragment --><p> And our runtime packages </p><div class="fragment"><div class="line">$ cd ~/GBS-ROOT/local/repos/tizen/aarch64/RPMS</div>
<div class="line">$ sdb push nnfw-1.10.0-1.aarch64.rpm /opt/usr/home/owner/share/tmp/</div>
<div class="line">$ sdb push nnfw-test-1.10.0-1.aarch64.rpm /opt/usr/home/owner/share/tmp/</div>
</div><!-- fragment --><p >(5) Install dependent packages</p>
<p >Within Tizen/RPi4 shell </p><div class="fragment"><div class="line">sh-3.2# cd /opt/usr/home/owner/share/tmp/</div>
<div class="line"> </div>
<div class="line">sh-3.2# rpm -i libarmcl-v21.02-17.5.aarch64.rpm</div>
<div class="line">sh-3.2# rpm -i libhdf5-101-1.10.1-3.85.aarch64.rpm</div>
<div class="line">sh-3.2# rpm -i libhdf5_cpp101-1.10.1-3.85.aarch64.rpm</div>
</div><!-- fragment --><p> There may be message like this but it seems OK: </p><div class="fragment"><div class="line">/sbin/ldconfig: Cannot lstat /lib64/libhdf5.so.101.0.0: Permission denied</div>
</div><!-- fragment --><p> Continue install </p><div class="fragment"><div class="line">sh-3.2# rpm -i nnfw-1.10.0-1.aarch64.rpm</div>
<div class="line">sh-3.2# rpm -i nnfw-test-1.10.0-1.aarch64.rpm</div>
</div><!-- fragment --><p >Our <code>Product</code> binary folder is installed at <code>/opt/usr/nnfw-test</code>. </p><div class="fragment"><div class="line">sh-3.2# cd /opt/usr/nnfw-test</div>
<div class="line">sh-3.2# ls -al</div>
<div class="line">total 16</div>
<div class="line">drwxr-xr-x  4 root root 4096 Jan  1 09:05 .</div>
<div class="line">drwxr-xr-x 14 root root 4096 Jan  1 09:05 ..</div>
<div class="line">drwxr-xr-x  3 root root 4096 Jan  1 09:05 Product</div>
<div class="line">drwxr-xr-x  3 root root 4096 Jan  1 09:05 infra</div>
</div><!-- fragment --><p >(6) Run nnpackage</p>
<p >Refer <code>how-to-build-package.md</code> document to produce nnpackage from a model.</p>
<p >Assume <code>mobilenet_v2_1.4_224</code> nnpackage is already copied to <code>/opt/usr/home/owner/media/models</code> folder with <code>sdb</code> command.</p>
<div class="fragment"><div class="line">sh-3.2# BACKENDS=&quot;cpu&quot; Product/out/bin/onert_run \</div>
<div class="line">--nnpackage /opt/usr/home/owner/media/models/mobilenet_v2_1.4_224</div>
<div class="line"> </div>
<div class="line">Package Filename /opt/usr/home/owner/media/models/mobilenet_v2_1.4_224</div>
<div class="line">===================================</div>
<div class="line">MODEL_LOAD   takes 65.403 ms</div>
<div class="line">PREPARE      takes 158.716 ms</div>
<div class="line">EXECUTE      takes 373.447 ms</div>
<div class="line">- MEAN     :  373.447 ms</div>
<div class="line">- MAX      :  373.447 ms</div>
<div class="line">- MIN      :  373.447 ms</div>
<div class="line">- GEOMEAN  :  373.447 ms</div>
<div class="line">===================================</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
